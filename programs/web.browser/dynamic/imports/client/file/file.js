function(e,t,i){var n,o,s,r,a,l;i.watch(e("meteor/http"),{HTTP:function(e){n=e}},0),i.watch(e("meteor/meteor"),{Meteor:function(e){o=e}},1),i.watch(e("meteor/templating"),{Template:function(e){s=e}},2),i.watch(e("meteor/reactive-var"),{ReactiveVar:function(e){r=e}},3),i.watch(e("/imports/lib/core.js"),{_app:function(e){a=e},Collections:function(e){l=e}},4),i.watch(e("./file.jade"));var h=!1;s.file.onCreated(function(){this.showOriginal=new r(!1),this.fetchedText=new r(!1),this.showPreview=new r(!1),this.showError=new r(!1),this.showInfo=new r(!1),this.warning=new r(!1)}),s.file.onRendered(function(){var e=this;if(this.warning.set(!1),this.fetchedText.set(!1),this.data.file){if(this.data.file.isText||this.data.file.isJSON)this.data.file.size<65536?n.call("GET",this.data.file.link(),function(t,i){e.showPreview.set(!0),t?console.error(t):~[500,404,400].indexOf(i.statusCode)||(i.content.length<65536?e.fetchedText.set(i.content):e.warning.set(!0))}):this.warning.set(!0);else if(this.data.file.isImage){var t=new Image,i;if(/png|jpe?g/i.test(this.data.file.type))t.onload=function(){e.showPreview.set(!0)},t.onerror=function(){e.showError.set(!0)},null!=this.data.file.versions&&null!=this.data.file.versions.preview&&this.data.file.versions.preview.extension?t.src=this.data.file.link("preview"):i=l.files.find(this.data.file._id).observeChanges({changed:function(n,o){null!=o&&null!=o.versions&&null!=o.versions.preview&&o.versions.preview.extension&&(t.src=e.data.file.link("preview"),i.stop())}});else t.onload=function(){e.showOriginal.set(!0)},t.onerror=function(){e.showError.set(!0)},t.src=this.data.file.link()}else if(this.data.file.isVideo){var o=a.getElementFromView(this.view._domrange.parentElement,this.data.file._id);if(!o)return;if(o.canPlayType(this.data.file.type)){var s=o.play();("[object Promise]"===Object.prototype.toString.call(s)||"[object Object]"===Object.prototype.toString.call(s)&&s.then&&"[object Function]"===Object.prototype.toString.call(s.then))&&s.then(a.NOOP).catch(a.NOOP)}else this.showError.set(!0)}else if(this.data.file.isAudio){var r=a.getElementFromView(this.view._domrange.parentElement,this.data.file._id);if(!r)return;if(r.canPlayType(this.data.file.type)){var h=r.play();("[object Promise]"===Object.prototype.toString.call(h)||"[object Object]"===Object.prototype.toString.call(h)&&h.then&&"[object Function]"===Object.prototype.toString.call(h.then))&&h.then(a.NOOP).catch(a.NOOP)}else this.showError.set(!0)}window.IS_RENDERED=!0}else window.IS_RENDERED=!0}),s.file.helpers({warning:function(){return s.instance().warning.get()},getCode:function(){return this.type&&~this.type.indexOf("/")?this.type.split("/")[1]:""},isBlamed:function(){return!!~a.blamed.get().indexOf(this._id)},showInfo:function(){return s.instance().showInfo.get()},showError:function(){return s.instance().showError.get()},fetchedText:function(){return s.instance().fetchedText.get()},showPreview:function(){return s.instance().showPreview.get()},showOriginal:function(){return s.instance().showOriginal.get()}}),s.file.events({"click [data-blame]":function(e){e.preventDefault();var t=a.blamed.get();return~t.indexOf(this._id)?(t.splice(t.indexOf(this._id),1),a.blamed.set(t),o.call("unblame",this._id)):(t.push(this._id),a.blamed.set(t),o.call("blame",this._id)),!1},"click [data-show-info]":function(e,t){return e.preventDefault(),t.showInfo.set(!t.showInfo.get()),!1},"touchmove .file-overlay":function(e){return e.preventDefault(),!1},"touchmove .file":function(e,t){t.$(e.currentTarget).height()<t.$(".file-table").height()&&(t.$("a.show-info").hide(),t.$("h1.file-title").hide(),t.$("a.download-file").hide(),h&&o.clearTimeout(h),h=o.setTimeout(function(){t.$("a.show-info").show(),t.$("h1.file-title").show(),t.$("a.download-file").show()},768))}})}

