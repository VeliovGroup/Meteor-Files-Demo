{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio_files/files.coffee"],"names":[],"mappings":"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","file":"/packages/ostrio_files.js","sourcesContent":["if Meteor.isServer\n  ###\n  @description Require \"fs-extra\" npm package\n  ###\n  fs       = Npm.require 'fs-extra'\n  request  = Npm.require 'request'\n  Throttle = Npm.require 'throttle'\n  ###\n  @var {object} bound - Meteor.bindEnvironment aka Fiber wrapper\n  ###\n  bound = Meteor.bindEnvironment (callback) -> return callback()\n\n###\n@object\n@name _insts\n@description Object of Meteor.Files instances\n###\n_insts = {}\n\n###\n@function\n@name rcp\n@param {Object} obj - Initial object\n@description Create object with only needed props\n###\nrcp = (obj) ->\n  o =\n    currentFile:    obj.currentFile\n    search:         obj.search\n    storagePath:    obj.storagePath\n    collectionName: obj.collectionName\n    downloadRoute:  obj.downloadRoute\n    chunkSize:      obj.chunkSize\n    debug:          obj.debug\n    _prefix:        obj._prefix\n    cacheControl:   obj.cacheControl\n    versions:       obj.versions\n  return o\n\n###\n@function\n@name cp\n@param {Object} to   - Destanation\n@param {Object} from - Source\n@description Copy-Paste only needed props from one to another object\n###\ncp = (to, from) ->\n  to.currentFile    = from.currentFile\n  to.search         = from.search\n  to.storagePath    = from.storagePath\n  to.collectionName = from.collectionName\n  to.downloadRoute  = from.downloadRoute\n  to.chunkSize      = from.chunkSize\n  to.debug          = from.debug\n  to._prefix        = from._prefix\n  to.cacheControl   = from.cacheControl\n  to.versions       = from.versions\n  return to\n\n###\n@class\n@namespace Meteor\n@name Files\n@param config           {Object}   - Configuration object with next properties:\n@param config.debug     {Boolean}  - Turn on/of debugging and extra logging\n@param config.schema    {Object}   - Collection Schema\n@param config.public    {Boolean}  - Store files in folder accessible for proxy servers, for limits, and more - read docs\n@param config.strict    {Boolean}  - Strict mode for partial content, if is `true` server will return `416` response code, when `range` is not specified, otherwise server return `206`\n@param config.protected {Function} - If `true` - files will be served only to authorized users, if `function()` - you're able to check visitor's permissions in your own way function's context has:\n  - `request` - On server only\n  - `response` - On server only\n  - `user()`\n  - `userId`\n@param config.chunkSize      {Number}  - Upload chunk size\n@param config.allowUpload    {Boolean} - Allow/deny upload from client, default `true`\n@param config.permissions    {Number}  - Permissions which will be set to uploaded files, like: `511` or `0o777`\n@param config.storagePath    {String}  - Storage path on file system\n@param config.cacheControl   {String}  - Default `Cache-Control` header\n@param config.throttle       {Number}  - bps throttle threshold\n@param config.downloadRoute  {String}  - Server Route used to retrieve files\n@param config.collectionName {String}  - Collection name\n@param config.namingFunction {Function}- Function which returns `String`\n@param config.integrityCheck {Boolean} - Check file's integrity before serving to users\n@param config.onBeforeUpload {Function}- Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\nreturn `true` to continue\nreturn `false` or `String` to abort upload\n@param config.allowClientCode  {Boolean}  - Allow to run `remove` from client\n@param config.downloadCallback {Function} - Callback triggered each time file is requested\n@param config.onbeforeunloadMessage {String|Function} - Message shown to user when closing browser's window or tab while upload process is running\n@description Create new instance of Meteor.Files\n###\nclass Meteor.Files\n  constructor: (config) ->\n    {@storagePath, @collectionName, @downloadRoute, @schema, @chunkSize, @namingFunction, @debug, @onbeforeunloadMessage, @permissions, @allowClientCode, @onBeforeUpload, @integrityCheck, @protected, @public, @strict, @downloadCallback, @cacheControl, @throttle} = config if config\n\n    @debug            ?= false\n    @public           ?= false\n    @strict           ?= true\n    @protected        ?= false\n    @chunkSize        ?= 272144\n    @permissions      ?= 0o777\n    @cacheControl     ?= 'public, max-age=31536000, s-maxage=31536000'\n    @collectionName   ?= 'MeteorUploadFiles'\n    @namingFunction   ?= -> Random._randomString 17, 'AZQWXSECDRFVTBGYNHUJMIKOLPzaqwsxecdrfvtgbyhnujimkolp'\n    @integrityCheck   ?= true\n    @onBeforeUpload   ?= false\n    @allowClientCode  ?= true\n    @downloadCallback ?= false\n    @onbeforeunloadMessage ?= 'Upload in a progress... Do you want to abort?'\n    @throttle         ?= false\n\n    cookie = new Cookies()\n    if @protected and Meteor.isClient\n      if not cookie.has('meteor_login_token') and Meteor._localStorage.getItem('Meteor.loginToken')\n        cookie.set 'meteor_login_token', Meteor._localStorage.getItem('Meteor.loginToken'), null, '/'\n\n    if not @storagePath\n      @storagePath   = if @public then \"../web.browser/app/uploads/#{@collectionName}\" else \"/assets/app/uploads/#{@collectionName}\"\n      @downloadRoute = if @public then \"/uploads/#{@collectionName}\" else '/cdn/storage' if not @downloadRoute\n    \n    if not @downloadRoute\n      @downloadRoute = '/cdn/storage'\n\n\n    if not @schema\n      @schema =\n        size: type: Number\n        name: type: String\n        type: type: String\n        path: type: String\n        isVideo: type: Boolean\n        isAudio: type: Boolean\n        isImage: type: Boolean\n        _prefix: type: String\n        extension:\n          type: String\n          optional: true\n        _storagePath: type: String\n        _downloadRoute: type: String\n        _collectionName: type: String\n        meta:\n          type: Object\n          blackbox: true\n          optional: true\n        userId:\n          type: String\n          optional: true\n        updatedAt: \n          type: Date\n          autoValue: -> new Date()\n        versions:\n          type: Object\n          blackbox: true\n\n    check @debug, Boolean\n    check @schema, Object\n    check @public, Boolean\n    check @strict, Boolean\n    check @throttle, Match.OneOf false, Number\n    check @protected, Match.OneOf Boolean, Function\n    check @chunkSize, Number\n    check @permissions, Number\n    check @storagePath, String\n    check @downloadRoute, String\n    check @integrityCheck, Boolean\n    check @collectionName, String\n    check @namingFunction, Function\n    check @onBeforeUpload, Match.OneOf Boolean, Function\n    check @allowClientCode, Boolean\n    check @downloadCallback, Match.OneOf Boolean, Function\n    check @onbeforeunloadMessage, Match.OneOf String, Function\n\n    if @public and @protected\n      throw new Meteor.Error 500, \"[Meteor.File.#{@collectionName}]: Files can not be public and protected at the same time!\"\n    \n    @collection    = new Mongo.Collection @collectionName\n    @storagePath   = @storagePath.replace /\\/$/, ''\n    @downloadRoute = @downloadRoute.replace /\\/$/, ''\n\n    self          = @\n    @cursor       = null\n    @search       = {}\n    @currentFile  = null\n\n    @collection.attachSchema @schema\n\n    @collection.deny\n      insert: ->\n        true\n      update: ->\n        true\n      remove: ->\n        true\n    \n    @_prefix = SHA256 @collectionName + @storagePath + @downloadRoute\n    _insts[@_prefix] = @\n\n    @checkAccess = (http) ->\n      if @protected\n        user = false\n        userFuncs = @getUser http\n        {user, userId} = userFuncs\n        user = user()\n\n        if _.isFunction @protected\n          result = if http then @protected.call(_.extend(http, userFuncs), @currentFile or null) else @protected.call userFuncs, @currentFile or null\n        else\n          result = !!user\n\n        if (http and result is true) or not http\n          return true\n        else\n          rc = if _.isNumber(result) then result else 401\n          console.warn 'Access denied!' if @debug\n          if http\n            text = 'Access denied!'\n            http.response.writeHead rc,\n              'Content-Length': text.length\n              'Content-Type':   'text/plain'\n            http.response.end text\n          return false\n      else\n        return true\n\n    if Meteor.isServer\n      WebApp.connectHandlers.use (request, response, next) =>\n        unless @public\n          if !!~request._parsedUrl.path.indexOf \"#{@downloadRoute}/#{@collectionName}\"\n            uri = request._parsedUrl.path.replace \"#{@downloadRoute}/#{@collectionName}\", ''\n            if uri.indexOf('/') is 0\n              uri = uri.substring 1\n\n            uris = uri.split '/'\n            if uris.length is 3\n              params = \n                query: if request._parsedUrl.query then JSON.parse('{\"' + decodeURI(request._parsedUrl.query).replace(/\"/g, '\\\\\"').replace(/&/g, '\",\"').replace(/=/g,'\":\"') + '\"}') else {}\n                _id: uris[0]\n                version: uris[1]\n                name: uris[2]\n              http = {request, response, params}\n              @findOne(uris[0]).download.call(@, http, uris[1]) if @checkAccess http\n            else\n              next()\n          else\n            next()\n        else\n          if !!~request._parsedUrl.path.indexOf \"#{@downloadRoute}\"\n            uri = request._parsedUrl.path.replace \"#{@downloadRoute}\", ''\n            if uri.indexOf('/') is 0\n              uri = uri.substring 1\n\n            uris = uri.split '/'\n            if uris.length is 1\n              params = \n                query: if request._parsedUrl.query then JSON.parse('{\"' + decodeURI(request._parsedUrl.query).replace(/\"/g, '\\\\\"').replace(/&/g, '\",\"').replace(/=/g,'\":\"') + '\"}') else {}\n                file: uris[0]\n              http = {request, response, params}\n\n              if !!~params.file.indexOf '-'\n                version = params.file.split('-')[0]\n                @download.call @, http, version\n              else\n                response.writeHead 404\n                response.end 'No such file :('\n            else\n              next()\n          else\n            next()\n\n    @methodNames =\n      MeteorFileAbort:  \"MeteorFileAbort#{@_prefix}\"\n      MeteorFileWrite:  \"MeteorFileWrite#{@_prefix}\"\n      MeteorFileUnlink: \"MeteorFileUnlink#{@_prefix}\"\n\n    if Meteor.isServer\n      _methods = {}\n\n      _methods[self.methodNames.MeteorFileUnlink] = (inst) ->\n        check inst, Object\n        console.info 'Meteor.Files Debugger: [MeteorFileUnlink]' if self.debug\n        if self.allowClientCode\n          self.remove.call cp(_insts[inst._prefix], inst), inst.search\n        else\n          throw new Meteor.Error 401, '[Meteor.Files] [remove()] Run code from client is not allowed!'\n\n      _methods[self.methodNames.MeteorFileWrite] = (unitArray, fileData, meta = {}, first, chunksQty, currentChunk, totalSentChunks, randFileName, part, partsQty, fileSize) ->\n        @unblock()\n        check part, Number\n        check meta, Match.Optional Object\n        check first, Boolean\n        check fileSize, Number\n        check partsQty, Number\n        check fileData, Object\n        check unitArray, Match.OneOf Uint8Array, Object\n        check chunksQty, Number\n        check randFileName, String\n        check currentChunk, Number\n        check totalSentChunks, Number\n\n        console.info \"Meteor.Files Debugger: [MeteorFileWrite] {name: #{randFileName}, meta:#{meta}}\" if self.debug\n        console.info \"Meteor.Files Debugger: Received chunk ##{currentChunk} of #{chunksQty} chunks, in part: #{part}, file: #{fileData.name or fileData.fileName}\" if self.debug\n\n        if self.onBeforeUpload and _.isFunction self.onBeforeUpload\n          isUploadAllowed = self.onBeforeUpload.call fileData\n          if isUploadAllowed isnt true\n            throw new Meteor.Error(403, if _.isString(isUploadAllowed) then isUploadAllowed else '@onBeforeUpload() returned false')\n\n        i = 0\n        binary = ''\n        while i < unitArray.byteLength\n          binary += String.fromCharCode unitArray[i]\n          i++\n        last = (chunksQty * partsQty <= totalSentChunks)\n\n        fileName = self.getFileName fileData\n        {extension, extensionWithDot} = self.getExt fileName\n\n        pathName  = if self.public then \"#{self.storagePath}/original-#{randFileName}\" else \"#{self.storagePath}/#{randFileName}\"\n        path      = if self.public then \"#{self.storagePath}/original-#{randFileName}#{extensionWithDot}\" else \"#{self.storagePath}/#{randFileName}#{extensionWithDot}\"\n        pathPart  = if partsQty > 1 then \"#{pathName}_#{part}#{extensionWithDot}\" else path\n\n\n        result = self.dataToSchema\n          name:      fileName\n          path:      path\n          meta:      meta\n          type:      fileData?.type\n          size:      fileData.size\n          extension: extension\n\n        result.chunk = currentChunk\n        result.last  = last\n        \n        try\n          if first\n            fs.outputFileSync pathPart, binary, 'binary'\n          else\n            fs.appendFileSync pathPart, binary, 'binary'\n        catch e\n          error = new Meteor.Error 500, 'Unfinished upload (probably caused by server reboot or aborted operation)', e\n          console.error error\n          return error\n        \n        console.info \"Meteor.Files Debugger: The part ##{part} of file #{fileName} (binary) was saved to #{pathPart}\" if (chunksQty is currentChunk) and self.debug\n\n        if last\n          if partsQty > 1\n            i = 2\n            while i <= partsQty\n              _path = \"#{pathName}_#{i}#{extensionWithDot}\"\n              fs.appendFileSync pathName + '_1' + extensionWithDot, fs.readFileSync(_path), 'binary'\n              fs.unlink _path\n              i++\n            fs.renameSync pathName + '_1' + extensionWithDot, path\n\n\n          fs.chmod path, self.permissions\n          result._id  = randFileName if self.public\n          result.type = self.getMimeType fileData\n          result._id  = self.collection.insert _.clone result\n\n          console.info \"Meteor.Files Debugger: The file #{fileName} (binary) was saved to #{path}\" if self.debug\n        return result\n\n      _methods[self.methodNames.MeteorFileAbort] = (randFileName, partsQty, fileData) ->\n        check partsQty, Number\n        check fileData, Object\n        check randFileName, String\n\n        pathName  = if self.public then \"#{self.storagePath}/original-#{randFileName}\" else \"#{self.storagePath}/#{randFileName}\"\n        extensionWithDot = \".#{fileData.ext}\"\n\n        if partsQty > 1\n          i = 0\n          while i <= partsQty\n            path = \"#{pathName}_#{i}#{extensionWithDot}\"\n            fs.unlink path if fs.existsSync path\n            i++\n\n      Meteor.methods _methods\n\n  ###\n  Extend Meteor.Files with mime library\n  @url https://github.com/broofa/node-mime\n  @description Temporary removed from package due to unstability\n  ###\n  # fileType: if Meteor.isServer then Npm.require \"file-type\" else undefined\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name getMimeType\n  @param {Object} fileData - File Object\n  @description Returns file's mime-type\n  @returns {String}\n  ###\n  getMimeType: (fileData) ->\n    check fileData, Object\n    mime = fileData.type if fileData?.type\n    mime = 'application/octet-stream' if not mime or not _.isString mime\n    mime\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name getFileName\n  @param {Object} fileData - File Object\n  @description Returns file's name\n  @returns {String}\n  ###\n  getFileName: (fileData) ->\n    fileName = fileData.name or fileData.fileName\n    if _.isString(fileName) and fileName.length > 0\n      cleanName = (str) -> str.replace(/\\.\\./g, '').replace /\\//g, ''\n      return cleanName(fileData.name or fileData.fileName)\n    else\n      return ''\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name getUser\n  @description Returns object with `userId` and `user()` method which return user's object\n  @returns {Object}\n  ###\n  getUser: (http) ->\n    result = \n      user: -> return undefined\n      userId: undefined\n      \n    if Meteor.isServer\n      if http\n        cookie = http.request.Cookies\n        if _.has(Package, 'accounts-base') and cookie.has 'meteor_login_token'\n          user = Meteor.users.findOne 'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken cookie.get 'meteor_login_token'\n          if user\n            result.user = () -> return user\n            result.userId = user._id\n    else\n      if _.has(Package, 'accounts-base') and Meteor.userId()\n        result.user = -> return Meteor.user()\n        result.userId = Meteor.userId()\n\n    return result\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name getExt\n  @param {String} FileName - File name\n  @description Get extension from FileName\n  @returns {Object}\n  ###\n  getExt: (fileName) ->\n    if !!~fileName.indexOf('.')\n      extension = fileName.split('.').pop()\n      return { extension, extensionWithDot: '.' + extension }\n    else\n      return { extension: '', extensionWithDot: '' }\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name dataToSchema\n  @param {Object} data - File data\n  @description Build object in accordance with schema from File data\n  @returns {Object}\n  ###\n  dataToSchema: (data) ->\n    return {\n      name:       data.name\n      extension:  data.extension\n      path:       data.path\n      meta:       data.meta\n      type:       data.type\n      size:       data.size\n      versions:\n        original:\n          path: data.path\n          size: data.size\n          type: data.type\n          extension: data.extension\n      isVideo: !!~data.type.toLowerCase().indexOf('video')\n      isAudio: !!~data.type.toLowerCase().indexOf('audio')\n      isImage: !!~data.type.toLowerCase().indexOf('image')\n      _prefix: data._prefix or @_prefix\n      _storagePath:    data._storagePath or @storagePath\n      _downloadRoute:  data._downloadRoute or @downloadRoute\n      _collectionName: data._collectionName or @collectionName\n    }\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name srch\n  @param {String|Object} search - Search data\n  @description Build search object\n  @returns {Object}\n  ###\n  srch: (search) ->\n    if search and _.isString search\n      @search =\n        _id: search\n    else\n      @search = search\n    @search\n\n  ###\n  @server\n  @function\n  @class Meteor.Files\n  @name write\n  @param {Buffer} buffer - Binary File's Buffer\n  @param {Object} opts - {fileName: '', type: '', size: 0, meta: {...}}\n  @param {Function} callback - function(error, fileObj){...}\n  @description Write buffer to FS and add to Meteor.Files Collection\n  @returns {Files} - Return this\n  ###\n  write: if Meteor.isServer then (buffer, opts = {}, callback) ->\n    console.info \"Meteor.Files Debugger: [write(buffer, #{JSON.stringify(opts)}, callback)]\" if @debug\n    check opts, Match.Optional Object\n    check callback, Match.Optional Function\n\n    if @checkAccess()\n      randFileName  = @namingFunction()\n      fileName      = if opts.name or opts.fileName then opts.name or opts.fileName else randFileName\n\n      {extension, extensionWithDot} = @getExt fileName\n\n      path      = if @public then \"#{@storagePath}/original-#{randFileName}#{extensionWithDot}\" else \"#{@storagePath}/#{randFileName}#{extensionWithDot}\"\n      \n      opts.type = @getMimeType opts\n      opts.meta = {} if not opts.meta\n      opts.size = buffer.length if not opts.size\n\n      result    = @dataToSchema\n        name:      fileName\n        path:      path\n        meta:      opts.meta\n        type:      opts.type\n        size:      opts.size\n        extension: extension\n\n      console.info \"Meteor.Files Debugger: The file #{fileName} (binary) was added to #{@collectionName}\" if @debug\n\n      fs.outputFileSync path, buffer, 'binary'\n\n      result._id = @collection.insert _.clone result\n      callback and callback null, result\n      return result\n  else\n    undefined\n\n  ###\n  @server\n  @function\n  @class Meteor.Files\n  @name load\n  @param {String} url - URL to file\n  @param {Object} opts - {fileName: '', meta: {...}}\n  @param {Function} callback - function(error, fileObj){...}\n  @description Download file, write stream to FS and add to Meteor.Files Collection\n  @returns {Files} - Return this\n  ###\n  load: if Meteor.isServer then (url, opts = {}, callback) ->\n    console.info \"Meteor.Files Debugger: [load(#{url}, #{JSON.stringify(opts)}, callback)]\" if @debug\n    check url, String\n    check opts, Match.Optional Object\n    check callback, Match.Optional Function\n\n    self = @\n    if @checkAccess()\n      randFileName  = @namingFunction()\n      fileName      = if opts.name or opts.fileName then opts.name or opts.fileName else randFileName\n      \n      {extension, extensionWithDot} = @getExt fileName\n      path      = if @public then \"#{@storagePath}/original-#{randFileName}#{extensionWithDot}\" else \"#{@storagePath}/#{randFileName}#{extensionWithDot}\"\n      opts.meta = {} if not opts.meta\n\n      request.get(url).on('error', (error)->\n        throw new Meteor.Error 500, \"Error on [load(#{url}, #{opts})]; Error:\" + JSON.stringify error\n      ).on('response', (response) -> bound ->\n\n        result = self.dataToSchema\n          name:      fileName\n          path:      path\n          meta:      opts.meta\n          type:      response.headers['content-type']\n          size:      response.headers['content-length']\n          extension: extension\n\n        console.info \"Meteor.Files Debugger: The file #{fileName} (binary) was loaded to #{@collectionName}\" if @debug\n\n        result._id = self.collection.insert _.clone result\n        callback and callback null, result\n\n      ).pipe fs.createOutputStream path\n\n  else\n    undefined\n\n  ###\n  @server\n  @function\n  @class Meteor.Files\n  @name addFile\n  @param {String} path - Path to file\n  @param {String} path - Path to file\n  @description Add file from FS to Meteor.Files\n  @returns {Files} - Return this\n  ###\n  addFile: if Meteor.isServer then (path, opts = {}, callback) ->\n    console.info \"[addFile(#{path})]\" if @debug\n\n    throw new Meteor.Error 403, 'Can not run [addFile()] on public collection' if @public\n    check path, String\n    check opts, Match.Optional Object\n    check callback, Match.Optional Function\n\n    try\n      stats = fs.statSync path\n\n      if stat.isFile()\n        fileSize  = stats.size\n        pathParts = path.split '/'\n        fileName  = pathParts[pathParts.length - 1]\n\n        {extension, extensionWithDot} = @getExt fileName\n\n        opts.type = 'application/*' if not opts.type\n        opts.meta = {} if not opts.meta\n        opts.size = fileSize if not opts.size\n\n        result = @dataToSchema\n          name:         fileName\n          path:         path\n          meta:         opts.meta\n          type:         opts.type\n          size:         opts.size\n          extension:    extension\n          _storagePath: path.replace \"/#{fileName}\", ''\n\n        result._id = @collection.insert _.clone result\n        console.info \"The file #{fileName} (binary) was added to #{@collectionName}\" if @debug\n\n        callback and callback null, result\n        return result\n      else\n        error = new Meteor.Error 400, \"[Files.addFile(#{path})]: File does not exist\"\n        callback and callback error\n        return error\n\n    catch error\n      callback and callback error\n      return error\n  else\n    undefined\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name findOne\n  @param {String|Object} search - `_id` of the file or `Object` like, {prop:'val'}\n  @description Load file\n  @returns {Files} - Return this\n  ###\n  findOne: (search) ->\n    console.info \"Meteor.Files Debugger: [findOne(#{JSON.stringify(search)})]\" if @debug\n    check search, Match.OneOf Object, String\n    @srch search\n\n    if @checkAccess()\n      @currentFile = @collection.findOne @search\n      @cursor      = null\n      return @\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name find\n  @param {String|Object} search - `_id` of the file or `Object` like, {prop:'val'}\n  @description Load file or bunch of files\n  @returns {Files} - Return this\n  ###\n  find: (search) ->\n    console.info \"Meteor.Files Debugger: [find(#{JSON.stringify(search)})]\" if @debug\n    check search, Match.OneOf Object, String\n    @srch search\n\n    if @checkAccess\n      @currentFile = null\n      @cursor = @collection.find @search\n      return @\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name get\n  @description Return value of current cursor or file\n  @returns {Object|[Object]}\n  ###\n  get: () ->\n    console.info 'Meteor.Files Debugger: [get()]' if @debug\n    return @cursor.fetch() if @cursor\n    return @currentFile\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name fetch\n  @description Alias for `get()` method\n  @returns {[Object]}\n  ###\n  fetch: () ->\n    console.info 'Meteor.Files Debugger: [fetch()]' if @debug\n    data = @get()\n    if not _.isArray data\n      return [data]\n    else\n      data\n\n  ###\n  @client\n  @function\n  @class Meteor.Files\n  @name insert\n  @param {Object} config - Configuration object with next properties:\n    {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n    {Object}      meta           - Additional data as object, use later for search\n    {Number}      streams        - Quantity of parallel upload streams\n    {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n    {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n    {Function}    onBeforeUpload - Callback triggered right before upload is started, with only `FileReader` argument:\n                                   context is `File` - so you are able to check for extension, mime-type, size and etc.\n                                   return true to continue\n                                   return false to abort upload\n  @description Upload file to server over DDP\n  @url https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n  @returns {Object} with next properties:\n    {ReactiveVar} onPause      - Is upload process on the pause?\n    {Function}    pause        - Pause upload process\n    {Function}    continue     - Continue paused upload process\n    {Function}    toggle       - Toggle continue/pause if upload process\n    {Function}    abort        - Abort upload\n  ###\n  insert: if Meteor.isClient then (config) ->\n    if @checkAccess()\n      console.info 'Meteor.Files Debugger: [insert()]' if @debug\n      {file, meta, onUploaded, onProgress, onBeforeUpload, onAbort, streams} = config\n      meta ?= {}\n\n      check meta, Match.Optional Object\n      check onAbort, Match.Optional Function\n      check streams, Match.Optional Number\n      check onUploaded, Match.Optional Function\n      check onProgress, Match.Optional Function\n      check onBeforeUpload, Match.Optional Function\n\n      if file\n        console.time('insert') if @debug\n\n        self = @\n        beforeunload = (e) ->\n          message = if _.isFunction(self.onbeforeunloadMessage) then self.onbeforeunloadMessage.call(null) else self.onbeforeunloadMessage\n          e.returnValue = message if e\n          return message\n        window.addEventListener 'beforeunload', beforeunload, false\n\n        result  =\n          onPause: new ReactiveVar false\n          continueFrom: []\n          pause: () ->\n            @onPause.set true\n            @state.set 'paused'\n          continue: () ->\n            @onPause.set false\n            @state.set 'active'\n            func.call null for func in @continueFrom\n            @continueFrom = []\n          toggle: () ->\n            if @onPause.get() then @continue() else @pause()\n          progress: new ReactiveVar 0\n          abort: () ->\n            window.removeEventListener 'beforeunload', beforeunload, false\n            onAbort and onAbort.call file, fileData\n            @pause()\n            @state.set 'aborted'\n            Meteor.call self.methodNames.MeteorFileAbort, randFileName, streams, file\n            delete upload\n          state: new ReactiveVar 'active'\n\n        result.progress.set = _.throttle result.progress.set, 250\n\n        Tracker.autorun ->\n          if Meteor.status().connected\n            result.continue()\n            console.info 'Meteor.Files Debugger: Connection established continue() upload' if self.debug\n          else\n            result.pause()\n            console.info 'Meteor.Files Debugger: Connection error set upload on pause()' if self.debug\n\n        streams         = 1 if not streams\n        totalSentChunks = 0\n\n        {extension, extensionWithDot} = @getExt file.name\n\n        if not file.type\n          {ext, mime} = @getMimeType {}\n          file.type = mime\n\n        fileData =\n          size: file.size\n          type: file.type\n          name: file.name\n          ext:  extension\n          extension:   extension\n          'mime-type': file.type\n\n        file         = _.extend file, fileData\n        last         = false\n        parts        = []\n        uploaded     = 0\n        partSize     = Math.ceil file.size / streams\n        result.file  = file\n        randFileName = @namingFunction()\n\n        i = 1\n        while i <= streams\n          parts.push\n            to:   partSize * i\n            from: partSize * (i-1)\n            size: partSize\n            part: i\n            chunksQty: if @chunkSize < partSize then Math.ceil(partSize / @chunkSize) else 1\n          i++\n\n        end = (error, data) ->\n          console.timeEnd('insert') if self.debug\n          window.removeEventListener 'beforeunload', beforeunload, false\n          result.progress.set 0\n          result.state.set if error then 'aborted' else 'completed'\n          onUploaded and onUploaded.call self, error, data\n\n        if onBeforeUpload and _.isFunction onBeforeUpload\n          isUploadAllowed = onBeforeUpload.call file\n          if isUploadAllowed isnt true\n            end new Meteor.Error(403, if _.isString(isUploadAllowed) then isUploadAllowed else 'onBeforeUpload() returned false'), null\n            return false\n\n        if @onBeforeUpload and _.isFunction @onBeforeUpload\n          isUploadAllowed = @onBeforeUpload.call file\n          if isUploadAllowed isnt true\n            end new Meteor.Error(403, if _.isString(isUploadAllowed) then isUploadAllowed else '@onBeforeUpload() returned false'), null\n            return false\n\n        upload = (filePart, part, chunksQtyInPart, fileReader) ->\n          currentChunk = 1\n          first = true\n          console.time(\"insertPart#{part}\") if @debug\n\n          fileReader.onload = (chunk) ->\n            ++totalSentChunks\n            progress = (uploaded / file.size) * 100\n            result.progress.set progress\n            onProgress and onProgress(progress)\n\n            last        = (part is streams and currentChunk >= chunksQtyInPart)\n            uploaded   += self.chunkSize\n            arrayBuffer = chunk.srcElement or chunk.target\n            unitArray   = new Uint8Array arrayBuffer.result\n\n            if chunksQtyInPart is 1\n              Meteor.call self.methodNames.MeteorFileWrite, unitArray, fileData, meta, first, chunksQtyInPart, currentChunk, totalSentChunks, randFileName, part, streams, file.size, (error, data) ->\n                return end error if error\n                if data.last\n                  end error, data\n            else\n              Meteor.call self.methodNames.MeteorFileWrite, unitArray, fileData, meta, first, chunksQtyInPart, currentChunk, totalSentChunks, randFileName, part, streams, file.size, (error, data)->\n                return end error if error\n                next = () ->\n                  if data.chunk + 1 <= chunksQtyInPart\n                    from = currentChunk * self.chunkSize\n                    to   = from + self.chunkSize\n\n                    fileReader.readAsArrayBuffer filePart.slice from, to\n                    currentChunk = ++data.chunk\n                  else if data.last\n                    end error, data\n\n                unless result.onPause.get()\n                  next.call null\n                else\n                  result.continueFrom.push next\n                  \n            first = false\n\n          fileReader.readAsArrayBuffer filePart.slice 0, self.chunkSize unless result.onPause.get()\n\n        for part, i in parts\n          fileReader = new FileReader\n          upload.call null, file.slice(part.from, part.to), i + 1, part.chunksQty, fileReader\n\n        return result\n      else\n        console.warn 'Meteor.Files: [insert({file: \"file\", ..})]: file property is required'\n  else\n    undefined\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name remove\n  @param {String|Object} search - `_id` of the file or `Object` like, {prop:'val'}\n  @description Remove file(s) on cursor or find and remove file(s) if search is set\n  @returns {undefined}\n  ###\n  remove: (search) ->\n    console.info \"Meteor.Files Debugger: [remove(#{JSON.stringify(search)})]\" if @debug\n    check search, Match.Optional Match.OneOf Object, String\n\n    if @checkAccess()\n      @srch search\n      if Meteor.isClient\n        Meteor.call @methodNames.MeteorFileUnlink, rcp(@)\n        undefined\n\n      if Meteor.isServer\n        files = @collection.find @search\n        if files.count() > 0\n          files.forEach (file) => @unlink file\n        @collection.remove @search\n        undefined\n\n  ###\n  @sever\n  @function\n  @class Meteor.Files\n  @name unlink\n  @param {Object} file - fileObj\n  @description Unlink files and it's versions from FS\n  @returns {undefined}\n  ###\n  unlink: if Meteor.isServer then (file) ->\n    if file.versions and not _.isEmpty file.versions\n      _.each file.versions, (version) ->\n        fs.remove version.path\n    else\n      fs.remove file.path\n\n    undefined\n  else undefined\n\n  ###\n  @server\n  @function\n  @class Meteor.Files\n  @name download\n  @param {Object|Files} self - Instance of MEteor.Files\n  @description Initiates the HTTP response\n  @returns {undefined}\n  ###\n  download: if Meteor.isServer then (http, version = 'original') ->\n    console.info \"Meteor.Files Debugger: [download(#{http}, #{version})]\" if @debug\n    responseType = '200'\n    if not @public\n      if @currentFile\n        if _.has(@currentFile, 'versions') and _.has @currentFile.versions, version\n          fileRef = @currentFile.versions[version]\n        else\n          fileRef = @currentFile\n      else\n        fileRef = false\n\n    if @public\n      fileRef =\n        path: \"#{@storagePath}/#{http.params.file}\"\n      responseType = if fs.existsSync fileRef.path then '200' else '404'\n    else if not fileRef or not _.isObject(fileRef) or not fs.existsSync fileRef.path\n      responseType = '404'\n    else if @currentFile and fs.existsSync fileRef.path\n\n      if @downloadCallback\n        unless @downloadCallback.call _.extend(http, @getUser(http)), @currentFile\n          responseType = '404'\n\n      partiral     = false\n      reqRange     = false\n      fileStats    = fs.statSync fileRef.path\n      fileRef.size = fileStats.size if fileStats.size isnt fileRef.size and not @integrityCheck\n      responseType = '400' if fileStats.size isnt fileRef.size and @integrityCheck\n\n      if http.params.query.download and http.params.query.download == 'true'\n        dispositionType = 'attachment; '\n      else\n        dispositionType = 'inline; '\n\n      dispositionName     = \"filename=\\\"#{encodeURIComponent(@currentFile.name)}\\\"; filename=*UTF-8\\\"#{encodeURIComponent(@currentFile.name)}\\\"; \"\n      dispositionEncoding = 'charset=utf-8'\n\n      http.response.setHeader 'Content-Type', fileRef.type\n      http.response.setHeader 'Content-Disposition', dispositionType + dispositionName + dispositionEncoding\n      http.response.setHeader 'Accept-Ranges', 'bytes'\n      http.response.setHeader 'Last-Modified', @currentFile?.updatedAt?.toUTCString() if @currentFile?.updatedAt?.toUTCString()\n      http.response.setHeader 'Connection', 'keep-alive'\n\n      if http.request.headers.range\n        partiral = true\n        array    = http.request.headers.range.split /bytes=([0-9]*)-([0-9]*)/\n        start    = parseInt array[1]\n        end      = parseInt array[2]\n        if isNaN(end)\n          end    = if (start + @chunkSize) < fileRef.size then start + @chunkSize else fileRef.size\n        take     = end - start\n      else\n        start    = 0\n        end      = undefined\n        take     = @chunkSize\n\n      if take > 4096000\n        take = 4096000\n        end  = start + take\n\n      if partiral or (http.params.query.play and http.params.query.play == 'true')\n        reqRange = {start, end}\n        if isNaN(start) and not isNaN end\n          reqRange.start = end - take\n          reqRange.end   = end\n        if not isNaN(start) and isNaN end\n          reqRange.start = start\n          reqRange.end   = start + take\n\n        reqRange.end = fileRef.size - 1 if ((start + take) >= fileRef.size)\n        http.response.setHeader 'Pragma', 'private'\n        http.response.setHeader 'Expires', new Date(+new Date + 1000*32400).toUTCString()\n        http.response.setHeader 'Cache-Control', 'private, maxage=10800, s-maxage=32400'\n\n        if (@strict and not http.request.headers.range) or reqRange.start >= fileRef.size or reqRange.end > fileRef.size\n          responseType = '416'\n        else\n          responseType = '206'\n      else\n        http.response.setHeader 'Cache-Control', @cacheControl\n        responseType = '200'\n    else\n      responseType = '404'\n\n    streamErrorHandler = (error) ->\n      http.response.writeHead 500\n      http.response.end error.toString()\n\n    switch responseType\n      when '400'\n        console.warn \"Meteor.Files Debugger: [download(#{http}, #{version})] [400] Content-Length mismatch!: #{fileRef.path}\" if @debug\n        text = 'Content-Length mismatch!'\n        http.response.writeHead 400,\n          'Content-Type':   'text/plain'\n          'Cache-Control':  'no-cache'\n          'Content-Length': text.length\n        http.response.end text\n        break\n      when '404'\n        console.warn \"Meteor.Files Debugger: [download(#{http}, #{version})] [404] File not found: #{if fileRef and fileRef.path then fileRef.path else undefined}\" if @debug\n        text = 'File Not Found :('\n        http.response.writeHead 404,\n          'Content-Length': text.length\n          'Content-Type':   'text/plain'\n        http.response.end text\n        break\n      when '416'\n        console.info \"Meteor.Files Debugger: [download(#{http}, #{version})] [416] Content-Range is not specified!: #{fileRef.path}\" if @debug\n        http.response.writeHead 416,\n          'Content-Range': \"bytes */#{fileRef.size}\"\n        http.response.end()\n        break\n      when '200'\n        console.info \"Meteor.Files Debugger: [download(#{http}, #{version})] [200]: #{fileRef.path}\" if @debug\n        stream = fs.createReadStream fileRef.path\n        stream.on('open', =>\n          http.response.writeHead 200\n          if @throttle\n            stream.pipe( new Throttle {bps: @throttle, chunksize: @chunkSize}\n            ).pipe http.response\n          else\n            stream.pipe http.response\n        ).on 'error', streamErrorHandler\n        break\n      when '206'\n        console.info \"Meteor.Files Debugger: [download(#{http}, #{version})] [206]: #{fileRef.path}\" if @debug\n        http.response.setHeader 'Content-Range', \"bytes #{reqRange.start}-#{reqRange.end}/#{fileRef.size}\"\n        http.response.setHeader 'Trailer', 'expires'\n        http.response.setHeader 'Transfer-Encoding', 'chunked'\n        if @throttle\n          stream = fs.createReadStream fileRef.path, {start: reqRange.start, end: reqRange.end}\n          stream.on('open', -> http.response.writeHead 206\n          ).on('error', streamErrorHandler\n          ).on('end', -> http.response.end()\n          ).pipe( new Throttle {bps: @throttle, chunksize: @chunkSize}\n          ).pipe http.response\n        else\n          stream = fs.createReadStream fileRef.path, {start: reqRange.start, end: reqRange.end}\n          stream.on('open', -> http.response.writeHead 206\n          ).on('error', streamErrorHandler\n          ).on('end', -> http.response.end()\n          ).pipe http.response\n        break\n    undefined\n  else\n    undefined\n\n  ###\n  @isomorphic\n  @function\n  @class Meteor.Files\n  @name link\n  @param {Object}   fileRef - File reference object\n  @param {String}   version - [Optional] Version of file you would like to request\n  @param {Boolean}  pub     - [Optional] is file located in publicity available folder?\n  @description Returns URL to file\n  @returns {String}\n  ###\n  link: (fileRef, version = 'original', pub = false) ->\n    console.info 'Meteor.Files Debugger: [link()]' if @debug\n    if _.isString fileRef\n      version = fileRef\n      fileRef = undefined\n    return undefined if not fileRef and not @currentFile\n\n    if @public\n      return formatFleURL fileRef or @currentFile, version, true\n    else\n      return formatFleURL fileRef or @currentFile, version, false\n\n###\n@isomorphic\n@function\n@name formatFleURL\n@param {Object} fileRef - File reference object\n@param {String} version - [Optional] Version of file you would like build URL for\n@param {Boolean}  pub   - [Optional] is file located in publicity available folder?\n@description Returns formatted URL for file\n@returns {String}\n###\nformatFleURL = (fileRef, version = 'original', pub = false) ->\n  root = __meteor_runtime_config__.ROOT_URL.replace(/\\/+$/, '')\n\n  if fileRef?.extension?.length > 0\n    ext = '.' + fileRef.extension\n  else\n    ext = ''\n\n  if pub\n    return root + \"#{fileRef._downloadRoute}/#{version}-#{fileRef._id}#{ext}\"\n  else\n    return root + \"#{fileRef._downloadRoute}/#{fileRef._collectionName}/#{fileRef._id}/#{version}/#{fileRef._id}#{ext}\"\n\nif Meteor.isClient\n  ###\n  @client\n  @TemplateHelper\n  @name fileURL\n  @param {Object} fileRef - File reference object\n  @param {String} version - [Optional] Version of file you would like to request\n  @description Get download URL for file by fileRef, even without subscription\n  @example {{fileURL fileRef}}\n  @returns {String}\n  ###\n  Template.registerHelper 'fileURL', (fileRef, version) ->\n    return undefined if not fileRef or not _.isObject fileRef\n    version = if not _.isString version then 'original' else version\n    if fileRef._id\n      if fileRef._storagePath.indexOf('../web.browser') isnt -1\n        return formatFleURL fileRef, version, true\n      else\n        return formatFleURL fileRef, version, false\n    else\n      null\n"]}