{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio_files/files.coffee"],"names":[],"mappings":"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","file":"/packages/ostrio_files.js","sourcesContent":["if Meteor.isServer\n  ###\n  @summary Require NPM packages\n  ###\n  fs       = Npm.require 'fs-extra'\n  request  = Npm.require 'request'\n  Throttle = Npm.require 'throttle'\n  fileType = Npm.require 'file-type'\n  NOOP     = -> return\n\n  ###\n  @var {object} bound - Meteor.bindEnvironment (Fiber wrapper)\n  ###\n  bound = Meteor.bindEnvironment (callback) -> return callback()\n\n###\n@private\n@name _insts\n@summary Object of FilesCollection instances\n###\n_insts = {}\n\n###\n@private\n@name rcp\n@param {Object} obj - Initial object\n@summary Create object with only needed props\n###\nrcp = (obj) ->\n  o =\n    currentFile:    obj.currentFile\n    search:         obj.search\n    storagePath:    obj.storagePath\n    collectionName: obj.collectionName\n    downloadRoute:  obj.downloadRoute\n    chunkSize:      obj.chunkSize\n    debug:          obj.debug\n    _prefix:        obj._prefix\n    cacheControl:   obj.cacheControl\n    versions:       obj.versions\n  return o\n\n###\n@private\n@name cp\n@param {Object} to   - Destination\n@param {Object} from - Source\n@summary Copy-Paste only needed props from one to another object\n###\ncp = (to, from) ->\n  to.currentFile    = from.currentFile\n  to.search         = from.search\n  to.storagePath    = from.storagePath\n  to.collectionName = from.collectionName\n  to.downloadRoute  = from.downloadRoute\n  to.chunkSize      = from.chunkSize\n  to.debug          = from.debug\n  to._prefix        = from._prefix\n  to.cacheControl   = from.cacheControl\n  to.versions       = from.versions\n  return to\n\n###\n@locus Anywhere\n@class FilesCollection\n@param config           {Object}   - [Both]   Configuration object with next properties:\n@param config.debug     {Boolean}  - [Both]   Turn on/of debugging and extra logging\n@param config.schema    {Object}   - [Both]   Collection Schema\n@param config.public    {Boolean}  - [Both]   Store files in folder accessible for proxy servers, for limits, and more - read docs\n@param config.strict    {Boolean}  - [Server] Strict mode for partial content, if is `true` server will return `416` response code, when `range` is not specified, otherwise server return `206`\n@param config.protected {Function} - [Both]   If `true` - files will be served only to authorized users, if `function()` - you're able to check visitor's permissions in your own way function's context has:\n  - `request` - On server only\n  - `response` - On server only\n  - `user()`\n  - `userId`\n@param config.chunkSize      {Number}  - [Both] Upload chunk size, default: 524288 bytes (0,5 Mb)\n@param config.permissions    {Number}  - [Server] Permissions which will be set to uploaded files, like: `511` or `0o755`\n@param config.storagePath    {String}  - [Server] Storage path on file system\n@param config.cacheControl   {String}  - [Server] Default `Cache-Control` header\n@param config.throttle       {Number}  - [Server] bps throttle threshold\n@param config.downloadRoute  {String}  - [Both]   Server Route used to retrieve files\n@param config.collectionName {String}  - [Both]   Collection name\n@param config.namingFunction {Function}- [Both]   Function which returns `String`\n@param config.integrityCheck {Boolean} - [Server] Check file's integrity before serving to users\n@param config.onAfterUpload  {Function}- [Server] Called right after file is ready on FS. Use to transfer file somewhere else, or do other thing with file directly\n@param config.onBeforeUpload {Function}- [Both]   Function which executes on server after receiving each chunk and on client right before beginning upload. Function context is `File` - so you are able to check for extension, mime-type, size and etc.\nreturn `true` to continue\nreturn `false` or `String` to abort upload\n@param config.allowClientCode  {Boolean}  - [Both]   Allow to run `remove` from client\n@param config.downloadCallback {Function} - [Server] Callback triggered each time file is requested, return truthy value to continue download, or falsy to abort\n@param config.interceptDownload {Function} - [Server] Intercept download request, so you can serve file from third-party resource, arguments {http: {request: {...}, response: {...}}, fileRef: {...}}\n@param config.onbeforeunloadMessage {String|Function} - [Client] Message shown to user when closing browser's window or tab while upload process is running\n@summary Create new instance of FilesCollection\n###\nclass FilesCollection\n  constructor: (config) ->\n    {@storagePath, @collectionName, @downloadRoute, @schema, @chunkSize, @namingFunction, @debug, @onbeforeunloadMessage, @permissions, @allowClientCode, @onBeforeUpload, @integrityCheck, @protected, @public, @strict, @downloadCallback, @cacheControl, @throttle, @onAfterUpload, @interceptDownload} = config if config\n\n    self               = @\n    cookie             = new Cookies()\n    @debug            ?= false\n    @public           ?= false\n    @protected        ?= false\n    @chunkSize        ?= 1024*512\n    @chunkSize         = Math.floor(@chunkSize / 8) * 8\n    if @public and not @downloadRoute\n      throw new Meteor.Error 500, \"[FilesCollection.#{@collectionName}]: \\\"downloadRoute\\\" must be explicitly provided on \\\"public\\\" collections! Note: \\\"downloadRoute\\\" must be equal on be inside of your web/proxy-server (relative) root.\"\n    @downloadRoute    ?= '/cdn/storage'\n    @downloadRoute     = @downloadRoute.replace /\\/$/, ''\n    @collectionName   ?= 'MeteorUploadFiles'\n    @namingFunction   ?= -> Random.id()\n    @onBeforeUpload   ?= false\n    @allowClientCode  ?= true\n    @interceptDownload?= false\n\n    if Meteor.isClient\n      @onbeforeunloadMessage ?= 'Upload in a progress... Do you want to abort?'\n      delete @strict\n      delete @throttle\n      delete @storagePath\n      delete @permissions\n      delete @cacheControl\n      delete @onAfterUpload\n      delete @integrityCheck\n      delete @downloadCallback\n      delete @interceptDownload\n      if @protected\n        if not cookie.has('meteor_login_token') and Meteor._localStorage.getItem('Meteor.loginToken')\n          cookie.set 'meteor_login_token', Meteor._localStorage.getItem('Meteor.loginToken'), null, '/'\n\n      check @onbeforeunloadMessage, Match.OneOf String, Function\n    else\n      @strict           ?= true\n      @throttle         ?= false\n      @permissions      ?= 0o755\n      @cacheControl     ?= 'public, max-age=31536000, s-maxage=31536000'\n      @onAfterUpload    ?= false\n      @integrityCheck   ?= true\n      @downloadCallback ?= false\n      if @public and not @storagePath\n        throw new Meteor.Error 500, \"[FilesCollection.#{@collectionName}] \\\"storagePath\\\" must be set on \\\"public\\\" collections! Note: \\\"storagePath\\\" must be equal on be inside of your web/proxy-server (absolute) root.\"\n      @storagePath      ?= \"assets/app/uploads/#{@collectionName}\"\n      @storagePath       = @storagePath.replace /\\/$/, ''\n\n      fs.mkdirsSync @storagePath\n\n      check @strict, Boolean\n      check @throttle, Match.OneOf false, Number\n      check @permissions, Number\n      check @storagePath, String\n      check @cacheControl, String\n      check @onAfterUpload, Match.OneOf false, Function\n      check @integrityCheck, Boolean\n      check @downloadCallback, Match.OneOf false, Function\n      check @interceptDownload, Match.OneOf false, Function\n\n    if not @schema\n      @schema =\n        size: type: Number\n        name: type: String\n        type: type: String\n        path: type: String\n        isVideo: type: Boolean\n        isAudio: type: Boolean\n        isImage: type: Boolean\n        isText: type: Boolean\n        _prefix: type: String\n        extension:\n          type: String\n          optional: true\n        _storagePath: type: String\n        _downloadRoute: type: String\n        _collectionName: type: String\n        public:\n          type: Boolean\n          optional: true\n        meta:\n          type: Object\n          blackbox: true\n          optional: true\n        userId:\n          type: String\n          optional: true\n        updatedAt: \n          type: Date\n          autoValue: -> new Date()\n        versions:\n          type: Object\n          blackbox: true\n\n    check @debug, Boolean\n    check @schema, Object\n    check @public, Boolean\n    check @protected, Match.OneOf Boolean, Function\n    check @chunkSize, Number\n    check @downloadRoute, String\n    check @collectionName, String\n    check @namingFunction, Function\n    check @onBeforeUpload, Match.OneOf false, Function\n    check @allowClientCode, Boolean\n\n    if @public and @protected\n      throw new Meteor.Error 500, \"[FilesCollection.#{@collectionName}]: Files can not be public and protected at the same time!\"\n    \n    @cursor        = null\n    @search        = {}\n    @collection    = new Mongo.Collection @collectionName\n    @currentFile   = null\n    \n    @_prefix = SHA256 @collectionName + @downloadRoute\n    _insts[@_prefix] = @\n\n    @checkAccess = (http) ->\n      if self.protected\n        user = false\n        userFuncs = self.getUser http\n        {user, userId} = userFuncs\n        user = user()\n\n        if _.isFunction self.protected\n          result = if http then self.protected.call(_.extend(http, userFuncs), self.currentFile or null) else self.protected.call userFuncs, self.currentFile or null\n        else\n          result = !!user\n\n        if (http and result is true) or not http\n          return true\n        else\n          rc = if _.isNumber(result) then result else 401\n          console.warn '[FilesCollection.checkAccess] WARN: Access denied!' if self.debug\n          if http\n            text = 'Access denied!'\n            http.response.writeHead rc,\n              'Content-Length': text.length\n              'Content-Type':   'text/plain'\n            http.response.end text\n          return false\n      else\n        return true\n\n    @methodNames =\n      MeteorFileAbort:  \"MeteorFileAbort#{@_prefix}\"\n      MeteorFileWrite:  \"MeteorFileWrite#{@_prefix}\"\n      MeteorFileUnlink: \"MeteorFileUnlink#{@_prefix}\"\n\n    if Meteor.isServer\n      WebApp.connectHandlers.use (request, response, next) ->\n        unless self.public\n          if !!~request._parsedUrl.path.indexOf \"#{self.downloadRoute}/#{self.collectionName}\"\n            uri = request._parsedUrl.path.replace \"#{self.downloadRoute}/#{self.collectionName}\", ''\n            if uri.indexOf('/') is 0\n              uri = uri.substring 1\n\n            uris = uri.split '/'\n            if uris.length is 3\n              params = \n                query: if request._parsedUrl.query then JSON.parse('{\"' + decodeURI(request._parsedUrl.query).replace(/\"/g, '\\\\\"').replace(/&/g, '\",\"').replace(/=/g,'\":\"') + '\"}') else {}\n                _id: uris[0]\n                version: uris[1]\n                name: uris[2]\n              http = {request, response, params}\n              self.findOne(uris[0]).download.call(self, http, uris[1]) if self.checkAccess http\n            else\n              next()\n          else\n            next()\n        else\n          if !!~request._parsedUrl.path.indexOf \"#{self.downloadRoute}\"\n            uri = request._parsedUrl.path.replace \"#{self.downloadRoute}\", ''\n            if uri.indexOf('/') is 0\n              uri = uri.substring 1\n\n            uris  = uri.split '/'\n            _file = uris[uris.length - 1]\n            if _file\n              if !!~_file.indexOf '-'\n                version = _file.split('-')[0]\n                _file   = _file.split('-')[1].split('?')[0]\n              else\n                version = 'original'\n                _file   = _file.split('?')[0]\n\n              params = \n                query: if request._parsedUrl.query then JSON.parse('{\"' + decodeURI(request._parsedUrl.query).replace(/\"/g, '\\\\\"').replace(/&/g, '\",\"').replace(/=/g,'\":\"') + '\"}') else {}\n                file: _file\n                _id: _file.split('.')[0]\n                version: version\n                name: _file\n              http = {request, response, params}\n              self.findOne(params._id).download.call self, http, version\n            else\n              next()\n          else\n            next()\n        return\n\n      _methods = {}\n      _methods[self.methodNames.MeteorFileUnlink] = (inst) ->\n        check inst, Object\n        console.info '[FilesCollection] [Unlink Method]' if self.debug\n        if self.allowClientCode\n          self.remove.call cp(_insts[inst._prefix], inst), inst.search\n        else\n          throw new Meteor.Error 401, '[FilesCollection] [remove] Run code from client is not allowed!'\n\n      _methods[self.methodNames.MeteorFileWrite] = (opts) ->\n        @unblock()\n        check opts, {\n          eof:        Match.Optional Boolean\n          meta:       Match.Optional Object\n          file:       Object\n          fileId:     String\n          binData:    Match.Optional String\n          chunkId:    Match.Optional Number\n          fileLength: Number\n        }\n\n        opts.eof     ?= false\n        opts.meta    ?= {}\n        opts.binData ?= 'EOF'\n        opts.chunkId ?= -1\n\n        console.info \"[FilesCollection] [Write Method] Got ##{opts.chunkId}/#{opts.fileLength} chunks, dst: #{opts.file.name or opts.file.fileName}\" if self.debug\n\n        if self.onBeforeUpload and _.isFunction self.onBeforeUpload\n          isUploadAllowed = self.onBeforeUpload.call {file: opts.file}, opts.file\n          if isUploadAllowed isnt true\n            throw new Meteor.Error(403, if _.isString(isUploadAllowed) then isUploadAllowed else '@onBeforeUpload() returned false')\n\n        fileName = self.getFileName opts.file\n        {extension, extensionWithDot} = self.getExt fileName\n\n        pathName = \"#{self.storagePath}/#{opts.fileId}\"\n        path     = \"#{self.storagePath}/#{opts.fileId}#{extensionWithDot}\"\n        pathPart = if opts.fileLength > 1 then \"#{pathName}_#{opts.chunkId}#{extensionWithDot}\" else null\n\n        result = _.extend self.dataToSchema(_.extend(opts.file, {path, extension, name: fileName, meta: opts.meta})), {_id: opts.fileId}\n\n        action = (cb) ->\n          if opts.eof\n            binary = opts.binData\n          else\n            binary = new Buffer opts.binData, 'base64'\n          tries  = 0\n\n          concatChunks = (num, files, cb) ->\n            sindex = files.indexOf \"#{opts.fileId}_1#{extensionWithDot}\"\n            files.splice sindex, 1 if !!~sindex\n            findex = files.indexOf \"#{opts.fileId}_#{num}#{extensionWithDot}\"\n            if !!~findex\n              files.splice findex, 1\n            else if files.length <= 0\n              return finish cb\n            else\n              return concatChunks ++num, files, cb\n\n            _path   = \"#{pathName}_#{num}#{extensionWithDot}\"\n            _source = pathName + '_1' + extensionWithDot\n\n            fs.stat _path, (error, stats) -> bound ->\n              if error or not stats.isFile()\n                if tries >= 10\n                  cb new Meteor.Error 500, \"Chunk ##{num} is missing!\"\n                else\n                  tries++\n                  Meteor.setTimeout ->\n                    concatChunks num, files, cb\n                  , 100\n              else\n                fs.readFile _path, (error, _chunkData) -> bound ->\n                  if error\n                    cb new Meteor.Error 500, \"Can't read #{_path}\"\n                  else\n                    fs.appendFile _source, _chunkData, (error) -> bound ->\n                      if error\n                        cb new Meteor.Error 500, \"Can't append #{_path} to #{_source}\"\n                      else\n                        fs.unlink _path, NOOP\n                        if files.length <= 0\n                          fs.rename _source, path, (error) -> bound ->\n                            if error\n                              cb new Meteor.Error 500, \"Can't rename #{_source} to #{path}\"\n                            else\n                              finish cb\n                        else\n                          concatChunks ++num, files, cb\n\n          finish = (cb) ->\n            fs.chmod path, self.permissions, NOOP\n            result.type   = self.getMimeType opts.file\n            result.public = self.public\n\n            self.collection.insert _.clone(result), (error, _id) ->\n              if error\n                cb new Meteor.Error 500, error\n              else\n                result._id = _id\n                console.info \"[FilesCollection] [Write Method] [finish] #{fileName} -> #{path}\" if self.debug\n                self.onAfterUpload and self.onAfterUpload.call self, result\n                cb null, result\n          try\n            if opts.eof\n              if opts.fileLength > 1\n                fs.readdir self.storagePath, (error, files) -> bound ->\n                  if error\n                    cb new Meteor.Error 500, error\n                  else\n                    files = files.filter((f) -> !!~f.indexOf opts.fileId)\n                    if files.length is 1\n                      fs.rename \"#{self.storagePath}/#{files[0]}\", path, (error) -> bound ->\n                        if error\n                          cb new Meteor.Error 500, \"Can't rename #{self.storagePath}/#{files[0]} to #{path}\"\n                        else\n                          finish cb\n                    else\n                      concatChunks 2, files, cb\n              else\n                finish cb\n            else\n              if pathPart\n                _path = if opts.fileLength > 1 then \"#{pathName}_#{opts.chunkId - 1}#{extensionWithDot}\"\n                fs.stat _path, (error, stats) -> bound ->\n                  if error or not stats.isFile()\n                    fs.outputFile (pathPart or path), binary, 'binary', (error) -> bound -> \n                      cb error, result\n                  else\n                    fs.appendFile _path, binary, (error) -> bound -> \n                      fs.rename _path, \"#{pathName}_#{opts.chunkId}#{extensionWithDot}\", (error) -> bound -> \n                        cb error, result\n              else\n                fs.outputFile (pathPart or path), binary, 'binary', (error) -> bound -> cb error, result\n          catch e\n            cb e\n          return\n\n        if opts.eof\n          try\n            return Meteor.wrapAsync(action)()\n          catch e\n            console.warn \"[FilesCollection] [Write Method] Exception:\", e if self.debug\n            throw e\n        else\n          process.nextTick -> action NOOP\n          return result\n\n      _methods[self.methodNames.MeteorFileAbort] = (opts) ->\n        check opts, {\n          fileId: String\n          fileData: Object\n          fileLength: Number\n        }\n\n        ext  = \".#{opts.fileData.ext}\"\n        path = \"#{self.storagePath}/#{opts.fileId}\"\n\n        console.info \"[FilesCollection] [Abort Method]: For #{path}\" if self.debug\n        if opts.fileLength > 1\n          allowed = false\n          i = 0\n          while i <= opts.fileLength\n            _path = \"#{path}_#{i}#{ext}\"\n            fs.stat _path, ((error, stats) -> bound =>\n              if not error and stats.isFile()\n                allowed = true\n                fs.unlink @_path, NOOP\n            ).bind({_path})\n            i++\n          \n          Meteor.setTimeout ->\n            self.remove(opts.fileId) if allowed\n          , 250\n\n      Meteor.methods _methods\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name getMimeType\n  @param {Object} fileData - File Object\n  @summary Returns file's mime-type\n  @returns {String}\n  ###\n  getMimeType: (fileData) ->\n    check fileData, Object\n    mime = fileData.type if fileData?.type\n    if Meteor.isServer and fileData.path and (not mime or not _.isString mime)\n      try\n        buf = new Buffer 262\n        fd  = fs.openSync fileData.path, 'r'\n        br  = fs.readSync fd, buf, 0, 262, 0\n        fs.close fd, NOOP\n        buf = buf.slice 0, br if br < 262\n        {mime, ext} = fileType buf\n      catch error\n    if not mime or not _.isString mime\n      mime = 'application/octet-stream' \n    mime\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name getFileName\n  @param {Object} fileData - File Object\n  @summary Returns file's name\n  @returns {String}\n  ###\n  getFileName: (fileData) ->\n    fileName = fileData.name or fileData.fileName\n    if _.isString(fileName) and fileName.length > 0\n      cleanName = (str) -> str.replace(/\\.\\./g, '').replace /\\//g, ''\n      return cleanName(fileData.name or fileData.fileName)\n    else\n      return ''\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name getUser\n  @summary Returns object with `userId` and `user()` method which return user's object\n  @returns {Object}\n  ###\n  getUser: (http) ->\n    result = \n      user: -> return null\n      userId: null\n      \n    if Meteor.isServer\n      if http\n        cookie = http.request.Cookies\n        if _.has(Package, 'accounts-base') and cookie.has 'meteor_login_token'\n          user = Meteor.users.findOne 'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken cookie.get 'meteor_login_token'\n          if user\n            result.user = () -> return user\n            result.userId = user._id\n    else\n      if _.has(Package, 'accounts-base') and Meteor.userId()\n        result.user = -> return Meteor.user()\n        result.userId = Meteor.userId()\n\n    return result\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name getExt\n  @param {String} FileName - File name\n  @summary Get extension from FileName\n  @returns {Object}\n  ###\n  getExt: (fileName) ->\n    if !!~fileName.indexOf('.')\n      extension = fileName.split('.').pop()\n      return { ext: extension, extension, extensionWithDot: '.' + extension }\n    else\n      return { ext: '', extension: '', extensionWithDot: '' }\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name dataToSchema\n  @param {Object} data - File data\n  @summary Build object in accordance with schema from File data\n  @returns {Object}\n  ###\n  dataToSchema: (data) ->\n    return {\n      name:       data.name\n      extension:  data.extension\n      path:       data.path\n      meta:       data.meta\n      type:       data.type\n      size:       data.size\n      versions:\n        original:\n          path: data.path\n          size: data.size\n          type: data.type\n          extension: data.extension\n      isVideo: !!~data.type.toLowerCase().indexOf('video')\n      isAudio: !!~data.type.toLowerCase().indexOf('audio')\n      isImage: !!~data.type.toLowerCase().indexOf('image')\n      isText:  !!~data.type.toLowerCase().indexOf('text')\n      _prefix: data._prefix or @_prefix\n      _storagePath:    data._storagePath or @storagePath\n      _downloadRoute:  data._downloadRoute or @downloadRoute\n      _collectionName: data._collectionName or @collectionName\n    }\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name srch\n  @param {String|Object} search - Search data\n  @summary Build search object\n  @returns {Object}\n  ###\n  srch: (search) ->\n    if search and _.isString search\n      @search =\n        _id: search\n    else\n      @search = search or {}\n    @search\n\n  ###\n  @locus Server\n  @memberOf FilesCollection\n  @name write\n  @param {Buffer} buffer - Binary File's Buffer\n  @param {Object} opts - {fileName: '', type: '', size: 0, meta: {...}}\n  @param {Function} callback - function(error, fileObj){...}\n  @summary Write buffer to FS and add to FilesCollection Collection\n  @returns {Files} - Returns current FilesCollection instance\n  ###\n  write: if Meteor.isServer then (buffer, opts = {}, callback) ->\n    console.info \"[FilesCollection] [write()]\" if @debug\n    check opts, Match.Optional Object\n    check callback, Match.Optional Function\n\n    if @checkAccess()\n      randFileName  = @namingFunction()\n      fileName      = if opts.name or opts.fileName then opts.name or opts.fileName else randFileName\n\n      {extension, extensionWithDot} = @getExt fileName\n\n      path      = \"#{@storagePath}/#{randFileName}#{extensionWithDot}\"\n      \n      opts.type = @getMimeType opts\n      opts.meta = {} if not opts.meta\n      opts.size = buffer.length if not opts.size\n\n      result    = @dataToSchema\n        name:      fileName\n        path:      path\n        meta:      opts.meta\n        type:      opts.type\n        size:      opts.size\n        extension: extension\n\n      console.info \"[FilesCollection] [write]: #{fileName} -> #{@collectionName}\" if @debug\n\n      fs.outputFile path, buffer, 'binary', (error) -> bound ->\n        if error\n          callback and callback error\n        else\n          result._id = @collection.insert _.clone result\n          callback and callback null, result\n      \n      return @\n  else\n    undefined\n\n  ###\n  @locus Server\n  @memberOf FilesCollection\n  @name load\n  @param {String} url - URL to file\n  @param {Object} opts - {fileName: '', meta: {...}}\n  @param {Function} callback - function(error, fileObj){...}\n  @summary Download file, write stream to FS and add to FilesCollection Collection\n  @returns {Files} - Return this\n  ###\n  load: if Meteor.isServer then (url, opts = {}, callback) ->\n    console.info \"[FilesCollection] [load(#{url}, #{JSON.stringify(opts)}, callback)]\" if @debug\n    check url, String\n    check opts, Match.Optional Object\n    check callback, Match.Optional Function\n\n    self          = @\n    randFileName = @namingFunction()\n    fileName     = if opts.name or opts.fileName then opts.name or opts.fileName else randFileName\n    \n    {extension, extensionWithDot} = @getExt fileName\n    path      = \"#{@storagePath}/#{randFileName}#{extensionWithDot}\"\n    opts.meta = {} if not opts.meta\n\n    request.get(url).on('error', (error)-> bound ->\n      throw new Meteor.Error 500, \"Error on [load(#{url})]:\" + JSON.stringify error\n    ).on('response', (response) -> bound ->\n\n      console.info \"[FilesCollection] [load] Received: #{url}\" if self.debug\n\n      result = self.dataToSchema\n        name:      fileName\n        path:      path\n        meta:      opts.meta\n        type:      opts.type or response.headers['content-type']\n        size:      opts.size or response.headers['content-length']\n        extension: extension\n\n      self.collection.insert _.clone(result), (error, fileRef) ->\n        if error\n          console.warn \"[FilesCollection] [load] [insert] Error: #{fileName} -> #{self.collectionName}\", error if self.debug\n          callback and callback error\n        else\n          console.info \"[FilesCollection] [load] [insert] #{fileName} -> #{self.collectionName}\" if self.debug\n          callback and callback null, fileRef\n    ).pipe fs.createWriteStream(path, {flags: 'w'})\n\n    return @\n  else\n    undefined\n\n  ###\n  @locus Server\n  @memberOf FilesCollection\n  @name addFile\n  @param {String} path - Path to file\n  @param {String} path - Path to file\n  @summary Add file from FS to FilesCollection\n  @returns {Files} - Return this\n  ###\n  addFile: if Meteor.isServer then (path, opts = {}, callback) ->\n    console.info \"[FilesCollection] [addFile(#{path})]\" if @debug\n\n    throw new Meteor.Error 403, 'Can not run [addFile] on public collection! Just Move file to root of your server, then add record to Collection' if @public\n    check path, String\n    check opts, Match.Optional Object\n    check callback, Match.Optional Function\n\n    self = @\n    fs.stat path, (error, stats) -> bound ->\n      if error\n        callback and callback error\n      else if stats.isFile()\n        pathParts = path.split '/'\n        fileName  = pathParts[pathParts.length - 1]\n\n        {extension, extensionWithDot} = self.getExt fileName\n\n        opts.type = 'application/*' if not opts.type\n        opts.meta = {} if not opts.meta\n        opts.size = stats.size if not opts.size\n\n        result = self.dataToSchema\n          name:         fileName\n          path:         path\n          meta:         opts.meta\n          type:         opts.type\n          size:         opts.size\n          extension:    extension\n          _storagePath: path.replace \"/#{fileName}\", ''\n\n        _cn = self.collectionName\n        self.collection.insert _.clone(result), (error, record) ->\n          if error\n            console.warn \"[FilesCollection] [addFile] [insert] Error: #{fileName} -> #{_cn}\", error if self.debug\n            callback and callback error\n          else\n            console.info \"[FilesCollection] [addFile] [insert]: #{fileName} -> #{_cn}\" if self.debug\n            callback and callback null, result\n      else\n        callback and callback new Meteor.Error 400, \"[FilesCollection] [addFile(#{path})]: File does not exist\"\n\n    return @\n  else\n    undefined\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name findOne\n  @param {String|Object} search - `_id` of the file or `Object` like, {prop:'val'}\n  @summary Load file\n  @returns {Files} - Return this\n  ###\n  findOne: (search) ->\n    console.info \"[FilesCollection] [findOne(#{JSON.stringify(search)})]\" if @debug\n    check search, Match.Optional Match.OneOf Object, String\n    @srch search\n\n    if @checkAccess()\n      @currentFile = @collection.findOne @search\n      @cursor      = null\n    return @\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name find\n  @param {String|Object} search - `_id` of the file or `Object` like, {prop:'val'}\n  @summary Load file or bunch of files\n  @returns {Files} - Return this\n  ###\n  find: (search) ->\n    console.info \"[FilesCollection] [find(#{JSON.stringify(search)})]\" if @debug\n    check search, Match.Optional Match.OneOf Object, String\n    @srch search\n\n    if @checkAccess\n      @currentFile = null\n      @cursor = @collection.find @search\n    return @\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name get\n  @summary Return value of current cursor or file\n  @returns {Object|[Object]}\n  ###\n  get: () ->\n    console.info '[FilesCollection] [get()]' if @debug\n    return @cursor.fetch() if @cursor\n    return @currentFile\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name fetch\n  @summary Alias for `get()` method\n  @returns {[Object]}\n  ###\n  fetch: () ->\n    console.info '[FilesCollection] [fetch()]' if @debug\n    data = @get()\n    if not _.isArray data\n      return [data]\n    else\n      data\n\n  ###\n  @locus Client\n  @memberOf FilesCollection\n  @name insert\n  @see https://developer.mozilla.org/en-US/docs/Web/API/FileReader\n  @param {Object} config - Configuration object with next properties:\n    {File|Object} file           - HTML5 `files` item, like in change event: `e.currentTarget.files[0]`\n    {Object}      meta           - Additional data as object, use later for search\n    {Boolean}     allowWebWorkers- Allow/Deny WebWorkers usage\n    {Number|dynamic} streams     - Quantity of parallel upload streams, default: 2\n    {Number|dynamic} chunkSize   - Chunk size for upload\n    {Function}    onUploaded     - Callback triggered when upload is finished, with two arguments `error` and `fileRef`\n    {Function}    onError        - Callback triggered on error in upload and/or FileReader, with two arguments `error` and `fileData`\n    {Function}    onProgress     - Callback triggered when chunk is sent, with only argument `progress`\n    {Function}    onBeforeUpload - Callback triggered right before upload is started:\n        return true to continue\n        return false to abort upload\n  @summary Upload file to server over DDP\n  @returns {Object} with next properties:\n    {ReactiveVar} onPause  - Is upload process on the pause?\n    {ReactiveVar} state    - active|paused|aborted|completed\n    {ReactiveVar} progress - Current progress in percentage\n    {Function}    pause    - Pause upload process\n    {Function}    continue - Continue paused upload process\n    {Function}    toggle   - Toggle continue/pause if upload process\n    {Function}    abort    - Abort upload\n    {Function}    readAsDataURL - Current file as data URL, use to create image preview and etc. Be aware of big files, may lead to browser crash\n  ###\n  insert: if Meteor.isClient then (config) ->\n    if @checkAccess()\n      return (new @_UploadInstance(config, @)).start()\n    else\n      throw new Meteor.Error 401, \"[FilesCollection] [insert] Access Denied\"\n  else undefined\n\n  ###\n  @locus Client\n  @memberOf FilesCollection\n  @name _UploadInstance\n  @class UploadInstance\n  @summary Internal Class, used in upload\n  ###\n  _UploadInstance: if Meteor.isClient then class UploadInstance\n    constructor: (@config, @collection) ->\n      console.info '[FilesCollection] [insert()]' if @collection.debug\n      self                     = @\n      @config.meta            ?= {}\n      @config.streams         ?= 2\n      @config.streams          = 2 if @config.streams < 1\n      @config.chunkSize       ?= @collection.chunkSize\n      @config.allowWebWorkers ?= true\n\n      check @config, {\n        file:            Match.Any\n        meta:            Match.Optional Object\n        onError:         Match.Optional Function\n        onAbort:         Match.Optional Function\n        streams:         Match.OneOf 'dynamic', Number\n        chunkSize:       Match.OneOf 'dynamic', Number\n        onUploaded:      Match.Optional Function\n        onProgress:      Match.Optional Function\n        onBeforeUpload:  Match.Optional Function\n        allowWebWorkers: Boolean\n      }\n\n      if @config.file\n        console.time('insert ' + @config.file.name) if @collection.debug\n        console.time('loadFile ' + @config.file.name) if @collection.debug\n\n        if Worker and @config.allowWebWorkers\n          @worker = new Worker '/packages/ostrio_files/worker.js'\n        else\n          @worker = null\n\n        @trackerComp  = null\n        @currentChunk = 0\n        @sentChunks   = 0\n        @EOFsent      = false\n        @transferTime = 0\n        @fileLength = 1\n        @fileId     = @collection.namingFunction()\n        @fileData   =\n          size: @config.file.size\n          type: @config.file.type\n          name: @config.file.name\n\n        @fileData = _.extend @fileData, @collection.getExt(self.config.file.name), {mime: @collection.getMimeType(@fileData)}\n        @fileData['mime-type'] = @fileData.mime\n\n        @result = new @collection._FileUpload _.extend self.config, {@fileData, @fileId, MeteorFileAbort: @collection.methodNames.MeteorFileAbort}\n\n        @beforeunload = (e) ->\n          message = if _.isFunction(self.onbeforeunloadMessage) then self.onbeforeunloadMessage.call(@result, @fileData) else self.onbeforeunloadMessage\n          e.returnValue = message if e\n          return message\n        @result.config.beforeunload = @beforeunload\n        window.addEventListener 'beforeunload', @beforeunload, false\n\n        @calculateStats = _.throttle ->\n          _t = (self.transferTime / self.sentChunks) / self.config.streams\n          self.result.estimateTime.set (_t * (self.fileLength - self.sentChunks))\n          self.result.estimateSpeed.set (self.config.chunkSize / (_t / 1000))\n          progress = Math.round((self.sentChunks / self.fileLength) * 100)\n          self.result.progress.set progress\n          self.config.onProgress and self.config.onProgress.call self.result, progress, self.fileData\n          return\n        , 250\n\n        @_onEnd = ->\n          self.worker.terminate() if self.worker\n          self.trackerComp.stop() if self.trackerComp\n          window.removeEventListener('beforeunload', self.beforeunload, false) if self.beforeunload\n          self.result.progress.set(0) if self.result\n        @result.config._onEnd = @_onEnd\n      else\n        throw new Meteor.Error 500, \"[FilesCollection] [insert] Have you forget to pass a File itself?\"\n\n    end: (error, data) ->\n      console.timeEnd('insert ' + @config.file.name) if @collection.debug\n      @_onEnd()\n      @config.onUploaded and @config.onUploaded.call @result, error, data\n      if error\n        console.warn \"[FilesCollection] [insert] [end] Error: \", error if @collection.debug\n        @result.state.set 'aborted'\n        @config.onError and @config.onError.call @result, error, @fileData\n      else\n        @result.state.set 'completed'\n      return @result\n\n    sendViaDDP: (evt) -> Meteor.defer =>\n      self = @\n      console.timeEnd('loadFile ' + @config.file.name) if @collection.debug\n      opts =\n        file:       @fileData\n        fileId:     @fileId\n        binData:    evt.data.bin\n        chunkId:    evt.data.chunkId\n        fileLength: @fileLength\n\n      if opts.binData and opts.binData.length\n        Meteor.call @collection.methodNames.MeteorFileWrite, opts, (error) ->\n          ++self.sentChunks\n          self.transferTime += (+new Date) - evt.data.start\n          if error\n            self.end error\n          else\n            if self.sentChunks >= self.fileLength\n              self.sendEOF opts\n            else if self.currentChunk < self.fileLength\n              self.upload()\n            self.calculateStats()\n          return\n      else\n        @sendEOF opts\n      return\n\n    sendEOF: (opts) -> Meteor.defer =>\n      unless @EOFsent\n        @EOFsent = true\n        self = @\n        opts =\n          eof:        true\n          meta:       @config.meta\n          file:       @fileData\n          fileId:     @fileId\n          fileLength: @fileLength\n        Meteor.call @collection.methodNames.MeteorFileWrite, opts, -> self.end.apply self, arguments\n      return\n\n    proceedChunk: (chunkId, start) ->\n      self       = @\n      chunk      = @config.file.slice (@config.chunkSize * (chunkId - 1)), (@config.chunkSize * chunkId)\n      fileReader = new FileReader\n\n      fileReader.onloadend = (evt) ->\n        self.sendViaDDP data: \n          bin: (fileReader?.result or evt.srcElement?.result or evt.target?.result).split(',')[1]\n          chunkId: chunkId\n          start: start\n        return\n      fileReader.onerror = (e) ->\n        self.result.abort()\n        self.config.onError and self.config.onError.call self.result, (e.target or e.srcElement).error, self.fileData\n        return\n\n      fileReader.readAsDataURL chunk\n      return\n\n    upload: -> \n      start = +new Date\n      if @result.onPause.get()\n        self = @\n        @result.continueFunc = -> self.createStreams()\n        return\n\n      if @result.state.get() is 'aborted'\n        return @\n\n      ++@currentChunk\n      if @worker\n        @worker.postMessage({@sentChunks, start, @currentChunk, chunkSize: @config.chunkSize, file: @config.file})\n      else\n        @proceedChunk @currentChunk, start\n      return\n\n    createStreams: ->\n      i = 1\n      self = @\n      while i <= @config.streams\n        Meteor.defer -> self.upload()\n        i++\n      return\n\n    prepare: ->\n      self = @\n      if @config.chunkSize is 'dynamic'\n        if @config.file.size >= 104857600\n          @config.chunkSize = 1048576\n        else if @config.file.size >= 52428800\n          @config.chunkSize = 524288\n        else\n          @config.chunkSize = 262144\n      \n      _len = Math.ceil(@config.file.size / @config.chunkSize)\n      if @config.streams is 'dynamic'\n        @config.streams = _.clone _len\n        @config.streams = 32 if @config.streams > 32\n\n      @fileLength               = if _len <= 0 then 1 else _len\n      @config.streams           = @fileLength if @config.streams > @fileLength\n      @result.config.fileLength = @fileLength\n      Meteor.defer -> self.createStreams()\n      return\n\n    start: ->\n      self = @\n      if @config.onBeforeUpload and _.isFunction @config.onBeforeUpload\n        isUploadAllowed = @config.onBeforeUpload.call @result, @fileData\n        if isUploadAllowed isnt true\n          return @end new Meteor.Error(403, if _.isString(isUploadAllowed) then isUploadAllowed else 'config.onBeforeUpload() returned false'), null\n\n      if @collection.onBeforeUpload and _.isFunction @collection.onBeforeUpload\n        isUploadAllowed = @collection.onBeforeUpload.call @result, @fileData\n        if isUploadAllowed isnt true\n          return @end new Meteor.Error(403, if _.isString(isUploadAllowed) then isUploadAllowed else 'collection.onBeforeUpload() returned false'), null\n\n      Tracker.autorun (computation) ->\n        self.trackerComp = computation\n        unless self.result.onPause.get()\n          if Meteor.status().connected\n            self.result.continue()\n            console.info '[FilesCollection] [insert] [Tracker] [continue]' if self.collection.debug\n          else\n            self.result.pause()\n            console.info '[FilesCollection] [insert] [Tracker] [pause]' if self.collection.debug\n        return\n\n      if @worker\n        @worker.onmessage = (evt) ->\n          if evt.data.error\n            console.warn evt.data.error if self.collection.debug\n            self.proceedChunk evt.data.chunkId, evt.data.start\n          else\n            self.sendViaDDP evt\n          return\n        @worker.onerror   = (e) -> \n          self.end e.message\n          return\n\n      if @collection.debug\n        if @worker\n          console.info \"[FilesCollection] [insert] using WebWorkers\"\n        else\n          console.info \"[FilesCollection] [insert] using MainThread\"\n\n      Meteor.defer -> self.prepare()\n      return @result\n  else undefined\n\n  ###\n  @locus Client\n  @memberOf FilesCollection\n  @name _FileUpload\n  @class FileUpload\n  @summary Internal Class, instance of this class is returned from `insert()` method\n  ###\n  _FileUpload: if Meteor.isClient then class FileUpload\n    constructor: (@config) ->\n      @file          = _.extend @config.file, @config.fileData\n      @state         = new ReactiveVar 'active'\n      @onPause       = new ReactiveVar false\n      @progress      = new ReactiveVar 0\n      @estimateTime  = new ReactiveVar 1000\n      @estimateSpeed = new ReactiveVar 0\n    continueFunc:  -> return\n    pause: ->\n      unless @onPause.get()\n        @onPause.set true\n        @state.set 'paused'\n      return\n    continue: ->\n      if @onPause.get()\n        @onPause.set false\n        @state.set 'active'\n        @continueFunc.call()\n        @continueFunc = -> return\n      return\n    toggle: ->\n      if @onPause.get() then @continue() else @pause()\n      return\n    abort: ->\n      window.removeEventListener 'beforeunload', @config.beforeunload, false\n      @config.onAbort and @config.onAbort.call @, @fileData\n      @pause()\n      @config._onEnd()\n      @state.set 'aborted'\n      console.timeEnd('insert ' + @config.file.name) if @config.debug\n      Meteor.call @config.MeteorFileAbort, {fileId: @config.fileId, fileLength: @config.fileLength, fileData: @config.fileData}\n      return\n  else undefined\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name remove\n  @param {String|Object} search - `_id` of the file or `Object` like, {prop:'val'}\n  @summary Remove file(s) on cursor or find and remove file(s) if search is set\n  @returns {undefined}\n  ###\n  remove: (search) ->\n    console.info \"[FilesCollection] [remove(#{JSON.stringify(search)})]\" if @debug\n    check search, Match.Optional Match.OneOf Object, String\n\n    if @checkAccess()\n      @srch search\n      if Meteor.isClient\n        Meteor.call @methodNames.MeteorFileUnlink, rcp(@)\n\n      if Meteor.isServer\n        files = @collection.find @search\n        if files.count() > 0\n          self = @\n          files.forEach (file) -> self.unlink file\n        @collection.remove @search\n    return @\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name update\n  @see http://docs.meteor.com/#/full/update\n  @summary link Mongo.Collection update method\n  @returns {Mongo.Collection} Instance\n  ###\n  update: ->\n    @collection.update.apply @collection, arguments\n    return @collection\n\n  ###\n  @locus Server\n  @memberOf FilesCollection\n  @name deny\n  @name allow\n  @param {Object} rules\n  @see http://docs.meteor.com/#/full/allow\n  @summary link Mongo.Collection allow/deny methods\n  @returns {Mongo.Collection} Instance\n  ###\n  deny: if Meteor.isServer then (rules) ->\n    @collection.deny rules\n    return @collection\n  else undefined\n  allow: if Meteor.isServer then (rules) ->\n    @collection.allow rules\n    return @collection\n  else undefined\n\n  ###\n  @locus Server\n  @memberOf FilesCollection\n  @name denyClient\n  @name allowClient\n  @see http://docs.meteor.com/#/full/allow\n  @summary Shorthands for Mongo.Collection allow/deny methods\n  @returns {Mongo.Collection} Instance\n  ###\n  denyClient: if Meteor.isServer then ->\n    @collection.deny\n      insert: -> true\n      update: -> true\n      remove: -> true\n    return @collection\n  else undefined\n  allowClient: if Meteor.isServer then ->\n    @collection.allow\n      insert: -> true\n      update: -> true\n      remove: -> true\n    return @collection\n  else undefined\n\n\n  ###\n  @locus Server\n  @memberOf FilesCollection\n  @name unlink\n  @param {Object} file - fileObj\n  @summary Unlink files and it's versions from FS\n  @returns {undefined}\n  ###\n  unlink: if Meteor.isServer then (file) ->\n    console.info \"[FilesCollection] [unlink(#{file._id})]\" if @debug\n    if file.versions and not _.isEmpty file.versions\n      _.each file.versions, (version) -> bound ->\n        fs.unlink version.path, NOOP\n    fs.unlink file.path, NOOP\n    return @\n  else undefined\n\n  ###\n  @locus Server\n  @memberOf FilesCollection\n  @name _404\n  @summary Internal method, used to return 404 error\n  ###\n  _404: if Meteor.isServer then (http) ->\n    console.warn \"[FilesCollection] [download(#{http.request.originalUrl})] [_404] File not found\" if @debug\n    text = 'File Not Found :('\n    http.response.writeHead 404,\n      'Content-Length': text.length\n      'Content-Type':   'text/plain'\n    http.response.end text\n    return\n  else undefined\n\n  ###\n  @locus Server\n  @memberOf FilesCollection\n  @name download\n  @param {Object|Files} self - Instance of FilesCollection\n  @summary Initiates the HTTP response\n  @returns {undefined}\n  ###\n  download: if Meteor.isServer then (http, version = 'original') ->\n    console.info \"[FilesCollection] [download(#{http.request.originalUrl}, #{version})]\" if @debug\n    responseType = '200'\n    if @currentFile\n      if _.has(@currentFile, 'versions') and _.has @currentFile.versions, version\n        fileRef = @currentFile.versions[version]\n      else\n        fileRef = @currentFile\n    else\n      fileRef = false\n\n    if not fileRef or not _.isObject(fileRef)\n      return @_404 http\n    else if @currentFile\n      self = @\n\n      if @interceptDownload and _.isFunction @interceptDownload\n        _idres = @interceptDownload http, @currentFile\n        if _idres is true\n          return\n\n      if @downloadCallback\n        unless @downloadCallback.call _.extend(http, @getUser(http)), @currentFile\n          return @_404 http\n\n      fs.stat fileRef.path, (statErr, stats) -> bound ->\n        if statErr or not stats.isFile()\n          return self._404 http\n\n        fileRef.size = stats.size if stats.size isnt fileRef.size and not self.integrityCheck\n        responseType = '400' if stats.size isnt fileRef.size and self.integrityCheck\n        partiral     = false\n        reqRange     = false\n\n        if http.params.query.download and http.params.query.download == 'true'\n          dispositionType = 'attachment; '\n        else\n          dispositionType = 'inline; '\n\n        dispositionName     = \"filename=\\\"#{encodeURIComponent(self.currentFile.name)}\\\"; filename=*UTF-8\\\"#{encodeURIComponent(self.currentFile.name)}\\\"; \"\n        dispositionEncoding = 'charset=utf-8'\n\n        http.response.setHeader 'Content-Type', fileRef.type\n        http.response.setHeader 'Content-Disposition', dispositionType + dispositionName + dispositionEncoding\n        http.response.setHeader 'Accept-Ranges', 'bytes'\n        http.response.setHeader 'Last-Modified', self.currentFile?.updatedAt?.toUTCString() if self.currentFile?.updatedAt?.toUTCString()\n        http.response.setHeader 'Connection', 'keep-alive'\n\n        if http.request.headers.range\n          partiral = true\n          array    = http.request.headers.range.split /bytes=([0-9]*)-([0-9]*)/\n          start    = parseInt array[1]\n          end      = parseInt array[2]\n          if isNaN(end)\n            end    = fileRef.size - 1\n          take     = end - start\n        else\n          start    = 0\n          end      = fileRef.size - 1\n          take     = fileRef.size\n\n        if partiral or (http.params.query.play and http.params.query.play == 'true')\n          reqRange = {start, end}\n          if isNaN(start) and not isNaN end\n            reqRange.start = end - take\n            reqRange.end   = end\n          if not isNaN(start) and isNaN end\n            reqRange.start = start\n            reqRange.end   = start + take\n\n          reqRange.end = fileRef.size - 1 if ((start + take) >= fileRef.size)\n          http.response.setHeader 'Pragma', 'private'\n          http.response.setHeader 'Expires', new Date(+new Date + 1000*32400).toUTCString()\n          http.response.setHeader 'Cache-Control', 'private, maxage=10800, s-maxage=32400'\n\n          if self.strict and (reqRange.start >= (fileRef.size - 1) or reqRange.end > (fileRef.size - 1))\n            responseType = '416'\n          else\n            responseType = '206'\n        else\n          http.response.setHeader 'Cache-Control', self.cacheControl\n          responseType = '200'\n\n        streamErrorHandler = (error) ->\n          http.response.writeHead 500\n          http.response.end error.toString()\n\n        switch responseType\n          when '400'\n            console.warn \"[FilesCollection] [download(#{fileRef.path}, #{version})] [400] Content-Length mismatch!\" if self.debug\n            text = 'Content-Length mismatch!'\n            http.response.writeHead 400,\n              'Content-Type':   'text/plain'\n              'Cache-Control':  'no-cache'\n              'Content-Length': text.length\n            http.response.end text\n            break\n          when '404'\n            return self._404 http\n            break\n          when '416'\n            console.info \"[FilesCollection] [download(#{fileRef.path}, #{version})] [416] Content-Range is not specified!\" if self.debug\n            http.response.writeHead 416,\n              'Content-Range': \"bytes */#{fileRef.size}\"\n            http.response.end()\n            break\n          when '200'\n            console.info \"[FilesCollection] [download(#{fileRef.path}, #{version})] [200]\" if self.debug\n            stream = fs.createReadStream fileRef.path\n            stream.on('open', =>\n              http.response.writeHead 200\n              if self.throttle\n                stream.pipe( new Throttle {bps: self.throttle, chunksize: self.chunkSize}\n                ).pipe http.response\n              else\n                stream.pipe http.response\n            ).on 'error', streamErrorHandler\n            break\n          when '206'\n            console.info \"[FilesCollection] [download(#{fileRef.path}, #{version})] [206]\" if self.debug\n            http.response.setHeader 'Content-Range', \"bytes #{reqRange.start}-#{reqRange.end}/#{fileRef.size}\"\n            http.response.setHeader 'Trailer', 'expires'\n            http.response.setHeader 'Transfer-Encoding', 'chunked'\n            if self.throttle\n              stream = fs.createReadStream fileRef.path, {start: reqRange.start, end: reqRange.end}\n              stream.on('open', -> http.response.writeHead 206\n              ).on('error', streamErrorHandler\n              ).on('end', -> http.response.end()\n              ).pipe( new Throttle {bps: self.throttle, chunksize: self.chunkSize}\n              ).pipe http.response\n            else\n              stream = fs.createReadStream fileRef.path, {start: reqRange.start, end: reqRange.end}\n              stream.on('open', -> http.response.writeHead 206\n              ).on('error', streamErrorHandler\n              ).on('end', -> http.response.end()\n              ).pipe http.response\n            break\n      return\n    else\n      return @_404 http\n  else undefined\n\n  ###\n  @locus Anywhere\n  @memberOf FilesCollection\n  @name link\n  @param {Object}   fileRef - File reference object\n  @param {String}   version - [Optional] Version of file you would like to request\n  @param {Boolean}  pub     - [Optional] is file located in publicity available folder?\n  @summary Returns downloadable URL\n  @returns {String} Empty string returned in case if file not found in DB\n  ###\n  link: (fileRef, version = 'original', pub = false) ->\n    console.info '[FilesCollection] [link()]' if @debug\n    if _.isString fileRef\n      version = fileRef\n      fileRef = null\n    return '' if not fileRef and not @currentFile\n    return formatFleURL (fileRef or @currentFile), version, @public\n\n###\n@locus Anywhere\n@private\n@name formatFleURL\n@param {Object} fileRef - File reference object\n@param {String} version - [Optional] Version of file you would like build URL for\n@param {Boolean}  pub   - [Optional] is file located in publicity available folder?\n@summary Returns formatted URL for file\n@returns {String}\n###\nformatFleURL = (fileRef, version = 'original') ->\n  root = __meteor_runtime_config__.ROOT_URL.replace(/\\/+$/, '')\n\n  if fileRef?.extension?.length > 0\n    ext = '.' + fileRef.extension\n  else\n    ext = ''\n\n  if fileRef.public is true\n    return root + (if version is 'original' then \"#{fileRef._downloadRoute}/#{fileRef._id}#{ext}\" else \"#{fileRef._downloadRoute}/#{version}-#{fileRef._id}#{ext}\")\n  else\n    return root + \"#{fileRef._downloadRoute}/#{fileRef._collectionName}/#{fileRef._id}/#{version}/#{fileRef._id}#{ext}\"\n\nif Meteor.isClient\n  ###\n  @locus Client\n  @TemplateHelper\n  @name fileURL\n  @param {Object} fileRef - File reference object\n  @param {String} version - [Optional] Version of file you would like to request\n  @summary Get download URL for file by fileRef, even without subscription\n  @example {{fileURL fileRef}}\n  @returns {String}\n  ###\n  Template.registerHelper 'fileURL', (fileRef, version) ->\n    return undefined if not fileRef or not _.isObject fileRef\n    version = if not version or not _.isString(version) then 'original' else version\n    if fileRef._id\n      return formatFleURL fileRef, version\n    else\n      return ''\n\nMeteor.Files = FilesCollection"]}