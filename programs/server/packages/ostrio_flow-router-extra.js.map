{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/router.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/group.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/route.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/_init.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/lib/router.js"],"names":["Qs","require","pathRegExp","Router","_routes","_routesMap","subscriptions","Function","prototype","_onRouteCallbacks","route","pathDef","options","test","Error","Route","push","name","_triggerRouteRegister","group","Group","path","fields","queryParams","replace","key","firstRegexpChar","indexOf","substring","undefined","match","strQueryParams","stringify","onRouteRegister","cb","currentRoute","routePublicApi","_","pick","omit","each","go","current","triggers","enter","exit","middleware","getState","getAllStates","setState","removeState","clearStates","ready","initialize","wait","makeTriggers","base","isArray","concat","router","parent","prefix","_router","_triggersEnter","triggersEnter","_triggersExit","triggersExit","action","_subsMap","register","sub","subscription","module","export","FlowRouter","url","Meteor","absoluteUrl","apply","arguments","RegExp","_basePath","startup","Package"],"mappings":"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","file":"/packages/ostrio_flow-router-extra.js","sourcesContent":["const Qs = require('qs');\nconst pathRegExp = /(:[\\w\\(\\)\\\\\\+\\*\\.\\?\\[\\]\\-]+)+/g;\n\nRouter = function () {\n  this._routes = [];\n  this._routesMap = {};\n  this.subscriptions = Function.prototype;\n\n  // holds onRoute callbacks\n  this._onRouteCallbacks = [];\n};\n\nRouter.prototype.route = function(pathDef, options = {}) {\n  if (!/^\\/.*/.test(pathDef)) {\n    throw new Error('route\\'s path must start with \"/\"');\n  }\n\n  const route = new Route(this, pathDef, options);\n  this._routes.push(route);\n\n  if (options.name) {\n    this._routesMap[options.name] = route;\n  }\n\n  this._triggerRouteRegister(route);\n  return route;\n};\n\nRouter.prototype.group = function(options) {\n  return new Group(this, options);\n};\n\nRouter.prototype.path = function(pathDef, fields = {}, queryParams) {\n  if (this._routesMap[pathDef]) {\n    pathDef = this._routesMap[pathDef].path;\n  }\n\n  let path = pathDef.replace(pathRegExp, (key) => {\n    const firstRegexpChar = key.indexOf('(');\n    // get the content behind : and (\\\\d+/)\n    key = key.substring(1, (firstRegexpChar > 0) ? firstRegexpChar : undefined);\n    // remove +?*\n    key = key.replace(/[\\+\\*\\?]+/g, '');\n\n    return fields[key] || '';\n  });\n\n  path = path.replace(/\\/\\/+/g, '/'); // Replace multiple slashes with single slash\n\n  // remove trailing slash\n  // but keep the root slash if it's the only one\n  path = path.match(/^\\/{1}$/) ? path : path.replace(/\\/$/, '');\n\n  const strQueryParams = Qs.stringify(queryParams || {});\n  if(strQueryParams) {\n    path += '?' + strQueryParams;\n  }\n\n  return path;\n};\n\nRouter.prototype.onRouteRegister = function(cb) {\n  this._onRouteCallbacks.push(cb);\n};\n\nRouter.prototype._triggerRouteRegister = function(currentRoute) {\n  // We should only need to send a safe set of fields on the route\n  // object.\n  // This is not to hide what's inside the route object, but to show\n  // these are the public APIs\n  const routePublicApi = _.pick(currentRoute, 'name', 'pathDef', 'path');\n  routePublicApi.options = _.omit(currentRoute.options, ['triggersEnter', 'triggersExit', 'action', 'subscriptions', 'name']);\n\n  _.each(this._onRouteCallbacks, function(cb) {\n    cb(routePublicApi);\n  });\n};\n\n\nRouter.prototype.go = function() {\n  // client only\n};\n\n\nRouter.prototype.current = function() {\n  // client only\n};\n\n\nRouter.prototype.triggers = {\n  enter() {\n    // client only\n  },\n  exit() {\n    // client only\n  }\n};\n\nRouter.prototype.middleware = function() {\n  // client only\n};\n\n\nRouter.prototype.getState = function() {\n  // client only\n};\n\n\nRouter.prototype.getAllStates = function() {\n  // client only\n};\n\n\nRouter.prototype.setState = function() {\n  // client only\n};\n\n\nRouter.prototype.removeState = function() {\n  // client only\n};\n\n\nRouter.prototype.clearStates = function() {\n  // client only\n};\n\n\nRouter.prototype.ready = function() {\n  // client only\n};\n\n\nRouter.prototype.initialize = function() {\n  // client only\n};\n\nRouter.prototype.wait = function() {\n  // client only\n};\n","const makeTriggers = (base, triggers) => {\n  if (triggers) {\n    if (!_.isArray(triggers)) {\n      triggers = [triggers];\n    }\n  } else {\n    triggers = [];\n  }\n\n  return (base || []).concat(triggers);\n};\n\nGroup = function(router, options = {}, parent) {\n  if (options.prefix && !/^\\/.*/.test(options.prefix)) {\n    throw new Error('group\\'s prefix must start with \"/\"');\n  }\n\n  this._router = router;\n  this.prefix = options.prefix || '';\n  this.name = options.name;\n  this.options = options;\n\n  this._triggersEnter = makeTriggers(this._triggersEnter, options.triggersEnter);\n  this._triggersExit = makeTriggers(this._triggersExit, options.triggersExit);\n\n  this.parent = parent;\n  if (this.parent) {\n    this.prefix = parent.prefix + this.prefix;\n\n    this._triggersEnter = makeTriggers(this._triggersEnter, parent.triggersEnter);\n    this._triggersExit = makeTriggers(this._triggersExit, parent.triggersExit);\n  }\n};\n\nGroup.prototype.route = function(pathDef, options = {}, group) {\n  if (!/^\\/.*/.test(pathDef)) {\n    throw new Error('route\\'s path must start with \"/\"');\n  }\n\n  group = group || this;\n  pathDef = this.prefix + pathDef;\n\n  options.triggersEnter = makeTriggers(this._triggersEnter, options.triggersEnter);\n  options.triggersExit = makeTriggers(this._triggersExit, options.triggersExit);\n\n  return this._router.route(pathDef, options, group);\n};\n\nGroup.prototype.group = function(options) {\n  const group = new Group(this._router, options, this);\n  group.parent = this;\n\n  return group;\n};\n","Route = function(router, pathDef, options = {}) {\n  this.options = options;\n  this.name = options.name;\n  this.pathDef = pathDef;\n\n  // Route.path is deprecated and will be removed in 3.0\n  this.path = pathDef;\n\n  this.action = options.action || Function.prototype;\n  this.subscriptions = options.subscriptions || Function.prototype;\n  this._subsMap = {};\n};\n\n\nRoute.prototype.register = function(name, sub) {\n  this._subsMap[name] = sub;\n};\n\n\nRoute.prototype.subscription = function(name) {\n  return this._subsMap[name];\n};\n\n\nRoute.prototype.middleware = function() {\n  // ?\n};\n","// Export Router Instance\nFlowRouter = new Router();\nFlowRouter.Router = Router;\nFlowRouter.Route = Route;\n\nexport { FlowRouter };\n","Router.prototype.url = function() {\n  // We need to remove the leading base path, or \"/\", as it will be inserted\n  // automatically by `Meteor.absoluteUrl` as documented in:\n  // http://docs.meteor.com/#/full/meteor_absoluteurl\n  return Meteor.absoluteUrl(this.path.apply(this, arguments).replace(new RegExp('^' + ('/' + (this._basePath || '') + '/').replace(/\\/\\/+/g, \"/\")), ''));\n};\n\nMeteor.startup(() => {\n  Package['kadira:flow-router'] = Package['ostrio:flow-router-extra'];\n});\n"]}