{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/router.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/group.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/route.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/_init.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/lib/router.js"],"names":["Qs","require","Router","_routes","_routesMap","subscriptions","Function","prototype","_onRouteCallbacks","route","pathDef","options","test","message","Error","Route","push","name","_triggerRouteRegister","group","Group","path","fields","queryParams","regExp","replace","key","firstRegexpChar","indexOf","substring","undefined","match","strQueryParams","stringify","onRouteRegister","cb","currentRoute","routePublicApi","_","pick","omittingOptionFields","omit","each","go","current","triggers","enter","exit","middleware","getState","getAllStates","setState","removeState","clearStates","ready","initialize","wait","router","prefix","_router","parent","action","_subsMap","register","sub","subscription","FlowRouter","url","completePath","apply","arguments","basePath","_basePath","pathWithoutBase","RegExp","Meteor","absoluteUrl","startup","Package"],"mappings":"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","file":"/packages/ostrio_flow-router-extra.js","sourcesContent":["var Qs = require('qs');\n\nRouter = function () {\n  this._routes = [];\n  this._routesMap = {};\n  this.subscriptions = Function.prototype;\n\n  // holds onRoute callbacks\n  this._onRouteCallbacks = [];\n};\n\nRouter.prototype.route = function(pathDef, options) {\n  if (!/^\\/.*/.test(pathDef)) {\n    var message = \"route's path must start with '/'\";\n    throw new Error(message);\n  }\n  \n  options = options || {};\n  var route = new Route(this, pathDef, options);\n  this._routes.push(route);\n\n  if (options.name) {\n    this._routesMap[options.name] = route;\n  }\n\n  this._triggerRouteRegister(route);\n  return route;\n};\n\nRouter.prototype.group = function(options) {\n  return new Group(this, options);\n};\n\nRouter.prototype.path = function(pathDef, fields, queryParams) {\n  if (this._routesMap[pathDef]) {\n    pathDef = this._routesMap[pathDef].path;\n  }\n\n  fields = fields || {};\n  var regExp = /(:[\\w\\(\\)\\\\\\+\\*\\.\\?]+)+/g;\n  var path = pathDef.replace(regExp, function(key) {\n    var firstRegexpChar = key.indexOf(\"(\");\n    // get the content behind : and (\\\\d+/)\n    key = key.substring(1, (firstRegexpChar > 0)? firstRegexpChar: undefined);\n    // remove +?*\n    key = key.replace(/[\\+\\*\\?]+/g, \"\");\n\n    return fields[key] || \"\";\n  });\n\n  path = path.replace(/\\/\\/+/g, \"/\"); // Replace multiple slashes with single slash\n\n  // remove trailing slash\n  // but keep the root slash if it's the only one\n  path = path.match(/^\\/{1}$/) ? path: path.replace(/\\/$/, \"\");\n\n  var strQueryParams = Qs.stringify(queryParams || {});\n  if(strQueryParams) {\n    path += \"?\" + strQueryParams;\n  }\n\n  return path;\n};\n\nRouter.prototype.onRouteRegister = function(cb) {\n  this._onRouteCallbacks.push(cb);\n};\n\nRouter.prototype._triggerRouteRegister = function(currentRoute) {\n  // We should only need to send a safe set of fields on the route\n  // object.\n  // This is not to hide what's inside the route object, but to show \n  // these are the public APIs\n  var routePublicApi = _.pick(currentRoute, 'name', 'pathDef', 'path');\n  var omittingOptionFields = [\n    'triggersEnter', 'triggersExit', 'action', 'subscriptions', 'name'\n  ];\n  routePublicApi.options = _.omit(currentRoute.options, omittingOptionFields);\n\n  _.each(this._onRouteCallbacks, function(cb) {\n    cb(routePublicApi);\n  });\n};\n\n\nRouter.prototype.go = function() {\n  // client only\n};\n\n\nRouter.prototype.current = function() {\n  // client only\n};\n\n\nRouter.prototype.triggers = {\n  enter: function() {\n    // client only\n  },\n  exit: function() {\n    // client only\n  }\n};\n\nRouter.prototype.middleware = function() {\n  // client only\n};\n\n\nRouter.prototype.getState = function() {\n  // client only\n};\n\n\nRouter.prototype.getAllStates = function() {\n  // client only\n};\n\n\nRouter.prototype.setState = function() {\n  // client only\n};\n\n\nRouter.prototype.removeState = function() {\n  // client only\n};\n\n\nRouter.prototype.clearStates = function() {\n  // client only\n};\n\n\nRouter.prototype.ready = function() {\n  // client only\n};\n\n\nRouter.prototype.initialize = function() {\n  // client only\n};\n\nRouter.prototype.wait = function() {\n  // client only\n};\n","Group = function(router, options) {\n  options = options || {};\n  this.prefix = options.prefix || '';\n  this.options = options;\n  this._router = router;\n};\n\nGroup.prototype.route = function(pathDef, options) {\n  pathDef = this.prefix + pathDef;\n  return this._router.route(pathDef, options);\n};\n\nGroup.prototype.group = function(options) {\n  var group = new Group(this._router, options);\n  group.parent = this;\n\n  return group;\n};\n","Route = function(router, pathDef, options) {\n  options = options || {};\n  this.options = options;\n  this.name = options.name;\n  this.pathDef = pathDef;\n\n  // Route.path is deprecated and will be removed in 3.0\n  this.path = pathDef;\n\n  this.action = options.action || Function.prototype;\n  this.subscriptions = options.subscriptions || Function.prototype;\n  this._subsMap = {};\n};\n\n\nRoute.prototype.register = function(name, sub, options) {\n  this._subsMap[name] = sub;\n};\n\n\nRoute.prototype.subscription = function(name) {\n  return this._subsMap[name];\n};\n\n\nRoute.prototype.middleware = function(middleware) {\n \n};\n","// Export Router Instance\nFlowRouter = new Router();\nFlowRouter.Router = Router;\nFlowRouter.Route = Route;\n\nexport { FlowRouter };","Router.prototype.url = function() {\n  // We need to remove the leading base path, or \"/\", as it will be inserted\n  // automatically by `Meteor.absoluteUrl` as documented in:\n  // http://docs.meteor.com/#/full/meteor_absoluteurl\n  var completePath = this.path.apply(this, arguments);\n  var basePath = this._basePath || '/';\n  var pathWithoutBase = completePath.replace(new RegExp('^' + basePath), '');\n  return Meteor.absoluteUrl(pathWithoutBase);\n};\n\nMeteor.startup(function () {\n  Package['kadira:flow-router'] = Package['ostrio:flow-router-extra'];\n});"]}