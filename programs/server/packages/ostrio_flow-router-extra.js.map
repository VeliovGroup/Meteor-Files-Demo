{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/router.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/group.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/route.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/server/_init.js","meteor://ðŸ’»app/packages/ostrio:flow-router-extra/lib/router.js"],"names":["Qs","require","pathRegExp","Router","_routes","_routesMap","subscriptions","Function","prototype","_onRouteCallbacks","route","pathDef","options","test","Error","Route","push","name","_triggerRouteRegister","group","Group","path","fields","queryParams","replace","key","firstRegexpChar","indexOf","substring","undefined","match","strQueryParams","stringify","onRouteRegister","cb","currentRoute","routePublicApi","_","pick","omit","each","go","current","triggers","enter","exit","middleware","getState","getAllStates","setState","removeState","clearStates","ready","initialize","wait","router","prefix","_router","parent","action","_subsMap","register","sub","subscription","module","export","FlowRouter","url","Meteor","absoluteUrl","pathWithoutBase","apply","arguments","RegExp","_basePath","startup","Package"],"mappings":"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","file":"/packages/ostrio_flow-router-extra.js","sourcesContent":["const Qs = require('qs');\nconst pathRegExp = /(:[\\w\\(\\)\\\\\\+\\*\\.\\?]+)+/g;\n\nRouter = function () {\n  this._routes = [];\n  this._routesMap = {};\n  this.subscriptions = Function.prototype;\n\n  // holds onRoute callbacks\n  this._onRouteCallbacks = [];\n};\n\nRouter.prototype.route = function(pathDef, options = {}) {\n  if (!/^\\/.*/.test(pathDef)) {\n    throw new Error('route\\'s path must start with \"/\"');\n  }\n\n  const route = new Route(this, pathDef, options);\n  this._routes.push(route);\n\n  if (options.name) {\n    this._routesMap[options.name] = route;\n  }\n\n  this._triggerRouteRegister(route);\n  return route;\n};\n\nRouter.prototype.group = function(options) {\n  return new Group(this, options);\n};\n\nRouter.prototype.path = function(pathDef, fields = {}, queryParams) {\n  if (this._routesMap[pathDef]) {\n    pathDef = this._routesMap[pathDef].path;\n  }\n\n  let path = pathDef.replace(pathRegExp, (key) => {\n    const firstRegexpChar = key.indexOf('(');\n    // get the content behind : and (\\\\d+/)\n    key = key.substring(1, (firstRegexpChar > 0) ? firstRegexpChar : undefined);\n    // remove +?*\n    key = key.replace(/[\\+\\*\\?]+/g, '');\n\n    return fields[key] || '';\n  });\n\n  path = path.replace(/\\/\\/+/g, '/'); // Replace multiple slashes with single slash\n\n  // remove trailing slash\n  // but keep the root slash if it's the only one\n  path = path.match(/^\\/{1}$/) ? path : path.replace(/\\/$/, '');\n\n  const strQueryParams = Qs.stringify(queryParams || {});\n  if(strQueryParams) {\n    path += '?' + strQueryParams;\n  }\n\n  return path;\n};\n\nRouter.prototype.onRouteRegister = function(cb) {\n  this._onRouteCallbacks.push(cb);\n};\n\nRouter.prototype._triggerRouteRegister = function(currentRoute) {\n  // We should only need to send a safe set of fields on the route\n  // object.\n  // This is not to hide what's inside the route object, but to show\n  // these are the public APIs\n  const routePublicApi = _.pick(currentRoute, 'name', 'pathDef', 'path');\n  routePublicApi.options = _.omit(currentRoute.options, ['triggersEnter', 'triggersExit', 'action', 'subscriptions', 'name']);\n\n  _.each(this._onRouteCallbacks, function(cb) {\n    cb(routePublicApi);\n  });\n};\n\n\nRouter.prototype.go = function() {\n  // client only\n};\n\n\nRouter.prototype.current = function() {\n  // client only\n};\n\n\nRouter.prototype.triggers = {\n  enter() {\n    // client only\n  },\n  exit() {\n    // client only\n  }\n};\n\nRouter.prototype.middleware = function() {\n  // client only\n};\n\n\nRouter.prototype.getState = function() {\n  // client only\n};\n\n\nRouter.prototype.getAllStates = function() {\n  // client only\n};\n\n\nRouter.prototype.setState = function() {\n  // client only\n};\n\n\nRouter.prototype.removeState = function() {\n  // client only\n};\n\n\nRouter.prototype.clearStates = function() {\n  // client only\n};\n\n\nRouter.prototype.ready = function() {\n  // client only\n};\n\n\nRouter.prototype.initialize = function() {\n  // client only\n};\n\nRouter.prototype.wait = function() {\n  // client only\n};\n","Group = function(router, options = {}) {\n  this.prefix = options.prefix || '';\n  this.options = options;\n  this._router = router;\n};\n\nGroup.prototype.route = function(pathDef, options) {\n  pathDef = this.prefix + pathDef;\n  return this._router.route(pathDef, options);\n};\n\nGroup.prototype.group = function(options) {\n  const group = new Group(this._router, options);\n  group.parent = this;\n\n  return group;\n};\n","Route = function(router, pathDef, options = {}) {\n  this.options = options;\n  this.name = options.name;\n  this.pathDef = pathDef;\n\n  // Route.path is deprecated and will be removed in 3.0\n  this.path = pathDef;\n\n  this.action = options.action || Function.prototype;\n  this.subscriptions = options.subscriptions || Function.prototype;\n  this._subsMap = {};\n};\n\n\nRoute.prototype.register = function(name, sub) {\n  this._subsMap[name] = sub;\n};\n\n\nRoute.prototype.subscription = function(name) {\n  return this._subsMap[name];\n};\n\n\nRoute.prototype.middleware = function() {\n  // ?\n};\n","// Export Router Instance\nFlowRouter = new Router();\nFlowRouter.Router = Router;\nFlowRouter.Route = Route;\n\nexport { FlowRouter };\n","Router.prototype.url = function() {\n  // We need to remove the leading base path, or \"/\", as it will be inserted\n  // automatically by `Meteor.absoluteUrl` as documented in:\n  // http://docs.meteor.com/#/full/meteor_absoluteurl\n  return Meteor.absoluteUrl(pathWithoutBase = this.path.apply(this, arguments).replace(new RegExp('^' + (this._basePath || '/')), ''));\n};\n\nMeteor.startup(() => {\n  Package['kadira:flow-router'] = Package['ostrio:flow-router-extra'];\n});\n"]}