{"version":3,"sources":["meteor://ðŸ’»app/lib/__compatibility/__globals.js","meteor://ðŸ’»app/lib/files.collection.js","meteor://ðŸ’»app/server/image-processing.js","meteor://ðŸ’»app/server/service-configurations.js","meteor://ðŸ’»app/server/spiderable.js"],"names":["module","export","_app","Collections","_","importSync","v","$","Meteor","FPSMeter","Template","FlowRouter","ReactiveVar","ClientStorage","NOOP","isClient","window","IS_RENDERED","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setTimeout","has","isArray","get","set","isBoolean","_el","on","e","preventDefault","stopPropagation","target","uf","document","getElementById","className","indexOf","replace","subs","SubsManager","blamed","unlist","secured","uploads","userOnly","storeTTL","currentUrl","absoluteUrl","current","path","location","pathname","split","storeTTLUser","showProjectInfo","serviceConfiguration","call","error","console","autorun","registerHelper","string","size","filesize","filename","parts","length","pop","join","time","isString","isNumber","Date","toISOString","_404","onRendered","_layout","helpers","events","marked","setOptions","highlight","code","hljs","highlightAuto","value","renderer","Renderer","gfm","tables","breaks","pedantic","sanitize","smartLists","smartypants","startup","attr","FPS","ui","reactive","start","regStop","click","isRunning","stop","check","Random","FilesCollection","useDropBox","useS3","request","bound","fs","client","sendToStorage","s3Conf","dbConf","stream","isServer","require","process","env","DROPBOX","settings","dropbox","JSON","parse","S3","s3","key","secret","token","Dropbox","Client","bucket","region","secretAccessKey","accessKeyId","sslEnabled","httpOptions","timeout","agent","bindEnvironment","files","chunkSize","storagePath","collectionName","allowClientCode","fileObj","meta","userId","onBeforeRemove","cursor","res","map","file","onBeforeUpload","downloadCallback","params","query","download","collection","update","_id","$inc","interceptDownload","http","fileRef","version","versions","pipeFrom","serve","url","headers","pick","pipePath","opts","Bucket","Key","range","vRef","clone","array","parseInt","end","isNaN","Range","fileColl","getObject","response","finished","httpResponse","dataStream","PassThrough","data","Body","denyClient","makeUrl","stat","triesUrl","long","downloadHack","xml","upd","$set","updError","unlink","findOne","writeToDB","triesSend","writeFile","extension","readFile","triesRead","each","filePath","id","putObject","StorageClass","createReadStream","ContentType","type","test","createThumbnails","_origRemove","remove","search","find","forEach","deleteObject","setInterval","$lte","publish","take","Number","Boolean","selector","$or","$lt","limit","sort","fields","name","isPDF","isText","isJSON","isVideo","isAudio","isImage","_collectionName","_downloadRoute","String","methods","filesLenght","count","unblame","blame","changeAccess","unlisted","Error","changePrivacy","gm","cb","Object","isLast","finish","exists","log","image","sizes","preview","width","thumbnail40","square","features","i","height","copyPaste","copy","fsCopyError","colUpdError","keys","img","quality","define","autoOrient","noProfile","strip","dither","interlace","filter","updateAndSave","upNSaveError","fsStatError","gmSizeError","imgInfo","resize","write","x","y","widthRatio","heightRatio","widthNew","heightNew","crop","ServiceConfiguration","_sc","configurations","ACCOUNTS_METEOR_ID","ACCOUNTS_METEOR_SEC","meteor","upsert","service","clientId","loginStyle","ACCOUNTS_GITHUB_ID","ACCOUNTS_GITHUB_SEC","github","ACCOUNTS_TWITTER_ID","ACCOUNTS_TWITTER_SEC","twitter","consumerKey","ACCOUNTS_FACEBOOK_ID","ACCOUNTS_FACEBOOK_SEC","facebook","appId","getServiceConfiguration"],"mappings":";;;;;;;;AAAAA,OAAOC,MAAP,CAAc;AAACC,QAAK;AAAA,WAAIA,IAAJ;AAAA,GAAN;AAAeC,eAAY;AAAA,WAAIA,WAAJ;AAAA;AAA3B,CAAd;;AAA2D,IAAIC,UAAJ;;AAAMJ,OAAOK,UAAP,CAAkB,mBAAlB,EAAsC;AAACD,KAAE,UAASE,CAAT,EAAW;AAACF,QAAEE,CAAF;AAAI;AAAnB,CAAtC,EAA2D,CAA3D;AAA8D,IAAIC,UAAJ;AAAMP,OAAOK,UAAP,CAAkB,eAAlB,EAAkC;AAACE,KAAE,UAASD,CAAT,EAAW;AAACC,QAAED,CAAF;AAAI;AAAnB,CAAlC,EAAuD,CAAvD;AAA0D,IAAIE,eAAJ;AAAWR,OAAOK,UAAP,CAAkB,eAAlB,EAAkC;AAACG,UAAO,UAASF,CAAT,EAAW;AAACE,aAAOF,CAAP;AAAS;AAA7B,CAAlC,EAAiE,CAAjE;AAAoE,IAAIG,iBAAJ;AAAaT,OAAOK,UAAP,CAAkB,yBAAlB,EAA4C;AAACI,YAAS,UAASH,CAAT,EAAW;AAACG,eAASH,CAAT;AAAW;AAAjC,CAA5C,EAA+E,CAA/E;AAAkF,IAAII,iBAAJ;AAAaV,OAAOK,UAAP,CAAkB,mBAAlB,EAAsC;AAACK,YAAS,UAASJ,CAAT,EAAW;AAACI,eAASJ,CAAT;AAAW;AAAjC,CAAtC,EAAyE,CAAzE;AAA4E,IAAIK,mBAAJ;AAAeX,OAAOK,UAAP,CAAkB,iCAAlB,EAAoD;AAACM,cAAW,UAASL,CAAT,EAAW;AAACK,iBAAWL,CAAX;AAAa;AAArC,CAApD,EAA2F,CAA3F;AAA8F,IAAIM,oBAAJ;AAAgBZ,OAAOK,UAAP,CAAkB,qBAAlB,EAAwC;AAACO,eAAY,UAASN,CAAT,EAAW;AAACM,kBAAYN,CAAZ;AAAc;AAAvC,CAAxC,EAAiF,CAAjF;AAAoF,IAAIO,sBAAJ;AAAkBb,OAAOK,UAAP,CAAkB,wBAAlB,EAA2C;AAACQ,iBAAc,UAASP,CAAT,EAAW;AAACO,oBAAcP,CAAd;AAAgB;AAA3C,CAA3C,EAAwF,CAAxF;AASzqB,IAAMH,cAAc,EAApB;AACA,IAAMD,OAAO;AAAEY,MAAF,cAAQ,CAAE;AAAV,CAAb;;AAEA,IAAIN,OAAOO,QAAX,EAAqB;AACnBC,SAAOC,WAAP,GAAqB,KAArB;;AACA,MAAI,CAACD,OAAOE,gBAAZ,EAA8B;AAC5BF,WAAOE,gBAAP,GAA2B,YAAM;AAC/B,aAAOF,OAAOG,qBAAP,IAAgCH,OAAOI,2BAAvC,IAAsEJ,OAAOK,wBAA7E,IAAyG,UAAUC,QAAV,EAAoB;AAClIN,eAAOO,UAAP,CAAkBD,QAAlB,EAA4B,OAAO,EAAnC;AACD,OAFD;AAGD,KAJyB,EAA1B;AAKD;;AACD,MAAI,CAACT,cAAcW,GAAd,CAAkB,QAAlB,CAAD,IAAgC,CAACpB,EAAEqB,OAAF,CAAUZ,cAAca,GAAd,CAAkB,QAAlB,CAAV,CAArC,EAA6E;AAC3Eb,kBAAcc,GAAd,CAAkB,QAAlB,EAA4B,EAA5B;AACD;;AACD,MAAI,CAACd,cAAcW,GAAd,CAAkB,QAAlB,CAAD,IAAgC,CAACpB,EAAEwB,SAAF,CAAYf,cAAca,GAAd,CAAkB,QAAlB,CAAZ,CAArC,EAA+E;AAC7Eb,kBAAcc,GAAd,CAAkB,QAAlB,EAA4B,IAA5B;AACD;;AACD,MAAI,CAACd,cAAcW,GAAd,CAAkB,SAAlB,CAAD,IAAiC,CAACpB,EAAEwB,SAAF,CAAYf,cAAca,GAAd,CAAkB,SAAlB,CAAZ,CAAtC,EAAiF;AAC/Eb,kBAAcc,GAAd,CAAkB,SAAlB,EAA6B,KAA7B;AACD;;AACD,MAAI,CAACd,cAAcW,GAAd,CAAkB,UAAlB,CAAD,IAAkC,CAACpB,EAAEwB,SAAF,CAAYf,cAAca,GAAd,CAAkB,UAAlB,CAAZ,CAAvC,EAAmF;AACjFb,kBAAcc,GAAd,CAAkB,UAAlB,EAA8B,KAA9B;AACD;;AAED,MAAIE,MAAM,IAAV;AACAtB,IAAES,MAAF,EAAUc,EAAV,CAAa,oBAAb,EAAmC,UAACC,CAAD,EAAO;AACxCA,MAAEC,cAAF;AACAD,MAAEE,eAAF;AACAJ,UAAME,EAAEG,MAAR;AACA,QAAMC,KAAKC,SAASC,cAAT,CAAwB,YAAxB,CAAX;;AACA,QAAI,CAAC,CAACF,GAAGG,SAAH,CAAaC,OAAb,CAAqB,WAArB,CAAN,EAAyC;AACvCJ,SAAGG,SAAH,IAAgB,YAAhB;AACD;;AACD,WAAO,KAAP;AACD,GATD;AAWA/B,IAAES,MAAF,EAAUc,EAAV,CAAa,WAAb,EAA0B,UAACC,CAAD,EAAO;AAC/BA,MAAEC,cAAF;AACAD,MAAEE,eAAF;;AACA,QAAIJ,QAAQE,EAAEG,MAAd,EAAsB;AACpB,UAAMC,KAAKC,SAASC,cAAT,CAAwB,YAAxB,CAAX;;AACA,UAAI,CAAC,CAAC,CAACF,GAAGG,SAAH,CAAaC,OAAb,CAAqB,WAArB,CAAP,EAA0C;AACxCJ,WAAGG,SAAH,GAAeH,GAAGG,SAAH,CAAaE,OAAb,CAAqB,YAArB,EAAmC,EAAnC,CAAf;AACD;AACF;;AACD,WAAO,KAAP;AACD,GAVD;AAYAjC,IAAES,MAAF,EAAUc,EAAV,CAAa,MAAb,EAAqB,UAACC,CAAD,EAAO;AAC1BA,MAAEC,cAAF;AACAD,MAAEE,eAAF;AACA,QAAME,KAAKC,SAASC,cAAT,CAAwB,YAAxB,CAAX;;AACA,QAAI,CAAC,CAAC,CAACF,GAAGG,SAAH,CAAaC,OAAb,CAAqB,WAArB,CAAP,EAA0C;AACxCJ,SAAGG,SAAH,GAAeH,GAAGG,SAAH,CAAaE,OAAb,CAAqB,YAArB,EAAmC,EAAnC,CAAf;AACD;;AACD,WAAO,KAAP;AACD,GARD;AAUAtC,OAAKuC,IAAL,GAAgB,IAAIC,WAAJ,EAAhB;AACAxC,OAAKyC,MAAL,GAAgB,IAAI/B,WAAJ,CAAgBC,cAAca,GAAd,CAAkB,QAAlB,CAAhB,CAAhB;AACAxB,OAAK0C,MAAL,GAAgB,IAAIhC,WAAJ,CAAgBC,cAAca,GAAd,CAAkB,QAAlB,CAAhB,CAAhB;AACAxB,OAAK2C,OAAL,GAAgB,IAAIjC,WAAJ,CAAgBC,cAAca,GAAd,CAAkB,SAAlB,CAAhB,CAAhB;AACAxB,OAAK4C,OAAL,GAAgB,IAAIlC,WAAJ,CAAgB,KAAhB,CAAhB;AACAV,OAAK6C,QAAL,GAAgB,IAAInC,WAAJ,CAAgBC,cAAca,GAAd,CAAkB,UAAlB,CAAhB,CAAhB;AACAxB,OAAK8C,QAAL,GAAgB,QAAhB;;AACA9C,OAAK+C,UAAL,GAAkB,YAAM;AACtB,WAAOzC,OAAO0C,WAAP,CAAmB,CAACvC,WAAWwC,OAAX,GAAqBC,IAArB,IAA6BhB,SAASiB,QAAT,CAAkBC,QAAhD,EAA0Dd,OAA1D,CAAkE,MAAlE,EAA0E,EAA1E,CAAnB,EAAkGe,KAAlG,CAAwG,GAAxG,EAA6G,CAA7G,EAAgHA,KAAhH,CAAsH,GAAtH,EAA2H,CAA3H,EAA8Hf,OAA9H,CAAsI,GAAtI,EAA2I,EAA3I,CAAP;AACD,GAFD;;AAGAtC,OAAKsD,YAAL,GAAoB,SAApB;AACAtD,OAAKuD,eAAL,GAAuB,IAAI7C,WAAJ,CAAgB,KAAhB,CAAvB;AACAV,OAAKwD,oBAAL,GAA4B,IAAI9C,WAAJ,CAAgB,EAAhB,CAA5B;AAEAJ,SAAOmD,IAAP,CAAY,yBAAZ,EAAuC,UAACC,KAAD,EAAQF,oBAAR,EAAiC;AACtE,QAAIE,KAAJ,EAAW;AACTC,cAAQD,KAAR,CAAcA,KAAd;AACD,KAFD,MAEO;AACL1D,WAAKwD,oBAAL,CAA0B/B,GAA1B,CAA8B+B,oBAA9B;AACD;AACF,GAND;AAQAlD,SAAOsD,OAAP,CAAe,YAAM;AACnBjD,kBAAcc,GAAd,CAAkB,QAAlB,EAA4BzB,KAAKyC,MAAL,CAAYjB,GAAZ,EAA5B;AACD,GAFD;AAIAlB,SAAOsD,OAAP,CAAe,YAAM;AACnBjD,kBAAcc,GAAd,CAAkB,QAAlB,EAA4BzB,KAAK0C,MAAL,CAAYlB,GAAZ,EAA5B;AACD,GAFD;AAIAlB,SAAOsD,OAAP,CAAe,YAAM;AACnBjD,kBAAcc,GAAd,CAAkB,SAAlB,EAA6BzB,KAAK2C,OAAL,CAAanB,GAAb,EAA7B;AACD,GAFD;AAIAlB,SAAOsD,OAAP,CAAe,YAAM;AACnBjD,kBAAcc,GAAd,CAAkB,UAAlB,EAA8BzB,KAAK6C,QAAL,CAAcrB,GAAd,EAA9B;AACD,GAFD;;AAIA,MAAI,CAACb,cAAcW,GAAd,CAAkB,iBAAlB,CAAL,EAA2C;AACzCX,kBAAcc,GAAd,CAAkB,iBAAlB,EAAqC,KAArC;AACD;;AAEDjB,WAASqD,cAAT,CAAwB,YAAxB,EAAsC,YAAM;AAC1C,WAAO7D,KAAK+C,UAAL,EAAP;AACD,GAFD;AAIAvC,WAASqD,cAAT,CAAwB,KAAxB,EAA+B,YAAmB;AAAA,QAAlBC,MAAkB,uEAAT,IAAS;AAChD,WAAOxD,OAAO0C,WAAP,CAAmBc,MAAnB,CAAP;AACD,GAFD;AAIAtD,WAASqD,cAAT,CAAwB,UAAxB,EAAoC,YAAc;AAAA,QAAbE,IAAa,uEAAN,CAAM;AAChD,WAAOC,SAASD,IAAT,CAAP;AACD,GAFD;AAIAvD,WAASqD,cAAT,CAAwB,SAAxB,EAAmC,YAAmB;AAAA,QAAlBI,QAAkB,uEAAP,EAAO;AACpD,QAAMC,QAAQD,SAASZ,KAAT,CAAe,GAAf,CAAd;;AACA,QAAIa,MAAMC,MAAN,GAAe,CAAnB,EAAsB;AACpBD,YAAME,GAAN;AACD;;AACD,WAAOF,MAAMG,IAAN,CAAW,GAAX,CAAP;AACD,GAND;AAQA7D,WAASqD,cAAT,CAAwB,WAAxB,EAAqC,YAAc;AAAA,QAAbS,IAAa,uEAAN,CAAM;;AACjD,QAAIpE,EAAEqE,QAAF,CAAWD,IAAX,KAAoBpE,EAAEsE,QAAF,CAAWF,IAAX,CAAxB,EAA0C;AACxCA,aAAO,IAAIG,IAAJ,CAASH,IAAT,CAAP;AACD;;AACD,WAAOA,KAAKI,WAAL,EAAP;AACD,GALD;;AAOAlE,WAASmE,IAAT,CAAcC,UAAd,CAAyB,YAAW;AAClC9D,WAAOC,WAAP,GAAqB,IAArB;AACD,GAFD;;AAIAP,WAASqE,OAAT,CAAiBC,OAAjB,CAAyB;AACvBvB,mBADuB,cACL;AAChB,aAAOvD,KAAKuD,eAAL,CAAqB/B,GAArB,EAAP;AACD;AAHsB,GAAzB;;AAKAhB,WAASqE,OAAT,CAAiBE,MAAjB,CAAwB;AACtB,oCADsB,YACWlD,CADX,EACc;AAClCA,QAAEC,cAAF;;AACA9B,WAAKuD,eAAL,CAAqB9B,GAArB,CAAyB,CAACzB,KAAKuD,eAAL,CAAqB/B,GAArB,EAA1B;;AACA,aAAO,KAAP;AACD;AALqB,GAAxB;;AAOAwD,SAAOC,UAAP,CAAkB;AAChBC,aADgB,YACNC,IADM,EACA;AACd,aAAOC,KAAKC,aAAL,CAAmBF,IAAnB,EAAyBG,KAAhC;AACD,KAHe;AAIhBC,cAAU,IAAIP,OAAOQ,QAAX,EAJM;AAKhBC,SAAK,IALW;AAMhBC,YAAQ,IANQ;AAOhBC,YAAQ,KAPQ;AAQhBC,cAAU,KARM;AAShBC,cAAU,IATM;AAUhBC,gBAAY,IAVI;AAWhBC,iBAAa;AAXG,GAAlB;AAcAzF,SAAO0F,OAAP,CAAe,YAAM;AACnB3F,MAAE,MAAF,EAAU4F,IAAV,CAAe,WAAf,EAA4B,EAA5B;AACA5F,MAAE,MAAF,EAAU4F,IAAV,CAAe,UAAf,EAA2B,2BAA3B;AACA5F,MAAE,MAAF,EAAU4F,IAAV,CAAe,UAAf,EAA2B,mBAA3B;AACA5F,MAAE,MAAF,EAAU4F,IAAV,CAAe,UAAf,EAA2B,IAA3B;AACA5F,MAAE,MAAF,EAAU4F,IAAV,CAAe,MAAf,EAAuB,IAAvB;AAEA,QAAMC,MAAM,IAAI3F,QAAJ,CAAa;AACvB4F,UAAI,IADmB;AAEvBC,gBAAU;AAFa,KAAb,CAAZ;AAKAF,QAAIG,KAAJ;;AACA,QAAMC,UAAU,YAAM;AACpBjG,QAAE,aAAF,EAAiBkG,KAAjB,CAAuB,YAAM;AAC3B,YAAIL,IAAIM,SAAR,EAAmB;AACjBN,cAAIM,SAAJ,GAAgB,KAAhB;AACD,SAFD,MAEO;AACLN,cAAIO,IAAJ;AACA3F,iBAAOE,gBAAP,CAAwB,YAAM;AAC5BkF,gBAAIG,KAAJ;AACAC;AACD,WAHD;AAID;AACF,OAVD;AAWD,KAZD;;AAcAA;AACD,GA5BD;AA6BD,2H;;;;;;;;;;;ACpMD,IAAIpG,UAAJ;;AAAMJ,OAAOK,UAAP,CAAkB,mBAAlB,EAAsC;AAACD,KAAE,UAASE,CAAT,EAAW;AAACF,QAAEE,CAAF;AAAI;AAAnB,CAAtC,EAA2D,CAA3D;AAA8D,IAAIsG,cAAJ;AAAU5G,OAAOK,UAAP,CAAkB,cAAlB,EAAiC;AAACuG,SAAM,UAAStG,CAAT,EAAW;AAACsG,YAAMtG,CAAN;AAAQ;AAA3B,CAAjC,EAA8D,CAA9D;AAAiE,IAAIE,eAAJ;AAAWR,OAAOK,UAAP,CAAkB,eAAlB,EAAkC;AAACG,UAAO,UAASF,CAAT,EAAW;AAACE,aAAOF,CAAP;AAAS;AAA7B,CAAlC,EAAiE,CAAjE;AAAoE,IAAIuG,eAAJ;AAAW7G,OAAOK,UAAP,CAAkB,eAAlB,EAAkC;AAACwG,UAAO,UAASvG,CAAT,EAAW;AAACuG,aAAOvG,CAAP;AAAS;AAA7B,CAAlC,EAAiE,CAAjE;AAAoE,IAAIwG,wBAAJ;AAAoB9G,OAAOK,UAAP,CAAkB,qBAAlB,EAAwC;AAACyG,mBAAgB,UAASxG,CAAT,EAAW;AAACwG,sBAAgBxG,CAAhB;AAAkB;AAA/C,CAAxC,EAAyF,CAAzF;;AAA4F,IAAIJ,aAAJ;AAAA,IAASC,oBAAT;;AAAqBH,OAAOK,UAAP,CAAkB,mCAAlB,EAAsD;AAACH,QAAK,UAASI,CAAT,EAAW;AAACJ,WAAKI,CAAL;AAAO,GAAzB;AAA0BH,eAAY,UAASG,CAAT,EAAW;AAACH,kBAAYG,CAAZ;AAAc;AAAhE,CAAtD,EAAwH,CAAxH;AAOlb;AACA;AACA;AACA,IAAIyG,aAAa,KAAjB,C,CAEA;AACA;AACA;;AACA,IAAIC,QAAQ,KAAZ;AACA,IAAIC,gBAAJ;AAAA,IAAaC,cAAb;AAAA,IAAoBC,WAApB;AAAA,IAAwBC,eAAxB;AAAA,IAAgCC,sBAAhC;AAAA,IAA+CC,eAA/C;AAAA,IAAuDC,eAAvD;AAAA,IAA+DC,eAA/D;;AAEA,IAAIhH,OAAOiH,QAAX,EAAqB;AACnBN,OAAKO,QAAQ,UAAR,CAAL;;AAEA,MAAIC,QAAQC,GAAR,CAAYC,OAAhB,EAAyB;AACvBrH,WAAOsH,QAAP,CAAgBC,OAAhB,GAA0BC,KAAKC,KAAL,CAAWN,QAAQC,GAAR,CAAYC,OAAvB,EAAgCE,OAA1D;AACD,GAFD,MAEO,IAAIJ,QAAQC,GAAR,CAAYM,EAAhB,EAAoB;AACzB1H,WAAOsH,QAAP,CAAgBK,EAAhB,GAAqBH,KAAKC,KAAL,CAAWN,QAAQC,GAAR,CAAYM,EAAvB,EAA2BC,EAAhD;AACD;;AAEDb,WAAS9G,OAAOsH,QAAP,CAAgBK,EAAhB,IAAsB,EAA/B;AACAZ,WAAS/G,OAAOsH,QAAP,CAAgBC,OAAhB,IAA2B,EAApC;;AAEA,MAAIR,UAAUA,OAAOa,GAAjB,IAAwBb,OAAOc,MAA/B,IAAyCd,OAAOe,KAApD,EAA2D;AACzDvB,iBAAgB,IAAhB;;AACA,QAAMwB,UAAUb,QAAQ,SAAR,CAAhB;;AAEAN,aAAS,IAAImB,QAAQC,MAAZ,CAAmB;AAC1BJ,WAAKb,OAAOa,GADc;AAE1BC,cAAQd,OAAOc,MAFW;AAG1BC,aAAOf,OAAOe;AAHY,KAAnB,CAAT;AAKD,GATD,MASO,IAAIhB,UAAUA,OAAOc,GAAjB,IAAwBd,OAAOe,MAA/B,IAAyCf,OAAOmB,MAAhD,IAA0DnB,OAAOoB,MAArE,EAA6E;AAClF1B,YAAW,IAAX;AACAQ,aAAWE,QAAQ,QAAR,CAAX;;AACA,QAAMQ,KAAKR,QAAQ,oBAAR,CAAX;;AAEAN,aAAS,IAAIc,EAAJ,CAAO;AACdS,uBAAiBrB,OAAOe,MADV;AAEdO,mBAAatB,OAAOc,GAFN;AAGdM,cAAQpB,OAAOoB,MAHD;AAIdG,kBAAY,KAJE;AAKdC,mBAAa;AACXC,iBAAS,IADE;AAEXC,eAAO;AAFI;AALC,KAAP,CAAT;AAUD;;AAED,MAAIhC,SAASD,UAAb,EAAyB;AACvBE,cAAUS,QAAQ,SAAR,CAAV;AACAR,YAAU1G,OAAOyI,eAAP,CAAuB,UAAC3H,QAAD,EAAc;AAC7C,aAAOA,UAAP;AACD,KAFS,CAAV;AAGD;AACF;;AAEDnB,YAAY+I,KAAZ,GAAoB,IAAIpC,eAAJ,CAAoB;AACtC;AACA;AACAqC,aAAW,OAAO,GAHoB;AAItCC,eAAa,kCAJyB;AAKtCC,kBAAgB,eALsB;AAMtCC,mBAAiB,IANqB;AAAA,yBAO5BC,OAP4B,EAOnB;AACjB,QAAIA,OAAJ,EAAa;AACX,UAAI,EAAEA,QAAQC,IAAR,IAAgBD,QAAQC,IAAR,CAAa3G,OAA/B,CAAJ,EAA6C;AAC3C,eAAO,IAAP;AACD,OAFD,MAEO,IAAK0G,QAAQC,IAAR,IAAgBD,QAAQC,IAAR,CAAa3G,OAAb,KAAyB,IAA1C,IAAmD,KAAK4G,MAAL,KAAgBF,QAAQE,MAA/E,EAAuF;AAC5F,eAAO,IAAP;AACD;AACF;;AACD,WAAO,KAAP;AACD,GAhBqC;AAiBtCC,gBAjBsC,YAiBvBC,MAjBuB,EAiBf;AAAA;;AACrB,QAAMC,MAAMD,OAAOE,GAAP,CAAW,UAACC,IAAD,EAAU;AAC/B,UAAIA,QAAQA,KAAKL,MAAb,IAAuBrJ,EAAEqE,QAAF,CAAWqF,KAAKL,MAAhB,CAA3B,EAAoD;AAClD,eAAOK,KAAKL,MAAL,KAAgB,MAAKA,MAA5B;AACD;;AACD,aAAO,KAAP;AACD,KALW,CAAZ;AAMA,WAAO,CAAC,CAACG,IAAIrH,OAAJ,CAAY,KAAZ,CAAT;AACD,GAzBqC;AA0BtCwH,gBA1BsC,cA0BrB;AACf,QAAI,KAAKD,IAAL,CAAU7F,IAAV,IAAkB,OAAO,IAAP,GAAc,GAApC,EAAyC;AACvC,aAAO,IAAP;AACD;;AACD,WAAO,oDAAqDC,SAAS,KAAK4F,IAAL,CAAU7F,IAAnB,CAA5D;AACD,GA/BqC;AAgCtC+F,kBAhCsC,YAgCrBT,OAhCqB,EAgCZ;AACxB,QAAI,KAAKU,MAAL,IAAe,KAAKA,MAAL,CAAYC,KAA3B,IAAoC,KAAKD,MAAL,CAAYC,KAAZ,CAAkBC,QAAlB,KAA+B,MAAvE,EAA+E;AAC7EhK,kBAAY+I,KAAZ,CAAkBkB,UAAlB,CAA6BC,MAA7B,CAAoCd,QAAQe,GAA5C,EAAiD;AAC/CC,cAAM;AACJ,4BAAkB;AADd;AADyC,OAAjD,EAIGrK,KAAKY,IAJR;AAKD;;AACD,WAAO,IAAP;AACD,GAzCqC;AA0CtC0J,mBA1CsC,YA0CpBC,IA1CoB,EA0CdC,OA1Cc,EA0CLC,OA1CK,EA0CI;AACxC,QAAIvH,aAAJ;;AACA,QAAI2D,UAAJ,EAAgB;AACd3D,aAAQsH,WAAWA,QAAQE,QAAnB,IAA+BF,QAAQE,QAAR,CAAiBD,OAAjB,CAA/B,IAA4DD,QAAQE,QAAR,CAAiBD,OAAjB,EAA0BnB,IAAtF,IAA8FkB,QAAQE,QAAR,CAAiBD,OAAjB,EAA0BnB,IAA1B,CAA+BqB,QAA9H,GAA0IH,QAAQE,QAAR,CAAiBD,OAAjB,EAA0BnB,IAA1B,CAA+BqB,QAAzK,GAAoL,KAAK,CAAhM;;AACA,UAAIzH,IAAJ,EAAU;AACR;AACA;AACA;AAEA;AACA;AACA;AACA;AACA,aAAK0H,KAAL,CAAWL,IAAX,EAAiBC,OAAjB,EAA0BA,QAAQE,QAAR,CAAiBD,OAAjB,CAA1B,EAAqDA,OAArD,EAA8D1D,QAAQ;AACpE8D,eAAK3H,IAD+D;AAEpE4H,mBAAS5K,EAAE6K,IAAF,CAAOR,KAAKxD,OAAL,CAAa+D,OAApB,EAA6B,OAA7B,EAAsC,eAAtC,EAAuD,YAAvD;AAF2D,SAAR,CAA9D;AAIA,eAAO,IAAP;AACD,OAhBa,CAiBd;AACA;;;AACA,aAAO,KAAP;AACD,KApBD,MAoBO,IAAIhE,KAAJ,EAAW;AAChB5D,aAAQsH,WAAWA,QAAQE,QAAnB,IAA+BF,QAAQE,QAAR,CAAiBD,OAAjB,CAA/B,IAA4DD,QAAQE,QAAR,CAAiBD,OAAjB,EAA0BnB,IAAtF,IAA8FkB,QAAQE,QAAR,CAAiBD,OAAjB,EAA0BnB,IAA1B,CAA+B0B,QAA9H,GAA0IR,QAAQE,QAAR,CAAiBD,OAAjB,EAA0BnB,IAA1B,CAA+B0B,QAAzK,GAAoL,KAAK,CAAhM;;AACA,UAAI9H,IAAJ,EAAU;AACR;AACA;AACA;AAEA;AACA;AACA;AACA;AACA,YAAM+H,OAAO;AACXC,kBAAQ9D,OAAOmB,MADJ;AAEX4C,eAAKjI;AAFM,SAAb;;AAKA,YAAIqH,KAAKxD,OAAL,CAAa+D,OAAb,CAAqBM,KAAzB,EAAgC;AAC9B,cAAMC,OAAQb,QAAQE,QAAR,CAAiBD,OAAjB,CAAd;;AACA,cAAIW,QAAUlL,EAAEoL,KAAF,CAAQf,KAAKxD,OAAL,CAAa+D,OAAb,CAAqBM,KAA7B,CAAd;;AACA,cAAMG,QAAQH,MAAM/H,KAAN,CAAY,yBAAZ,CAAd;AACA,cAAMgD,QAAQmF,SAASD,MAAM,CAAN,CAAT,CAAd;AACA,cAAIE,MAAUD,SAASD,MAAM,CAAN,CAAT,CAAd;;AACA,cAAIG,MAAMD,GAAN,CAAJ,EAAgB;AACd;AACAA,kBAAapF,QAAQ,KAAK4C,SAAd,GAA2B,CAAvC;;AACA,gBAAIwC,OAAOJ,KAAKtH,IAAhB,EAAsB;AACpB0H,oBAAUJ,KAAKtH,IAAL,GAAY,CAAtB;AACD;AACF;;AACDkH,eAAKU,KAAL,cAAwBtF,KAAxB,SAAiCoF,GAAjC;AACAlB,eAAKxD,OAAL,CAAa+D,OAAb,CAAqBM,KAArB,cAAsC/E,KAAtC,SAA+CoF,GAA/C;AACD;;AAED,YAAMG,WAAW,IAAjB;AACA1E,eAAO2E,SAAP,CAAiBZ,IAAjB,EAAuB,UAAUvH,KAAV,EAAiB;AACtC,cAAIA,KAAJ,EAAW;AACTC,oBAAQD,KAAR,CAAcA,KAAd;;AACA,gBAAI,CAAC6G,KAAKuB,QAAL,CAAcC,QAAnB,EAA6B;AAC3BxB,mBAAKuB,QAAL,CAAcL,GAAd;AACD;AACF,WALD,MAKO;AACL,gBAAIlB,KAAKxD,OAAL,CAAa+D,OAAb,CAAqBM,KAArB,IAA8B,KAAKY,YAAL,CAAkBlB,OAAlB,CAA0B,eAA1B,CAAlC,EAA8E;AAC5E;AACAP,mBAAKxD,OAAL,CAAa+D,OAAb,CAAqBM,KAArB,GAA6B,KAAKY,YAAL,CAAkBlB,OAAlB,CAA0B,eAA1B,EAA2CzH,KAA3C,CAAiD,GAAjD,EAAsD,CAAtD,EAAyDf,OAAzD,CAAiE,QAAjE,EAA2E,QAA3E,CAA7B;AACD;;AAED,gBAAM2J,aAAa,IAAI3E,OAAO4E,WAAX,EAAnB;AACAN,qBAAShB,KAAT,CAAeL,IAAf,EAAqBC,OAArB,EAA8BA,QAAQE,QAAR,CAAiBD,OAAjB,CAA9B,EAAyDA,OAAzD,EAAkEwB,UAAlE;AACAA,uBAAWR,GAAX,CAAe,KAAKU,IAAL,CAAUC,IAAzB;AACD;AACF,SAhBD;AAkBA,eAAO,IAAP;AACD,OArDe,CAsDhB;AACA;;;AACA,aAAO,KAAP;AACD;;AACD,WAAO,KAAP;AACD;AA3HqC,CAApB,CAApB;;AA8HA,IAAI9L,OAAOiH,QAAX,EAAqB;AACnBtH,cAAY+I,KAAZ,CAAkBqD,UAAlB;AACApM,cAAY+I,KAAZ,CAAkBpH,EAAlB,CAAqB,aAArB,EAAoC,UAAS4I,OAAT,EAAkB;AAAA;;AACpD,QAAI3D,UAAJ,EAAgB;AACd,UAAMyF,UAAU,UAACC,IAAD,EAAO/B,OAAP,EAAgBC,OAAhB,EAA0C;AAAA,YAAjB+B,QAAiB,uEAAN,CAAM;AACxDtF,eAAOoF,OAAP,CAAeC,KAAKrJ,IAApB,EAA0B;AACxBuJ,gBAAM,IADkB;AAExBC,wBAAc;AAFU,SAA1B,EAGG,UAAChJ,KAAD,EAAQiJ,GAAR,EAAgB;AACjB3F,gBAAM,YAAM;AACV;AACA,gBAAItD,KAAJ,EAAW;AACT,kBAAI8I,WAAW,EAAf,EAAmB;AACjBlM,uBAAOe,UAAP,CAAkB,YAAM;AACtBiL,0BAAQC,IAAR,EAAc/B,OAAd,EAAuBC,OAAvB,EAAgC,EAAE+B,QAAlC;AACD,iBAFD,EAEG,IAFH;AAGD,eAJD,MAIO;AACL7I,wBAAQD,KAAR,CAAcA,KAAd,EAAqB;AACnB8I,4BAAUA;AADS,iBAArB;AAGD;AACF,aAVD,MAUO,IAAIG,GAAJ,EAAS;AACd,kBAAMC,MAAM;AAAEC,sBAAM;AAAR,eAAZ;AACAD,kBAAI,MAAJ,EAAY,cAAcnC,OAAd,GAAwB,gBAApC,IAAwDkC,IAAI9B,GAA5D;AACA+B,kBAAI,MAAJ,EAAY,cAAcnC,OAAd,GAAwB,gBAApC,IAAwD8B,KAAKrJ,IAA7D;;AACA,qBAAKgH,UAAL,CAAgBC,MAAhB,CAAuB;AACrBC,qBAAKI,QAAQJ;AADQ,eAAvB,EAEGwC,GAFH,EAEQ,UAACE,QAAD,EAAc;AACpB,oBAAIA,QAAJ,EAAc;AACZnJ,0BAAQD,KAAR,CAAcoJ,QAAd;AACD,iBAFD,MAEO;AACL;AACA;AACA,yBAAKC,MAAL,CAAY,OAAK7C,UAAL,CAAgB8C,OAAhB,CAAwBxC,QAAQJ,GAAhC,CAAZ,EAAkDK,OAAlD;AACD;AACF,eAVD;AAWD,aAfM,MAeA;AACL,kBAAI+B,WAAW,EAAf,EAAmB;AACjBlM,uBAAOe,UAAP,CAAkB,YAAM;AACtB;AACAiL,0BAAQC,IAAR,EAAc/B,OAAd,EAAuBC,OAAvB,EAAgC,EAAE+B,QAAlC;AACD,iBAHD,EAGG,IAHH;AAID,eALD,MAKO;AACL7I,wBAAQD,KAAR,CAAc,oCAAd,EAAoD;AAClD8I,4BAAUA;AADwC,iBAApD;AAGD;AACF;AACF,WAvCD;AAwCD,SA5CD;AA6CD,OA9CD;;AAgDA,UAAMS,YAAY,UAACzC,OAAD,EAAUC,OAAV,EAAmB0B,IAAnB,EAA2C;AAAA,YAAlBe,SAAkB,uEAAN,CAAM;AAC3D;AACA;AACAhG,eAAOiG,SAAP,CAAiB3C,QAAQJ,GAAR,GAAc,GAAd,GAAoBK,OAApB,GAA8B,GAA9B,GAAoCD,QAAQ4C,SAA7D,EAAwEjB,IAAxE,EAA8E,UAACzI,KAAD,EAAQ6I,IAAR,EAAiB;AAC7FvF,gBAAM,YAAM;AACV,gBAAItD,KAAJ,EAAW;AACT,kBAAIwJ,YAAY,EAAhB,EAAoB;AAClB5M,uBAAOe,UAAP,CAAkB,YAAM;AACtB;AACA4L,4BAAUzC,OAAV,EAAmBC,OAAnB,EAA4B0B,IAA5B,EAAkC,EAAEe,SAApC;AACD,iBAHD,EAGG,IAHH;AAID,eALD,MAKO;AACLvJ,wBAAQD,KAAR,CAAcA,KAAd,EAAqB;AACnBwJ,6BAAWA;AADQ,iBAArB;AAGD;AACF,aAXD,MAWO;AACLZ,sBAAQC,IAAR,EAAc/B,OAAd,EAAuBC,OAAvB;AACD;AACF,WAfD;AAgBD,SAjBD;AAkBD,OArBD;;AAuBA,UAAM4C,WAAW,UAAC7C,OAAD,EAAUa,IAAV,EAAgBZ,OAAhB,EAA2C;AAAA,YAAlB6C,SAAkB,uEAAN,CAAM;AAC1DrG,WAAGoG,QAAH,CAAYhC,KAAKnI,IAAjB,EAAuB,UAACQ,KAAD,EAAQyI,IAAR,EAAiB;AACtCnF,gBAAM,YAAM;AACV,gBAAItD,KAAJ,EAAW;AACT,kBAAI4J,YAAY,EAAhB,EAAoB;AAClBD,yBAAS7C,OAAT,EAAkBa,IAAlB,EAAwBZ,OAAxB,EAAiC,EAAE6C,SAAnC;AACD,eAFD,MAEO;AACL3J,wBAAQD,KAAR,CAAcA,KAAd;AACD;AACF,aAND,MAMO;AACLuJ,wBAAUzC,OAAV,EAAmBC,OAAnB,EAA4B0B,IAA5B;AACD;AACF,WAVD;AAWD,SAZD;AAaD,OAdD;;AAgBAhF,sBAAgB,UAACqD,OAAD,EAAa;AAC3BtK,UAAEqN,IAAF,CAAO/C,QAAQE,QAAf,EAAyB,UAACW,IAAD,EAAOZ,OAAP,EAAmB;AAC1C4C,mBAAS7C,OAAT,EAAkBa,IAAlB,EAAwBZ,OAAxB;AACD,SAFD;AAGD,OAJD;AAKD,KA7FD,MA6FO,IAAI3D,KAAJ,EAAW;AAChBK,sBAAgB,UAACqD,OAAD,EAAa;AAC3BtK,UAAEqN,IAAF,CAAO/C,QAAQE,QAAf,EAAyB,UAACW,IAAD,EAAOZ,OAAP,EAAmB;AAC1C;AACA;AACA;AACA;AACA,cAAM+C,WAAW,WAAY7G,OAAO8G,EAAP,EAAZ,GAA2B,GAA3B,GAAiChD,OAAjC,GAA2C,GAA3C,GAAiDD,QAAQ4C,SAA1E;AAEAlG,iBAAOwG,SAAP,CAAiB;AACfC,0BAAc,UADC;AAEfzC,oBAAQ9D,OAAOmB,MAFA;AAGf4C,iBAAKqC,QAHU;AAIfpB,kBAAMnF,GAAG2G,gBAAH,CAAoBvC,KAAKnI,IAAzB,CAJS;AAKf2K,yBAAaxC,KAAKyC;AALH,WAAjB,EAMG,UAACpK,KAAD,EAAW;AACZsD,kBAAM,YAAM;AACV,kBAAItD,KAAJ,EAAW;AACTC,wBAAQD,KAAR,CAAcA,KAAd;AACD,eAFD,MAEO;AACL,oBAAMkJ,MAAM;AAAEC,wBAAM;AAAR,iBAAZ;AACAD,oBAAI,MAAJ,EAAY,cAAcnC,OAAd,GAAwB,gBAApC,IAAwD+C,QAAxD;;AACA,uBAAKtD,UAAL,CAAgBC,MAAhB,CAAuB;AACrBC,uBAAKI,QAAQJ;AADQ,iBAAvB,EAEGwC,GAFH,EAEQ,UAACE,QAAD,EAAc;AACpB,sBAAIA,QAAJ,EAAc;AACZnJ,4BAAQD,KAAR,CAAcoJ,QAAd;AACD,mBAFD,MAEO;AACL;AACA;AACA,2BAAKC,MAAL,CAAY,OAAK7C,UAAL,CAAgB8C,OAAhB,CAAwBxC,QAAQJ,GAAhC,CAAZ,EAAkDK,OAAlD;AACD;AACF,iBAVD;AAWD;AACF,aAlBD;AAmBD,WA1BD;AA2BD,SAlCD;AAmCD,OApCD;AAqCD;;AAED,QAAI,aAAasD,IAAb,CAAkBvD,QAAQ4C,SAAR,IAAqB,EAAvC,CAAJ,EAAgD;AAC9CpN,WAAKgO,gBAAL,CAAsB,IAAtB,EAA4BxD,OAA5B,EAAqC,UAAC9G,KAAD,EAAQ8G,OAAR,EAAoB;AACvD,YAAI9G,KAAJ,EAAW;AACTC,kBAAQD,KAAR,CAAcA,KAAd;AACD;;AACD,YAAImD,cAAcC,KAAlB,EAAyB;AACvBK,wBAAc,OAAK+C,UAAL,CAAgB8C,OAAhB,CAAwBxC,QAAQJ,GAAhC,CAAd;AACD;AACF,OAPD;AAQD,KATD,MASO;AACL,UAAIvD,cAAcC,KAAlB,EAAyB;AACvBK,sBAAcqD,OAAd;AACD;AACF;AACF,GApJD,EAFmB,CAwJnB;AACA;AAEA;AACA;;AACA,MAAI3D,cAAcC,KAAlB,EAAyB;AACvB,QAAMmH,cAAchO,YAAY+I,KAAZ,CAAkBkF,MAAtC;;AACAjO,gBAAY+I,KAAZ,CAAkBkF,MAAlB,GAA2B,UAASC,MAAT,EAAiB;AAC1C,UAAM1E,SAAS,KAAKS,UAAL,CAAgBkE,IAAhB,CAAqBD,MAArB,CAAf;AACA1E,aAAO4E,OAAP,CAAe,UAAC7D,OAAD,EAAa;AAC1BtK,UAAEqN,IAAF,CAAO/C,QAAQE,QAAf,EAAyB,UAACW,IAAD,EAAU;AACjC,cAAIA,QAAQA,KAAK/B,IAAb,IAAqB+B,KAAK/B,IAAL,CAAU0B,QAAV,IAAsB,IAA/C,EAAqD;AACnD,gBAAInE,UAAJ,EAAgB;AACd;AACAK,qBAAOgH,MAAP,CAAc7C,KAAK/B,IAAL,CAAU0B,QAAxB,EAAkC,UAACtH,KAAD,EAAW;AAC3CsD,sBAAM,YAAM;AACV,sBAAItD,KAAJ,EAAW;AACTC,4BAAQD,KAAR,CAAcA,KAAd;AACD;AACF,iBAJD;AAKD,eAND;AAOD,aATD,MASO;AACL;AACAwD,qBAAOoH,YAAP,CAAoB;AAClBpD,wBAAQ9D,OAAOmB,MADG;AAElB4C,qBAAKE,KAAK/B,IAAL,CAAU0B;AAFG,eAApB,EAGG,UAACtH,KAAD,EAAW;AACZsD,sBAAM,YAAM;AACV,sBAAItD,KAAJ,EAAW;AACTC,4BAAQD,KAAR,CAAcA,KAAd;AACD;AACF,iBAJD;AAKD,eATD;AAUD;AACF;AACF,SAzBD;AA0BD,OA3BD,EAF0C,CA8B1C;;AACAuK,kBAAYxK,IAAZ,CAAiB,IAAjB,EAAuB0K,MAAvB;AACD,KAhCD;AAiCD,GAhMkB,CAkMnB;AACA;AAEA;AACA;AACA;;;AACA7N,SAAOiO,WAAP,CAAmB,YAAM;AACvBtO,gBAAY+I,KAAZ,CAAkBkF,MAAlB,CAAyB;AACvB,uBAAiB;AACfM,cAAM,IAAI/J,IAAJ,CAAS,CAAC,IAAIA,IAAJ,EAAD,GAAc,MAAvB;AADS;AADM,KAAzB,EAIGzE,KAAKY,IAJR;AAKD,GAND,EAMG,MANH;AAQAN,SAAOmO,OAAP,CAAe,QAAf,EAAyB,YAAsC;AAAA,QAA7BC,IAA6B,uEAAtB,EAAsB;AAAA,QAAlB7L,QAAkB,uEAAP,KAAO;AAC7D6D,UAAMgI,IAAN,EAAYC,MAAZ;AACAjI,UAAM7D,QAAN,EAAgB+L,OAAhB;AAEA,QAAIC,iBAAJ;;AACA,QAAIhM,YAAY,KAAK0G,MAArB,EAA6B;AAC3BsF,iBAAW;AACTtF,gBAAQ,KAAKA;AADJ,OAAX;AAGD,KAJD,MAIO;AACLsF,iBAAW;AACTC,aAAK,CACH;AACE,2BAAiB,KADnB;AAEE,0BAAgB,KAFlB;AAGE,yBAAe;AACbC,iBAAK;AADQ;AAHjB,SADG,EAOA;AACDxF,kBAAQ,KAAKA;AADZ,SAPA;AADI,OAAX;AAaD;;AAED,WAAOtJ,YAAY+I,KAAZ,CAAkBoF,IAAlB,CAAuBS,QAAvB,EAAiC;AACtCG,aAAON,IAD+B;AAEtCO,YAAM;AACJ,2BAAmB,CAAC;AADhB,OAFgC;AAKtCC,cAAQ;AACN9E,aAAK,CADC;AAEN+E,cAAM,CAFA;AAGNpL,cAAM,CAHA;AAINuF,cAAM,CAJA;AAKNwE,cAAM,CALA;AAMNsB,eAAO,CAND;AAONC,gBAAQ,CAPF;AAQNC,gBAAQ,CARF;AASNC,iBAAS,CATH;AAUNC,iBAAS,CAVH;AAWNC,iBAAS,CAXH;AAYNlG,gBAAQ,CAZF;AAaN,0CAAkC,CAb5B;AAcN,sCAA8B,CAdxB;AAeN6D,mBAAW,CAfL;AAgBNsC,yBAAiB,CAhBX;AAiBNC,wBAAgB;AAjBV;AAL8B,KAAjC,EAwBJlG,MAxBH;AAyBD,GAlDD;AAoDAnJ,SAAOmO,OAAP,CAAe,MAAf,EAAuB,UAASrE,GAAT,EAAc;AACnC1D,UAAM0D,GAAN,EAAWwF,MAAX;AACA,WAAO3P,YAAY+I,KAAZ,CAAkBoF,IAAlB,CAAuB;AAC5BU,WAAK,CACH;AACE1E,aAAKA,GADP;AAEE,wBAAgB;AAFlB,OADG,EAIA;AACDA,aAAKA,GADJ;AAED,wBAAgB,IAFf;AAGDb,gBAAQ,KAAKA;AAHZ,OAJA;AADuB,KAAvB,EAWJ;AACD2F,cAAQ;AACN9E,aAAK,CADC;AAEN+E,cAAM,CAFA;AAGNpL,cAAM,CAHA;AAIN+J,cAAM,CAJA;AAKNxE,cAAM,CALA;AAMN8F,eAAO,CAND;AAONC,gBAAQ,CAPF;AAQNC,gBAAQ,CARF;AASNC,iBAAS,CATH;AAUNC,iBAAS,CAVH;AAWNC,iBAAS,CAXH;AAYNrC,mBAAW,CAZL;AAaN,sCAA8B,CAbxB;AAcNsC,yBAAiB,CAdX;AAeNC,wBAAgB;AAfV;AADP,KAXI,EA6BJlG,MA7BH;AA8BD,GAhCD;AAkCAnJ,SAAOuP,OAAP,CAAe;AACbC,eADa,cACiB;AAAA,UAAlBjN,QAAkB,uEAAP,KAAO;AAC5B6D,YAAM7D,QAAN,EAAgB+L,OAAhB;AAEA,UAAIC,iBAAJ;;AACA,UAAIhM,YAAY,KAAK0G,MAArB,EAA6B;AAC3BsF,mBAAW;AACTtF,kBAAQ,KAAKA;AADJ,SAAX;AAGD,OAJD,MAIO;AACLsF,mBAAW;AACTC,eAAK,CACH;AACE,6BAAiB,KADnB;AAEE,4BAAgB,KAFlB;AAGE,2BAAe;AACbC,mBAAK;AADQ;AAHjB,WADG,EAOA;AACDxF,oBAAQ,KAAKA;AADZ,WAPA;AADI,SAAX;AAaD;;AACD,aAAOtJ,YAAY+I,KAAZ,CAAkBoF,IAAlB,CAAuBS,QAAvB,EAAiCkB,KAAjC,EAAP;AACD,KAzBY;AA0BbC,WA1Ba,YA0BL5F,GA1BK,EA0BA;AACX1D,YAAM0D,GAAN,EAAWwF,MAAX;AACA3P,kBAAY+I,KAAZ,CAAkBmB,MAAlB,CAAyB;AACvBC,aAAKA;AADkB,OAAzB,EAEG;AACDC,cAAM;AACJ,yBAAe,CAAC;AADZ;AADL,OAFH,EAMGrK,KAAKY,IANR;AAOA,aAAO,IAAP;AACD,KApCY;AAqCbqP,SArCa,YAqCP7F,GArCO,EAqCF;AACT1D,YAAM0D,GAAN,EAAWwF,MAAX;AACA3P,kBAAY+I,KAAZ,CAAkBmB,MAAlB,CAAyB;AACvBC,aAAKA;AADkB,OAAzB,EAEG;AACDC,cAAM;AACJ,yBAAe;AADX;AADL,OAFH,EAMGrK,KAAKY,IANR;AAOA,aAAO,IAAP;AACD,KA/CY;AAgDbsP,gBAhDa,YAgDA9F,GAhDA,EAgDK;AAChB1D,YAAM0D,GAAN,EAAWwF,MAAX;;AACA,UAAItP,OAAOiJ,MAAP,EAAJ,EAAqB;AACnB,YAAMK,OAAO3J,YAAY+I,KAAZ,CAAkBgE,OAAlB,CAA0B;AACrC5C,eAAKA,GADgC;AAErCb,kBAAQjJ,OAAOiJ,MAAP;AAF6B,SAA1B,CAAb;;AAKA,YAAIK,IAAJ,EAAU;AACR3J,sBAAY+I,KAAZ,CAAkBmB,MAAlB,CAAyBC,GAAzB,EAA8B;AAC5ByC,kBAAM;AACJ,+BAAiBjD,KAAKN,IAAL,CAAU6G,QAAV,GAAqB,KAArB,GAA6B;AAD1C;AADsB,WAA9B,EAIGnQ,KAAKY,IAJR;AAKA,iBAAO,IAAP;AACD;AACF;;AACD,YAAM,IAAIN,OAAO8P,KAAX,CAAiB,GAAjB,EAAsB,gBAAtB,CAAN;AACD,KAlEY;AAmEbC,iBAnEa,YAmECjG,GAnED,EAmEM;AACjB1D,YAAM0D,GAAN,EAAWwF,MAAX;;AACA,UAAItP,OAAOiJ,MAAP,EAAJ,EAAqB;AACnB,YAAMK,OAAO3J,YAAY+I,KAAZ,CAAkBgE,OAAlB,CAA0B;AACrC5C,eAAKA,GADgC;AAErCb,kBAAQjJ,OAAOiJ,MAAP;AAF6B,SAA1B,CAAb;;AAKA,YAAIK,IAAJ,EAAU;AACR3J,sBAAY+I,KAAZ,CAAkBmB,MAAlB,CAAyBC,GAAzB,EAA8B;AAC5ByC,kBAAM;AACJ,+BAAiB,IADb;AAEJ,8BAAgBjD,KAAKN,IAAL,CAAU3G,OAAV,GAAoB,KAApB,GAA4B;AAFxC;AADsB,WAA9B,EAKG3C,KAAKY,IALR;AAMA,iBAAO,IAAP;AACD;AACF;;AACD,YAAM,IAAIN,OAAO8P,KAAX,CAAiB,GAAjB,EAAsB,gBAAtB,CAAN;AACD;AAtFY,GAAf;AAwFD,2H;;;;;;;;;;;AC5jBD,IAAIlQ,UAAJ;;AAAMJ,OAAOK,UAAP,CAAkB,mBAAlB,EAAsC;AAACD,KAAE,UAASE,CAAT,EAAW;AAACF,QAAEE,CAAF;AAAI;AAAnB,CAAtC,EAA2D,CAA3D;;AAA8D,IAAIJ,aAAJ;;AAASF,OAAOK,UAAP,CAAkB,mCAAlB,EAAsD;AAACH,QAAK,UAASI,CAAT,EAAW;AAACJ,WAAKI,CAAL;AAAO;AAAzB,CAAtD,EAAiF,CAAjF;AAAoF,IAAIsG,cAAJ;AAAU5G,OAAOK,UAAP,CAAkB,cAAlB,EAAiC;AAACuG,SAAM,UAAStG,CAAT,EAAW;AAACsG,YAAMtG,CAAN;AAAQ;AAA3B,CAAjC,EAA8D,CAA9D;AAAiE,IAAIE,eAAJ;AAAWR,OAAOK,UAAP,CAAkB,eAAlB,EAAkC;AAACG,UAAO,UAASF,CAAT,EAAW;AAACE,aAAOF,CAAP;AAAS;AAA7B,CAAlC,EAAiE,CAAjE;AAAoE,IAAI6G,WAAJ;AAAOnH,OAAOK,UAAP,CAAkB,UAAlB,EAA6B;AAAC,aAAQ,UAASC,CAAT,EAAW;AAAC6G,SAAG7G,CAAH;AAAK;AAA1B,CAA7B,EAAyD,CAAzD;AAA4D,IAAIkQ,WAAJ;AAAOxQ,OAAOK,UAAP,CAAkB,IAAlB,EAAuB;AAAC,aAAQ,UAASC,CAAT,EAAW;AAACkQ,SAAGlQ,CAAH;AAAK;AAA1B,CAAvB,EAAmD,CAAnD;AAQrY,IAAM4G,QAAQ1G,OAAOyI,eAAP,CAAuB,UAAC3H,QAAD,EAAc;AACjD,SAAOA,UAAP;AACD,CAFa,CAAd;;AAIApB,KAAKgO,gBAAL,GAAwB,UAAC9D,UAAD,EAAaM,OAAb,EAAsB+F,EAAtB,EAA6B;AACnD7J,QAAM8D,OAAN,EAAegG,MAAf;AAEA,MAAIC,SAAS,KAAb;;AACA,MAAMC,SAAS,UAAChN,KAAD,EAAW;AACxBsD,UAAM,YAAM;AACV,UAAItD,KAAJ,EAAW;AACTC,gBAAQD,KAAR,CAAc,kCAAd,EAAkDA,KAAlD;AACA6M,cAAMA,GAAI7M,KAAJ,CAAN;AACD,OAHD,MAGO;AACL,YAAI+M,MAAJ,EAAY;AACVF,gBAAMA,GAAG,KAAK,CAAR,EAAW/F,OAAX,CAAN;AACD;AACF;;AACD,aAAO,IAAP;AACD,KAVD;AAWD,GAZD;;AAcAvD,KAAG0J,MAAH,CAAUnG,QAAQtH,IAAlB,EAAwB,UAACyN,MAAD,EAAY;AAClC3J,UAAM,YAAM;AACV,UAAI,CAAC2J,MAAL,EAAa;AACX,cAAMrQ,OAAOsQ,GAAP,CAAWlN,KAAX,CAAiB,UAAU8G,QAAQtH,IAAlB,GAAyB,yCAA1C,CAAN;AACD;;AACD,UAAM2N,QAAQP,GAAG9F,QAAQtH,IAAX,CAAd;AACA,UAAM4N,QAAQ;AACZC,iBAAS;AACPC,iBAAO;AADA,SADG;AAIZC,qBAAa;AACXD,iBAAO,EADI;AAEXE,kBAAQ;AAFG;AAJD,OAAd;AAUAL,YAAM9M,IAAN,CAAW,UAACL,KAAD,EAAQyN,QAAR,EAAqB;AAC9BnK,cAAM,YAAM;AACV,cAAItD,KAAJ,EAAW;AACTC,oBAAQD,KAAR,CAAc,wCAAd,EAAwDA,KAAxD;AACAgN,mBAAOpQ,OAAO8P,KAAP,CAAa,wCAAb,EAAuD1M,KAAvD,CAAP;AACA;AACD;;AAED,cAAI0N,IAAI,CAAR;AACAlH,qBAAWA,UAAX,CAAsBC,MAAtB,CAA6BK,QAAQJ,GAArC,EAA0C;AACxCyC,kBAAM;AACJ,4BAAcsE,SAASH,KADnB;AAEJ,6BAAeG,SAASE,MAFpB;AAGJ,8CAAgCF,SAASH,KAHrC;AAIJ,+CAAiCG,SAASE;AAJtC;AADkC,WAA1C,EAOGrR,KAAKY,IAPR;;AASAV,YAAEqN,IAAF,CAAOuD,KAAP,EAAc,UAAC/M,IAAD,EAAOoL,IAAP,EAAgB;AAC5B,gBAAMjM,OAAQgH,WAAWhB,WAAX,CAAuBsB,OAAvB,CAAD,GAAoC,GAApC,GAA0C2E,IAA1C,GAAiD,GAAjD,GAAuD3E,QAAQJ,GAA/D,GAAqE,GAArE,GAA2EI,QAAQ4C,SAAhG;;AACA,gBAAMkE,YAAY,YAAM;AACtBrK,iBAAGsK,IAAH,CAAQ/G,QAAQtH,IAAhB,EAAsBA,IAAtB,EAA4B,UAACsO,WAAD,EAAiB;AAC3CxK,sBAAM,YAAM;AACV,sBAAIwK,WAAJ,EAAiB;AACf7N,4BAAQD,KAAR,CAAc,kDAAd,EAAkE8N,WAAlE;AACAd,2BAAOc,WAAP;AACA;AACD;;AAED,sBAAM5E,MAAM;AAAEC,0BAAM;AAAR,mBAAZ;AACAD,sBAAI,MAAJ,EAAY,cAAcuC,IAA1B,IAAkC;AAChCjM,0BAAMA,IAD0B;AAEhCa,0BAAMyG,QAAQzG,IAFkB;AAGhC+J,0BAAMtD,QAAQsD,IAHkB;AAIhCV,+BAAW5C,QAAQ4C,SAJa;AAKhC9D,0BAAM;AACJ0H,6BAAOG,SAASH,KADZ;AAEJK,8BAAQF,SAASE;AAFb;AAL0B,mBAAlC;AAUAnH,6BAAWA,UAAX,CAAsBC,MAAtB,CAA6BK,QAAQJ,GAArC,EAA0CwC,GAA1C,EAA+C,UAAC6E,WAAD,EAAiB;AAC9D,sBAAEL,CAAF;;AACA,wBAAIA,MAAMZ,OAAOkB,IAAP,CAAYZ,KAAZ,EAAmB3M,MAA7B,EAAqC;AACnCsM,+BAAS,IAAT;AACD;;AACDC,2BAAOe,WAAP;AACD,mBAND;AAOD,iBAzBD;AA0BD,eA3BD;AA4BD,aA7BD;;AA+BA,gBAAI,aAAa1D,IAAb,CAAkBvD,QAAQ4C,SAA1B,CAAJ,EAA0C;AACxC,kBAAMuE,MAAMrB,GAAG9F,QAAQtH,IAAX,EACT0O,OADS,CACD,EADC,EAETC,MAFS,CAEF,kBAFE,EAGTA,MAHS,CAGF,6BAHE,EAITA,MAJS,CAIF,2BAJE,EAKTA,MALS,CAKF,0BALE,EAMTA,MANS,CAMF,yBANE,EAOTA,MAPS,CAOF,4BAPE,EAQTA,MARS,CAQF,uBARE,EASTC,UATS,GAUTC,SAVS,GAWTC,KAXS,GAYTC,MAZS,CAYF,KAZE,EAaTC,SAbS,CAaC,MAbD,EAcTC,MAdS,CAcF,UAdE,CAAZ;;AAgBA,kBAAMC,gBAAgB,UAACC,YAAD,EAAkB;AACtCrL,sBAAM,YAAM;AACV,sBAAIqL,YAAJ,EAAkB;AAChB1O,4BAAQD,KAAR,CAAc,qDAAd,EAAqE2O,YAArE;AACA3B,2BAAO2B,YAAP;AACA;AACD;;AACDpL,qBAAGsF,IAAH,CAAQrJ,IAAR,EAAc,UAACoP,WAAD,EAAc/F,IAAd,EAAuB;AACnCvF,0BAAM,YAAM;AACV,0BAAIsL,WAAJ,EAAiB;AACf3O,gCAAQD,KAAR,CAAc,+DAAd,EAA+E4O,WAA/E;AACA5B,+BAAO4B,WAAP;AACA;AACD;;AAEDhC,yBAAGpN,IAAH,EAASa,IAAT,CAAc,UAACwO,WAAD,EAAcC,OAAd,EAA0B;AACtCxL,8BAAM,YAAM;AACV,8BAAIuL,WAAJ,EAAiB;AACf5O,oCAAQD,KAAR,CAAc,+EAAd,EAA+F6O,WAA/F;AACA7B,mCAAO6B,WAAP;AACA;AACD;;AACD,8BAAM3F,MAAM;AAAEC,kCAAM;AAAR,2BAAZ;AACAD,8BAAI,MAAJ,EAAY,cAAcuC,IAA1B,IAAkC;AAChCjM,kCAAMA,IAD0B;AAEhCa,kCAAMwI,KAAKxI,IAFqB;AAGhC+J,kCAAMtD,QAAQsD,IAHkB;AAIhCV,uCAAW5C,QAAQ4C,SAJa;AAKhC9D,kCAAM;AACJ0H,qCAAOwB,QAAQxB,KADX;AAEJK,sCAAQmB,QAAQnB;AAFZ;AAL0B,2BAAlC;AAWAnH,qCAAWA,UAAX,CAAsBC,MAAtB,CAA6BK,QAAQJ,GAArC,EAA0CwC,GAA1C,EAA+C,UAAC6E,WAAD,EAAiB;AAC9D,8BAAEL,CAAF;;AACA,gCAAIA,MAAMZ,OAAOkB,IAAP,CAAYZ,KAAZ,EAAmB3M,MAA7B,EAAqC;AACnCsM,uCAAS,IAAT;AACD;;AACDC,mCAAOe,WAAP;AACD,2BAND;AAOD,yBAzBD;AA0BD,uBA3BD;AA4BD,qBAnCD;AAoCD,mBArCD;AAsCD,iBA5CD;AA6CD,eA9CD;;AAgDA,kBAAI,CAAC1N,KAAKmN,MAAV,EAAkB;AAChB,oBAAIC,SAASH,KAAT,GAAiBjN,KAAKiN,KAA1B,EAAiC;AAC/BW,sBAAIc,MAAJ,CAAW1O,KAAKiN,KAAhB,EAAuBkB,SAAvB,CAAiC,MAAjC,EAAyCQ,KAAzC,CAA+CxP,IAA/C,EAAqDkP,aAArD;AACD,iBAFD,MAEO;AACLd;AACD;AACF,eAND,MAMO;AACL,oBAAIqB,IAAI,CAAR;AACA,oBAAIC,IAAI,CAAR;AACA,oBAAMC,aAAc1B,SAASH,KAAT,GAAiBjN,KAAKiN,KAA1C;AACA,oBAAM8B,cAAc3B,SAASE,MAAT,GAAkBtN,KAAKiN,KAA3C;AACA,oBAAI+B,WAAgBhP,KAAKiN,KAAzB;AACA,oBAAIgC,YAAgBjP,KAAKiN,KAAzB;;AAEA,oBAAI8B,cAAcD,UAAlB,EAA8B;AAC5BE,6BAAYhP,KAAKiN,KAAL,GAAaG,SAASH,KAAvB,GAAgCG,SAASE,MAApD;AACAsB,sBAAI,CAACI,WAAWhP,KAAKiN,KAAjB,IAA0B,CAA9B;AACD;;AAED,oBAAI8B,cAAcD,UAAlB,EAA8B;AAC5BG,8BAAajP,KAAKiN,KAAL,GAAaG,SAASE,MAAvB,GAAiCF,SAASH,KAAtD;AACA4B,sBAAI,CAACI,YAAYjP,KAAKiN,KAAlB,IAA2B,CAA/B;AACD;;AAEDW,oBACGc,MADH,CACUM,QADV,EACoBC,SADpB,EAEGC,IAFH,CAEQlP,KAAKiN,KAFb,EAEoBjN,KAAKiN,KAFzB,EAEgC2B,CAFhC,EAEmCC,CAFnC,EAGGV,SAHH,CAGa,MAHb,EAIGQ,KAJH,CAISxP,IAJT,EAIekP,aAJf;AAKD;AACF,aA/FD,MA+FO;AACLd;AACD;AACF,WAnID;AAoID,SArJD;AAsJD,OAvJD;AAwJD,KAvKD;AAwKD,GAzKD;AA0KA,SAAO,IAAP;AACD,CA7LD,0H;;;;;;;;;;;ACZA,IAAIhR,eAAJ;AAAWR,OAAOK,UAAP,CAAkB,eAAlB,EAAkC;AAACG,UAAO,UAASF,CAAT,EAAW;AAACE,aAAOF,CAAP;AAAS;AAA7B,CAAlC,EAAiE,CAAjE;AAAoE,IAAI8S,6BAAJ;AAAyBpT,OAAOK,UAAP,CAAkB,8BAAlB,EAAiD;AAAC+S,wBAAqB,UAAS9S,CAAT,EAAW;AAAC8S,2BAAqB9S,CAArB;AAAuB;AAAzD,CAAjD,EAA4G,CAA5G;AAGxG,IAAM+S,MAAM,EAAZ;AACAD,qBAAqBE,cAArB,CAAoClF,MAApC,CAA2C,EAA3C;;AAEA,IAAIzG,QAAQC,GAAR,CAAY2L,kBAAZ,IAAkC5L,QAAQC,GAAR,CAAY4L,mBAAlD,EAAuE;AACrEH,MAAII,MAAJ,GAAa,IAAb;AACAL,uBAAqBE,cAArB,CAAoCI,MAApC,CAA2C;AACzCC,aAAS;AADgC,GAA3C,EAEG;AACD5G,UAAM;AACJ1E,cAAQV,QAAQC,GAAR,CAAY4L,mBADhB;AAEJI,gBAAUjM,QAAQC,GAAR,CAAY2L,kBAFlB;AAGJM,kBAAY;AAHR;AADL,GAFH;AASD;;AAED,IAAIlM,QAAQC,GAAR,CAAYkM,kBAAZ,IAAkCnM,QAAQC,GAAR,CAAYmM,mBAAlD,EAAuE;AACrEV,MAAIW,MAAJ,GAAa,IAAb;AACAZ,uBAAqBE,cAArB,CAAoCI,MAApC,CAA2C;AACzCC,aAAS;AADgC,GAA3C,EAEG;AACD5G,UAAM;AACJ1E,cAAQV,QAAQC,GAAR,CAAYmM,mBADhB;AAEJH,gBAAUjM,QAAQC,GAAR,CAAYkM,kBAFlB;AAGJD,kBAAY;AAHR;AADL,GAFH;AASD;;AAED,IAAIlM,QAAQC,GAAR,CAAYqM,mBAAZ,IAAmCtM,QAAQC,GAAR,CAAYsM,oBAAnD,EAAyE;AACvEb,MAAIc,OAAJ,GAAc,IAAd;AACAf,uBAAqBE,cAArB,CAAoCI,MAApC,CAA2C;AACzCC,aAAS;AADgC,GAA3C,EAEG;AACD5G,UAAM;AACJ8G,kBAAY,UADR;AAEJxL,cAAQV,QAAQC,GAAR,CAAYsM,oBAFhB;AAGJE,mBAAazM,QAAQC,GAAR,CAAYqM;AAHrB;AADL,GAFH;AASD;;AAED,IAAItM,QAAQC,GAAR,CAAYyM,oBAAZ,IAAoC1M,QAAQC,GAAR,CAAY0M,qBAApD,EAA2E;AACzEjB,MAAIkB,QAAJ,GAAe,IAAf;AACAnB,uBAAqBE,cAArB,CAAoCI,MAApC,CAA2C;AACzCC,aAAS;AADgC,GAA3C,EAEG;AACD5G,UAAM;AACJ1E,cAAQV,QAAQC,GAAR,CAAY0M,qBADhB;AAEJE,aAAO7M,QAAQC,GAAR,CAAYyM,oBAFf;AAGJR,kBAAY;AAHR;AADL,GAFH;AASD;;AAEDrT,OAAOuP,OAAP,CAAe;AACb0E,yBADa,cACa;AACxB,WAAOpB,GAAP;AACD;AAHY,CAAf,yH;;;;;;;;;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yH","file":"/app.js","sourcesContent":["import { _ }             from 'meteor/underscore';\nimport { $ }             from 'meteor/jquery';\nimport { Meteor }        from 'meteor/meteor';\nimport { FPSMeter }      from 'meteor/ostrio:fps-meter';\nimport { Template }      from 'meteor/templating';\nimport { FlowRouter }    from 'meteor/ostrio:flow-router-extra';\nimport { ReactiveVar }   from 'meteor/reactive-var';\nimport { ClientStorage } from 'meteor/ostrio:cstorage';\n\nconst Collections = {};\nconst _app = { NOOP(){} };\n\nif (Meteor.isClient) {\n  window.IS_RENDERED = false;\n  if (!window.requestAnimFrame) {\n    window.requestAnimFrame = (() => {\n      return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (callback) {\n        window.setTimeout(callback, 1000 / 60);\n      };\n    })();\n  }\n  if (!ClientStorage.has('blamed') || !_.isArray(ClientStorage.get('blamed'))) {\n    ClientStorage.set('blamed', []);\n  }\n  if (!ClientStorage.has('unlist') || !_.isBoolean(ClientStorage.get('unlist'))) {\n    ClientStorage.set('unlist', true);\n  }\n  if (!ClientStorage.has('secured') || !_.isBoolean(ClientStorage.get('secured'))) {\n    ClientStorage.set('secured', false);\n  }\n  if (!ClientStorage.has('userOnly') || !_.isBoolean(ClientStorage.get('userOnly'))) {\n    ClientStorage.set('userOnly', false);\n  }\n\n  let _el = null;\n  $(window).on('dragenter dragover', (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    _el = e.target;\n    const uf = document.getElementById('uploadFile');\n    if (!~uf.className.indexOf('file-over')) {\n      uf.className += ' file-over';\n    }\n    return false;\n  });\n\n  $(window).on('dragleave', (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (_el === e.target) {\n      const uf = document.getElementById('uploadFile');\n      if (!!~uf.className.indexOf('file-over')) {\n        uf.className = uf.className.replace(' file-over', '');\n      }\n    }\n    return false;\n  });\n\n  $(window).on('drop', (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    const uf = document.getElementById('uploadFile');\n    if (!!~uf.className.indexOf('file-over')) {\n      uf.className = uf.className.replace(' file-over', '');\n    }\n    return false;\n  });\n\n  _app.subs     = new SubsManager();\n  _app.blamed   = new ReactiveVar(ClientStorage.get('blamed'));\n  _app.unlist   = new ReactiveVar(ClientStorage.get('unlist'));\n  _app.secured  = new ReactiveVar(ClientStorage.get('secured'));\n  _app.uploads  = new ReactiveVar(false);\n  _app.userOnly = new ReactiveVar(ClientStorage.get('userOnly'));\n  _app.storeTTL = 86400000;\n  _app.currentUrl = () => {\n    return Meteor.absoluteUrl((FlowRouter.current().path || document.location.pathname).replace(/^\\//g, '')).split('?')[0].split('#')[0].replace('!', '');\n  };\n  _app.storeTTLUser = 432000000;\n  _app.showProjectInfo = new ReactiveVar(false);\n  _app.serviceConfiguration = new ReactiveVar({});\n\n  Meteor.call('getServiceConfiguration', (error, serviceConfiguration) => {\n    if (error) {\n      console.error(error);\n    } else {\n      _app.serviceConfiguration.set(serviceConfiguration);\n    }\n  });\n\n  Meteor.autorun(() => {\n    ClientStorage.set('blamed', _app.blamed.get());\n  });\n\n  Meteor.autorun(() => {\n    ClientStorage.set('unlist', _app.unlist.get());\n  });\n\n  Meteor.autorun(() => {\n    ClientStorage.set('secured', _app.secured.get());\n  });\n\n  Meteor.autorun(() => {\n    ClientStorage.set('userOnly', _app.userOnly.get());\n  });\n\n  if (!ClientStorage.has('uploadTransport')) {\n    ClientStorage.set('uploadTransport', 'ddp');\n  }\n\n  Template.registerHelper('urlCurrent', () => {\n    return _app.currentUrl();\n  });\n\n  Template.registerHelper('url', (string = null) => {\n    return Meteor.absoluteUrl(string);\n  });\n\n  Template.registerHelper('filesize', (size = 0) => {\n    return filesize(size);\n  });\n\n  Template.registerHelper('extless', (filename = '') => {\n    const parts = filename.split('.');\n    if (parts.length > 1) {\n      parts.pop();\n    }\n    return parts.join('.');\n  });\n\n  Template.registerHelper('DateToISO', (time = 0) => {\n    if (_.isString(time) || _.isNumber(time)) {\n      time = new Date(time);\n    }\n    return time.toISOString();\n  });\n\n  Template._404.onRendered(function() {\n    window.IS_RENDERED = true;\n  });\n\n  Template._layout.helpers({\n    showProjectInfo() {\n      return _app.showProjectInfo.get();\n    }\n  });\n  Template._layout.events({\n    'click [data-show-project-info]'(e) {\n      e.preventDefault();\n      _app.showProjectInfo.set(!_app.showProjectInfo.get());\n      return false;\n    }\n  });\n  marked.setOptions({\n    highlight(code) {\n      return hljs.highlightAuto(code).value;\n    },\n    renderer: new marked.Renderer(),\n    gfm: true,\n    tables: true,\n    breaks: false,\n    pedantic: false,\n    sanitize: true,\n    smartLists: true,\n    smartypants: false\n  });\n\n  Meteor.startup(() => {\n    $('html').attr('itemscope', '');\n    $('html').attr('itemtype', 'http://schema.org/WebPage');\n    $('html').attr('xmlns:og', 'http://ogp.me/ns#');\n    $('html').attr('xml:lang', 'en');\n    $('html').attr('lang', 'en');\n\n    const FPS = new FPSMeter({\n      ui: true,\n      reactive: false\n    });\n\n    FPS.start();\n    const regStop = () => {\n      $('#__FPSMeter').click(() => {\n        if (FPS.isRunning) {\n          FPS.isRunning = false;\n        } else {\n          FPS.stop();\n          window.requestAnimFrame(() => {\n            FPS.start();\n            regStop();\n          });\n        }\n      });\n    };\n\n    regStop();\n  });\n}\n\nexport { _app, Collections };\n","import { _ }                 from 'meteor/underscore';\nimport { check }             from 'meteor/check';\nimport { Meteor }            from 'meteor/meteor';\nimport { Random }            from 'meteor/random';\nimport { FilesCollection }   from 'meteor/ostrio:files';\nimport { _app, Collections } from '/lib/__compatibility/__globals.js';\n\n// DropBox usage:\n// Read: https://github.com/VeliovGroup/Meteor-Files/wiki/DropBox-Integration\n// env.var example: DROPBOX='{\"dropbox\":{\"key\": \"xxx\", \"secret\": \"xxx\", \"token\": \"xxx\"}}'\nlet useDropBox = false;\n\n// AWS:S3 usage:\n// Read: https://github.com/VeliovGroup/Meteor-Files/wiki/AWS-S3-Integration\n// env.var example: S3='{\"s3\":{\"key\": \"xxx\", \"secret\": \"xxx\", \"bucket\": \"xxx\", \"region\": \"xxx\"\"}}'\nlet useS3 = false;\nlet request, bound, fs, client, sendToStorage, s3Conf, dbConf, stream;\n\nif (Meteor.isServer) {\n  fs = require('fs-extra');\n\n  if (process.env.DROPBOX) {\n    Meteor.settings.dropbox = JSON.parse(process.env.DROPBOX).dropbox;\n  } else if (process.env.S3) {\n    Meteor.settings.s3 = JSON.parse(process.env.S3).s3;\n  }\n\n  s3Conf = Meteor.settings.s3 || {};\n  dbConf = Meteor.settings.dropbox || {};\n\n  if (dbConf && dbConf.key && dbConf.secret && dbConf.token) {\n    useDropBox    = true;\n    const Dropbox = require('dropbox');\n\n    client = new Dropbox.Client({\n      key: dbConf.key,\n      secret: dbConf.secret,\n      token: dbConf.token\n    });\n  } else if (s3Conf && s3Conf.key && s3Conf.secret && s3Conf.bucket && s3Conf.region) {\n    useS3    = true;\n    stream   = require('stream');\n    const S3 = require('aws-sdk/clients/s3');\n\n    client = new S3({\n      secretAccessKey: s3Conf.secret,\n      accessKeyId: s3Conf.key,\n      region: s3Conf.region,\n      sslEnabled: false,\n      httpOptions: {\n        timeout: 6000,\n        agent: false\n      }\n    });\n  }\n\n  if (useS3 || useDropBox) {\n    request = require('request');\n    bound   = Meteor.bindEnvironment((callback) => {\n      return callback();\n    });\n  }\n}\n\nCollections.files = new FilesCollection({\n  // debug: true,\n  // throttle: false,\n  chunkSize: 1024 * 768,\n  storagePath: 'assets/app/uploads/uploadedFiles',\n  collectionName: 'uploadedFiles',\n  allowClientCode: true,\n  protected(fileObj) {\n    if (fileObj) {\n      if (!(fileObj.meta && fileObj.meta.secured)) {\n        return true;\n      } else if ((fileObj.meta && fileObj.meta.secured === true) && this.userId === fileObj.userId) {\n        return true;\n      }\n    }\n    return false;\n  },\n  onBeforeRemove(cursor) {\n    const res = cursor.map((file) => {\n      if (file && file.userId && _.isString(file.userId)) {\n        return file.userId === this.userId;\n      }\n      return false;\n    });\n    return !~res.indexOf(false);\n  },\n  onBeforeUpload() {\n    if (this.file.size <= 1024 * 1024 * 128) {\n      return true;\n    }\n    return \"Max. file size is 128MB you've tried to upload \" + (filesize(this.file.size));\n  },\n  downloadCallback(fileObj) {\n    if (this.params && this.params.query && this.params.query.download === 'true') {\n      Collections.files.collection.update(fileObj._id, {\n        $inc: {\n          'meta.downloads': 1\n        }\n      }, _app.NOOP);\n    }\n    return true;\n  },\n  interceptDownload(http, fileRef, version) {\n    let path;\n    if (useDropBox) {\n      path = (fileRef && fileRef.versions && fileRef.versions[version] && fileRef.versions[version].meta && fileRef.versions[version].meta.pipeFrom) ? fileRef.versions[version].meta.pipeFrom : void 0;\n      if (path) {\n        // If file is successfully moved to Storage\n        // We will pipe request to Storage\n        // So, original link will stay always secure\n\n        // To force ?play and ?download parameters\n        // and to keep original file name, content-type,\n        // content-disposition and cache-control\n        // we're using low-level .serve() method\n        this.serve(http, fileRef, fileRef.versions[version], version, request({\n          url: path,\n          headers: _.pick(http.request.headers, 'range', 'cache-control', 'connection')\n        }));\n        return true;\n      }\n      // While file is not yet uploaded to Storage\n      // We will serve file from FS\n      return false;\n    } else if (useS3) {\n      path = (fileRef && fileRef.versions && fileRef.versions[version] && fileRef.versions[version].meta && fileRef.versions[version].meta.pipePath) ? fileRef.versions[version].meta.pipePath : void 0;\n      if (path) {\n        // If file is successfully moved to Storage\n        // We will pipe request to Storage\n        // So, original link will stay always secure\n\n        // To force ?play and ?download parameters\n        // and to keep original file name, content-type,\n        // content-disposition and cache-control\n        // we're using low-level .serve() method\n        const opts = {\n          Bucket: s3Conf.bucket,\n          Key: path\n        };\n\n        if (http.request.headers.range) {\n          const vRef  = fileRef.versions[version];\n          let range   = _.clone(http.request.headers.range);\n          const array = range.split(/bytes=([0-9]*)-([0-9]*)/);\n          const start = parseInt(array[1]);\n          let end     = parseInt(array[2]);\n          if (isNaN(end)) {\n            // Request data from AWS:S3 by small chunks\n            end       = (start + this.chunkSize) - 1;\n            if (end >= vRef.size) {\n              end     = vRef.size - 1;\n            }\n          }\n          opts.Range   = `bytes=${start}-${end}`;\n          http.request.headers.range = `bytes=${start}-${end}`;\n        }\n\n        const fileColl = this;\n        client.getObject(opts, function (error) {\n          if (error) {\n            console.error(error);\n            if (!http.response.finished) {\n              http.response.end();\n            }\n          } else {\n            if (http.request.headers.range && this.httpResponse.headers['content-range']) {\n              // Set proper range header in according to what is returned from AWS:S3\n              http.request.headers.range = this.httpResponse.headers['content-range'].split('/')[0].replace('bytes ', 'bytes=');\n            }\n\n            const dataStream = new stream.PassThrough();\n            fileColl.serve(http, fileRef, fileRef.versions[version], version, dataStream);\n            dataStream.end(this.data.Body);\n          }\n        });\n\n        return true;\n      }\n      // While file is not yet uploaded to Storage\n      // We will serve file from FS\n      return false;\n    }\n    return false;\n  }\n});\n\nif (Meteor.isServer) {\n  Collections.files.denyClient();\n  Collections.files.on('afterUpload', function(fileRef) {\n    if (useDropBox) {\n      const makeUrl = (stat, fileRef, version, triesUrl = 0) => {\n        client.makeUrl(stat.path, {\n          long: true,\n          downloadHack: true\n        }, (error, xml) => {\n          bound(() => {\n            // Store downloadable link in file's meta object\n            if (error) {\n              if (triesUrl < 10) {\n                Meteor.setTimeout(() => {\n                  makeUrl(stat, fileRef, version, ++triesUrl);\n                }, 2048);\n              } else {\n                console.error(error, {\n                  triesUrl: triesUrl\n                });\n              }\n            } else if (xml) {\n              const upd = { $set: {} };\n              upd['$set']['versions.' + version + '.meta.pipeFrom'] = xml.url;\n              upd['$set']['versions.' + version + '.meta.pipePath'] = stat.path;\n              this.collection.update({\n                _id: fileRef._id\n              }, upd, (updError) => {\n                if (updError) {\n                  console.error(updError);\n                } else {\n                  // Unlink original files from FS\n                  // after successful upload to DropBox\n                  this.unlink(this.collection.findOne(fileRef._id), version);\n                }\n              });\n            } else {\n              if (triesUrl < 10) {\n                Meteor.setTimeout(() => {\n                  // Generate downloadable link\n                  makeUrl(stat, fileRef, version, ++triesUrl);\n                }, 2048);\n              } else {\n                console.error(\"client.makeUrl doesn't returns xml\", {\n                  triesUrl: triesUrl\n                });\n              }\n            }\n          });\n        });\n      };\n\n      const writeToDB = (fileRef, version, data, triesSend = 0) => {\n        // DropBox already uses random URLs\n        // No need to use random file names\n        client.writeFile(fileRef._id + '-' + version + '.' + fileRef.extension, data, (error, stat) => {\n          bound(() => {\n            if (error) {\n              if (triesSend < 10) {\n                Meteor.setTimeout(() => {\n                  // Write file to DropBox\n                  writeToDB(fileRef, version, data, ++triesSend);\n                }, 2048);\n              } else {\n                console.error(error, {\n                  triesSend: triesSend\n                });\n              }\n            } else {\n              makeUrl(stat, fileRef, version);\n            }\n          });\n        });\n      };\n\n      const readFile = (fileRef, vRef, version, triesRead = 0) => {\n        fs.readFile(vRef.path, (error, data) => {\n          bound(() => {\n            if (error) {\n              if (triesRead < 10) {\n                readFile(fileRef, vRef, version, ++triesRead);\n              } else {\n                console.error(error);\n              }\n            } else {\n              writeToDB(fileRef, version, data);\n            }\n          });\n        });\n      };\n\n      sendToStorage = (fileRef) => {\n        _.each(fileRef.versions, (vRef, version) => {\n          readFile(fileRef, vRef, version);\n        });\n      };\n    } else if (useS3) {\n      sendToStorage = (fileRef) => {\n        _.each(fileRef.versions, (vRef, version) => {\n          // We use Random.id() instead of real file's _id\n          // to secure files from reverse engineering\n          // As after viewing this code it will be easy\n          // to get access to unlisted and protected files\n          const filePath = 'files/' + (Random.id()) + '-' + version + '.' + fileRef.extension;\n\n          client.putObject({\n            StorageClass: 'STANDARD',\n            Bucket: s3Conf.bucket,\n            Key: filePath,\n            Body: fs.createReadStream(vRef.path),\n            ContentType: vRef.type,\n          }, (error) => {\n            bound(() => {\n              if (error) {\n                console.error(error);\n              } else {\n                const upd = { $set: {} };\n                upd['$set']['versions.' + version + '.meta.pipePath'] = filePath;\n                this.collection.update({\n                  _id: fileRef._id\n                }, upd, (updError) => {\n                  if (updError) {\n                    console.error(updError);\n                  } else {\n                    // Unlink original file from FS\n                    // after successful upload to AWS:S3\n                    this.unlink(this.collection.findOne(fileRef._id), version);\n                  }\n                });\n              }\n            });\n          });\n        });\n      };\n    }\n\n    if (/png|jpe?g/i.test(fileRef.extension || '')) {\n      _app.createThumbnails(this, fileRef, (error, fileRef) => {\n        if (error) {\n          console.error(error);\n        }\n        if (useDropBox || useS3) {\n          sendToStorage(this.collection.findOne(fileRef._id));\n        }\n      });\n    } else {\n      if (useDropBox || useS3) {\n        sendToStorage(fileRef);\n      }\n    }\n  });\n\n  // This line now commented due to Heroku usage\n  // Collections.files.collection._ensureIndex {'meta.expireAt': 1}, {expireAfterSeconds: 0, background: true}\n\n  // Intercept FileCollection's remove method\n  // to remove file from DropBox or AWS S3\n  if (useDropBox || useS3) {\n    const _origRemove = Collections.files.remove;\n    Collections.files.remove = function(search) {\n      const cursor = this.collection.find(search);\n      cursor.forEach((fileRef) => {\n        _.each(fileRef.versions, (vRef) => {\n          if (vRef && vRef.meta && vRef.meta.pipePath != null) {\n            if (useDropBox) {\n              // DropBox usage:\n              client.remove(vRef.meta.pipePath, (error) => {\n                bound(() => {\n                  if (error) {\n                    console.error(error);\n                  }\n                });\n              });\n            } else {\n              // AWS:S3 usage:\n              client.deleteObject({\n                Bucket: s3Conf.bucket,\n                Key: vRef.meta.pipePath,\n              }, (error) => {\n                bound(() => {\n                  if (error) {\n                    console.error(error);\n                  }\n                });\n              });\n            }\n          }\n        });\n      });\n      // Call original method\n      _origRemove.call(this, search);\n    };\n  }\n\n  // Remove all files on server load/reload, useful while testing/development\n  // Meteor.startup -> Collections.files.remove {}\n\n  // Remove files along with MongoDB records two minutes before expiration date\n  // If we have 'expireAfterSeconds' index on 'meta.expireAt' field,\n  // it won't remove files themselves.\n  Meteor.setInterval(() => {\n    Collections.files.remove({\n      'meta.expireAt': {\n        $lte: new Date(+new Date() + 120000)\n      }\n    }, _app.NOOP);\n  }, 120000);\n\n  Meteor.publish('latest', function(take = 10, userOnly = false) {\n    check(take, Number);\n    check(userOnly, Boolean);\n\n    let selector;\n    if (userOnly && this.userId) {\n      selector = {\n        userId: this.userId\n      };\n    } else {\n      selector = {\n        $or: [\n          {\n            'meta.unlisted': false,\n            'meta.secured': false,\n            'meta.blamed': {\n              $lt: 3\n            }\n          }, {\n            userId: this.userId\n          }\n        ]\n      };\n    }\n\n    return Collections.files.find(selector, {\n      limit: take,\n      sort: {\n        'meta.created_at': -1\n      },\n      fields: {\n        _id: 1,\n        name: 1,\n        size: 1,\n        meta: 1,\n        type: 1,\n        isPDF: 1,\n        isText: 1,\n        isJSON: 1,\n        isVideo: 1,\n        isAudio: 1,\n        isImage: 1,\n        userId: 1,\n        'versions.thumbnail40.extension': 1,\n        'versions.preview.extension': 1,\n        extension: 1,\n        _collectionName: 1,\n        _downloadRoute: 1\n      }\n    }).cursor;\n  });\n\n  Meteor.publish('file', function(_id) {\n    check(_id, String);\n    return Collections.files.find({\n      $or: [\n        {\n          _id: _id,\n          'meta.secured': false\n        }, {\n          _id: _id,\n          'meta.secured': true,\n          userId: this.userId\n        }\n      ]\n    }, {\n      fields: {\n        _id: 1,\n        name: 1,\n        size: 1,\n        type: 1,\n        meta: 1,\n        isPDF: 1,\n        isText: 1,\n        isJSON: 1,\n        isVideo: 1,\n        isAudio: 1,\n        isImage: 1,\n        extension: 1,\n        'versions.preview.extension': 1,\n        _collectionName: 1,\n        _downloadRoute: 1\n      }\n    }).cursor;\n  });\n\n  Meteor.methods({\n    filesLenght(userOnly = false) {\n      check(userOnly, Boolean);\n\n      let selector;\n      if (userOnly && this.userId) {\n        selector = {\n          userId: this.userId\n        };\n      } else {\n        selector = {\n          $or: [\n            {\n              'meta.unlisted': false,\n              'meta.secured': false,\n              'meta.blamed': {\n                $lt: 3\n              }\n            }, {\n              userId: this.userId\n            }\n          ]\n        };\n      }\n      return Collections.files.find(selector).count();\n    },\n    unblame(_id) {\n      check(_id, String);\n      Collections.files.update({\n        _id: _id\n      }, {\n        $inc: {\n          'meta.blamed': -1\n        }\n      }, _app.NOOP);\n      return true;\n    },\n    blame(_id) {\n      check(_id, String);\n      Collections.files.update({\n        _id: _id\n      }, {\n        $inc: {\n          'meta.blamed': 1\n        }\n      }, _app.NOOP);\n      return true;\n    },\n    changeAccess(_id) {\n      check(_id, String);\n      if (Meteor.userId()) {\n        const file = Collections.files.findOne({\n          _id: _id,\n          userId: Meteor.userId()\n        });\n\n        if (file) {\n          Collections.files.update(_id, {\n            $set: {\n              'meta.unlisted': file.meta.unlisted ? false : true\n            }\n          }, _app.NOOP);\n          return true;\n        }\n      }\n      throw new Meteor.Error(401, 'Access denied!');\n    },\n    changePrivacy(_id) {\n      check(_id, String);\n      if (Meteor.userId()) {\n        const file = Collections.files.findOne({\n          _id: _id,\n          userId: Meteor.userId()\n        });\n\n        if (file) {\n          Collections.files.update(_id, {\n            $set: {\n              'meta.unlisted': true,\n              'meta.secured': file.meta.secured ? false : true\n            }\n          }, _app.NOOP);\n          return true;\n        }\n      }\n      throw new Meteor.Error(401, 'Access denied!');\n    }\n  });\n}\n","import { _ }      from 'meteor/underscore';\nimport { _app }   from '/lib/__compatibility/__globals.js';\nimport { check }  from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\n\nimport fs from 'fs-extra';\nimport gm from 'gm';\n\nconst bound = Meteor.bindEnvironment((callback) => {\n  return callback();\n});\n\n_app.createThumbnails = (collection, fileRef, cb) => {\n  check(fileRef, Object);\n\n  let isLast = false;\n  const finish = (error) => {\n    bound(() => {\n      if (error) {\n        console.error('[_app.createThumbnails] [finish]', error);\n        cb && cb (error);\n      } else {\n        if (isLast) {\n          cb && cb(void 0, fileRef);\n        }\n      }\n      return true;\n    });\n  };\n\n  fs.exists(fileRef.path, (exists) => {\n    bound(() => {\n      if (!exists) {\n        throw Meteor.log.error('File ' + fileRef.path + ' not found in [createThumbnails] Method');\n      }\n      const image = gm(fileRef.path);\n      const sizes = {\n        preview: {\n          width: 400\n        },\n        thumbnail40: {\n          width: 40,\n          square: true\n        }\n      };\n\n      image.size((error, features) => {\n        bound(() => {\n          if (error) {\n            console.error('[_app.createThumbnails] [_.each sizes]', error);\n            finish(Meteor.Error('[_app.createThumbnails] [_.each sizes]', error));\n            return;\n          }\n\n          let i = 0;\n          collection.collection.update(fileRef._id, {\n            $set: {\n              'meta.width': features.width,\n              'meta.height': features.height,\n              'versions.original.meta.width': features.width,\n              'versions.original.meta.height': features.height\n            }\n          }, _app.NOOP);\n\n          _.each(sizes, (size, name) => {\n            const path = (collection.storagePath(fileRef)) + '/' + name + '-' + fileRef._id + '.' + fileRef.extension;\n            const copyPaste = () => {\n              fs.copy(fileRef.path, path, (fsCopyError) => {\n                bound(() => {\n                  if (fsCopyError) {\n                    console.error('[_app.createThumbnails] [_.each sizes] [fs.copy]', fsCopyError);\n                    finish(fsCopyError);\n                    return;\n                  }\n\n                  const upd = { $set: {} };\n                  upd['$set']['versions.' + name] = {\n                    path: path,\n                    size: fileRef.size,\n                    type: fileRef.type,\n                    extension: fileRef.extension,\n                    meta: {\n                      width: features.width,\n                      height: features.height\n                    }\n                  };\n                  collection.collection.update(fileRef._id, upd, (colUpdError) => {\n                    ++i;\n                    if (i === Object.keys(sizes).length) {\n                      isLast = true;\n                    }\n                    finish(colUpdError);\n                  });\n                });\n              });\n            };\n\n            if (/png|jpe?g/i.test(fileRef.extension)) {\n              const img = gm(fileRef.path)\n                .quality(70)\n                .define('filter:support=2')\n                .define('jpeg:fancy-upsampling=false')\n                .define('jpeg:fancy-upsampling=off')\n                .define('png:compression-filter=5')\n                .define('png:compression-level=9')\n                .define('png:compression-strategy=1')\n                .define('png:exclude-chunk=all')\n                .autoOrient()\n                .noProfile()\n                .strip()\n                .dither(false)\n                .interlace('Line')\n                .filter('Triangle');\n\n              const updateAndSave = (upNSaveError) => {\n                bound(() => {\n                  if (upNSaveError) {\n                    console.error('[_app.createThumbnails] [_.each sizes] [img.resize]', upNSaveError);\n                    finish(upNSaveError);\n                    return;\n                  }\n                  fs.stat(path, (fsStatError, stat) => {\n                    bound(() => {\n                      if (fsStatError) {\n                        console.error('[_app.createThumbnails] [_.each sizes] [img.resize] [fs.stat]', fsStatError);\n                        finish(fsStatError);\n                        return;\n                      }\n\n                      gm(path).size((gmSizeError, imgInfo) => {\n                        bound(() => {\n                          if (gmSizeError) {\n                            console.error('[_app.createThumbnails] [_.each sizes] [img.resize] [fs.stat] [gm(path).size]', gmSizeError);\n                            finish(gmSizeError);\n                            return;\n                          }\n                          const upd = { $set: {} };\n                          upd['$set']['versions.' + name] = {\n                            path: path,\n                            size: stat.size,\n                            type: fileRef.type,\n                            extension: fileRef.extension,\n                            meta: {\n                              width: imgInfo.width,\n                              height: imgInfo.height\n                            }\n                          };\n\n                          collection.collection.update(fileRef._id, upd, (colUpdError) => {\n                            ++i;\n                            if (i === Object.keys(sizes).length) {\n                              isLast = true;\n                            }\n                            finish(colUpdError);\n                          });\n                        });\n                      });\n                    });\n                  });\n                });\n              };\n\n              if (!size.square) {\n                if (features.width > size.width) {\n                  img.resize(size.width).interlace('Line').write(path, updateAndSave);\n                } else {\n                  copyPaste();\n                }\n              } else {\n                let x = 0;\n                let y = 0;\n                const widthRatio  = features.width / size.width;\n                const heightRatio = features.height / size.width;\n                let widthNew      = size.width;\n                let heightNew     = size.width;\n\n                if (heightRatio < widthRatio) {\n                  widthNew = (size.width * features.width) / features.height;\n                  x = (widthNew - size.width) / 2;\n                }\n\n                if (heightRatio > widthRatio) {\n                  heightNew = (size.width * features.height) / features.width;\n                  y = (heightNew - size.width) / 2;\n                }\n\n                img\n                  .resize(widthNew, heightNew)\n                  .crop(size.width, size.width, x, y)\n                  .interlace('Line')\n                  .write(path, updateAndSave);\n              }\n            } else {\n              copyPaste();\n            }\n          });\n        });\n      });\n    });\n  });\n  return true;\n};\n","import { Meteor } from 'meteor/meteor';\nimport { ServiceConfiguration } from 'meteor/service-configuration';\n\nconst _sc = {};\nServiceConfiguration.configurations.remove({});\n\nif (process.env.ACCOUNTS_METEOR_ID && process.env.ACCOUNTS_METEOR_SEC) {\n  _sc.meteor = true;\n  ServiceConfiguration.configurations.upsert({\n    service: 'meteor-developer'\n  }, {\n    $set: {\n      secret: process.env.ACCOUNTS_METEOR_SEC,\n      clientId: process.env.ACCOUNTS_METEOR_ID,\n      loginStyle: 'redirect'\n    }\n  });\n}\n\nif (process.env.ACCOUNTS_GITHUB_ID && process.env.ACCOUNTS_GITHUB_SEC) {\n  _sc.github = true;\n  ServiceConfiguration.configurations.upsert({\n    service: 'github'\n  }, {\n    $set: {\n      secret: process.env.ACCOUNTS_GITHUB_SEC,\n      clientId: process.env.ACCOUNTS_GITHUB_ID,\n      loginStyle: 'redirect'\n    }\n  });\n}\n\nif (process.env.ACCOUNTS_TWITTER_ID && process.env.ACCOUNTS_TWITTER_SEC) {\n  _sc.twitter = true;\n  ServiceConfiguration.configurations.upsert({\n    service: 'twitter'\n  }, {\n    $set: {\n      loginStyle: 'redirect',\n      secret: process.env.ACCOUNTS_TWITTER_SEC,\n      consumerKey: process.env.ACCOUNTS_TWITTER_ID\n    }\n  });\n}\n\nif (process.env.ACCOUNTS_FACEBOOK_ID && process.env.ACCOUNTS_FACEBOOK_SEC) {\n  _sc.facebook = true;\n  ServiceConfiguration.configurations.upsert({\n    service: 'facebook'\n  }, {\n    $set: {\n      secret: process.env.ACCOUNTS_FACEBOOK_SEC,\n      appId: process.env.ACCOUNTS_FACEBOOK_ID,\n      loginStyle: 'redirect'\n    }\n  });\n}\n\nMeteor.methods({\n  getServiceConfiguration() {\n    return _sc;\n  }\n});\n","// import { WebApp } from 'meteor/webapp';\n// import Spiderable from 'meteor/ostrio:spiderable-middleware';\n// \n// WebApp.connectHandlers.use(new Spiderable({\n//   rootURL: 'https://files.veliov.com',\n//   serviceURL: 'https://render.ostr.io',\n//   auth: 'xxx:yyy'\n// }));"]}