{"version":3,"sources":["meteor://ðŸ’»app/imports/lib/core.js","meteor://ðŸ’»app/imports/lib/routes.js","meteor://ðŸ’»app/imports/server/files.collection.js","meteor://ðŸ’»app/imports/server/image-processing.js","meteor://ðŸ’»app/imports/server/methods.js","meteor://ðŸ’»app/imports/server/publications.js","meteor://ðŸ’»app/imports/server/service-configurations.js","meteor://ðŸ’»app/imports/server/spiderable.js","meteor://ðŸ’»app/server/core.js"],"names":["module","export","_app","Collections","link","NOOP","isUndefined","obj","isObject","isArray","isFunction","Object","Array","isBoolean","prototype","toString","call","isEmpty","isDate","keys","length","isString","clone","slice","assign","has","_obj","path","hasOwnProperty","i","omit","clear","pick","map","key","now","Date","throttle","func","wait","options","previous","timeout","result","that","self","args","later","leading","apply","throttled","remaining","arguments","clearTimeout","trailing","setTimeout","cancel","helpers","Meteor","v","FlowRouter","route","name","action","render","waitOn","isClient","subs","subscribe","userOnly","get","whileWaiting","subscriptions","isServer","register","fastRender","title","userId","meta","keywords","itemprop","content","description","property","params","queryParams","file","absoluteUrl","image","href","_id","onNoData","data","files","findOne","Random","filesize","FilesCollection","useDropBox","useS3","client","sendToStorage","fs","require","S3","stream","request","Dropbox","bound","bindEnvironment","callback","process","env","DROPBOX","settings","dropbox","JSON","parse","s3","s3Conf","dbConf","secret","token","Client","bucket","region","secretAccessKey","accessKeyId","sslEnabled","httpOptions","agent","storagePath","collectionName","allowClientCode","protected","fileObj","secured","onBeforeRemove","cursor","res","indexOf","onBeforeUpload","size","downloadCallback","query","download","collection","update","$inc","interceptDownload","http","fileRef","version","versions","pipeFrom","serve","url","headers","pipePath","opts","Bucket","Key","range","vRef","array","split","start","parseInt","end","isNaN","chunkSize","Range","fileColl","getObject","error","console","response","finished","httpResponse","replace","dataStream","PassThrough","Body","denyClient","on","_fileRef","makeUrl","stat","triesUrl","long","downloadHack","xml","upd","$set","updError","unlink","writeToDB","triesSend","writeFile","extension","readFile","triesRead","filePath","id","putObject","StorageClass","createReadStream","ContentType","type","test","createThumbnails","_origRemove","remove","search","find","forEach","deleteObject","setInterval","$lte","check","default","gm","cb","isLast","finish","exists","Error","sizes","preview","width","thumbnail40","square","features","height","copyPaste","copy","fsCopyError","colUpdError","img","quality","define","autoOrient","noProfile","strip","dither","interlace","filter","updateAndSave","upNSaveError","fsStatError","gmSizeError","imgInfo","resize","write","x","y","widthRatio","heightRatio","widthNew","heightNew","crop","methods","filesLenght","Boolean","selector","$or","$lt","count","unblame","String","blame","changeAccess","unlisted","changePrivacy","getServiceConfiguration","sc","publish","take","Number","limit","sort","fields","isPDF","isText","isJSON","isVideo","isAudio","isImage","_collectionName","_downloadRoute","ServiceConfiguration","configurations","ACCOUNTS_METEOR_ID","ACCOUNTS_METEOR_SEC","meteor","upsert","service","clientId","loginStyle","ACCOUNTS_GITHUB_ID","ACCOUNTS_GITHUB_SEC","github","ACCOUNTS_TWITTER_ID","ACCOUNTS_TWITTER_SEC","twitter","consumerKey","ACCOUNTS_FACEBOOK_ID","ACCOUNTS_FACEBOOK_SEC","facebook","appId"],"mappings":"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","file":"/app.js","sourcesContent":["import './routes.js';\n\nconst Collections = {};\nconst _app = {\n  NOOP(){},\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n  isObject(obj) {\n    if (this.isArray(obj) || this.isFunction(obj)) {\n      return false;\n    }\n    return obj === Object(obj);\n  },\n  isArray(obj) {\n    return Array.isArray(obj);\n  },\n  isBoolean(obj) {\n    return obj === true || obj === false || Object.prototype.toString.call(obj) === '[object Boolean]';\n  },\n  isFunction(obj) {\n    return typeof obj === 'function' || false;\n  },\n  isEmpty(obj) {\n    if (this.isDate(obj)) {\n      return false;\n    }\n    if (this.isObject(obj)) {\n      return !Object.keys(obj).length;\n    }\n    if (this.isArray(obj) || this.isString(obj)) {\n      return !obj.length;\n    }\n    return false;\n  },\n  clone(obj) {\n    if (!this.isObject(obj)) return obj;\n    return this.isArray(obj) ? obj.slice() : Object.assign({}, obj);\n  },\n  has(_obj, path) {\n    let obj = _obj;\n    if (!this.isObject(obj)) {\n      return false;\n    }\n    if (!this.isArray(path)) {\n      return this.isObject(obj) && Object.prototype.hasOwnProperty.call(obj, path);\n    }\n\n    const length = path.length;\n    for (let i = 0; i < length; i++) {\n      if (!Object.prototype.hasOwnProperty.call(obj, path[i])) {\n        return false;\n      }\n      obj = obj[path[i]];\n    }\n    return !!length;\n  },\n  omit(obj, ...keys) {\n    const clear = Object.assign({}, obj);\n    for (let i = keys.length - 1; i >= 0; i--) {\n      delete clear[keys[i]];\n    }\n\n    return clear;\n  },\n  pick(obj, ...keys) {\n    return Object.assign({}, ...keys.map(key => ({[key]: obj[key]})));\n  },\n  now: Date.now,\n  throttle(func, wait, options = {}) {\n    let previous = 0;\n    let timeout = null;\n    let result;\n    const that = this;\n    let self;\n    let args;\n\n    const later = () => {\n      previous = options.leading === false ? 0 : that.now();\n      timeout = null;\n      result = func.apply(self, args);\n      if (!timeout) self = args = null;\n    };\n\n    const throttled = function () {\n      const now = that.now();\n      if (!previous && options.leading === false) previous = now;\n      const remaining = wait - (now - previous);\n      self = this;\n      args = arguments;\n      if (remaining <= 0 || remaining > wait) {\n        if (timeout) {\n          clearTimeout(timeout);\n          timeout = null;\n        }\n        previous = now;\n        result = func.apply(self, args);\n        if (!timeout) self = args = null;\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n\n    throttled.cancel = () => {\n      clearTimeout(timeout);\n      previous = 0;\n      timeout = self = args = null;\n    };\n\n    return throttled;\n  }\n};\n\nconst helpers = ['String', 'Number', 'Date'];\nfor (let i = 0; i < helpers.length; i++) {\n  _app['is' + helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + helpers[i] + ']';\n  };\n}\n\nexport { _app, Collections };\n","import { Meteor }            from 'meteor/meteor';\nimport { FlowRouter }        from 'meteor/ostrio:flow-router-extra';\nimport { _app, Collections } from '/imports/lib/core.js';\n\nFlowRouter.route('/', {\n  name: 'index',\n  action() {\n    this.render('_layout', 'index');\n  },\n  waitOn() {\n    if (Meteor.isClient) {\n      return [_app.subs.subscribe('latest', 10, _app.userOnly.get()), import('/imports/client/index/index.js')];\n    }\n  },\n  whileWaiting() {\n    this.render('_layout', '_loading');\n  },\n  subscriptions() {\n    if (Meteor.isServer) {\n      this.register('latest', Meteor.subscribe('latest', 10, false));\n    }\n  },\n  fastRender: true\n});\n\nFlowRouter.route('/login', {\n  name: 'login',\n  title() {\n    if (Meteor.userId()) {\n      return 'Your account settings';\n    }\n    return 'Login into Meteor Files';\n  },\n  meta: {\n    keywords: {\n      name: 'keywords',\n      itemprop: 'keywords',\n      content: 'private, unlisted, files, upload, meteor, open source, javascript'\n    },\n    description: {\n      name: 'description',\n      itemprop: 'description',\n      property: 'og:description',\n      content: 'Login into Meteor files. After you logged in you can make files private and unlisted'\n    },\n    'twitter:description': 'Login into Meteor files. After you logged in you can make files private and unlisted'\n  },\n  action() {\n    this.render('_layout', 'login');\n  },\n  waitOn() {\n    return import('/imports/client/user-account/login.js');\n  },\n  whileWaiting() {\n    this.render('_layout', '_loading');\n  }\n});\n\nFlowRouter.route('/:_id', {\n  name: 'file',\n  title(params, queryParams, file) {\n    if (file) {\n      return 'View File: ' + (file.get('name'));\n    }\n    return '404: Page not found';\n  },\n  meta(params, queryParams, file) {\n    return {\n      keywords: {\n        name: 'keywords',\n        itemprop: 'keywords',\n        content: file ? 'file, view, preview, uploaded, shared, ' + (file.get('name')) + ', ' + (file.get('extension')) + ', ' + (file.get('type')) + ', meteor, open source, javascript' : '404, page, not found'\n      },\n      description: {\n        name: 'description',\n        itemprop: 'description',\n        property: 'og:description',\n        content: file ? 'View uploaded and shared file: ' + (file.get('name')) : '404: No such page'\n      },\n      'twitter:description': file ? 'View uploaded and shared file: ' + (file.get('name')) : '404: No such page',\n      'og:image': {\n        property: 'og:image',\n        content: file && file.get('isImage') ? file.link('preview') : Meteor.absoluteUrl('icon_1200x630.png')\n      },\n      'twitter:image': {\n        name: 'twitter:image',\n        content: file && file.get('isImage') ? file.link('preview') : Meteor.absoluteUrl('icon_750x560.png')\n      }\n    };\n  },\n  link(params, queryParams, file) {\n    return {\n      image: {\n        itemprop: 'image',\n        content() {\n          if (file && file.get('isImage')) {\n            return file.link('preview');\n          }\n          return Meteor.absoluteUrl('icon_1200x630.png');\n        },\n        href() {\n          if (file && file.get('isImage')) {\n            return file.link('preview');\n          }\n          return Meteor.absoluteUrl('icon_1200x630.png');\n        }\n      }\n    };\n  },\n  action(params, queryParams, file) {\n    if (_app.isObject(file) && !_app.isEmpty(file)) {\n      this.render('_layout', 'file', {\n        file: file\n      });\n    }\n  },\n  waitOn(params) {\n    if (Meteor.isClient) {\n      return [_app.subs.subscribe('file', params._id), import('/imports/client/file/file.js')];\n    }\n  },\n  subscriptions(params) {\n    if (Meteor.isServer) {\n      this.register('file', Meteor.subscribe('file', params._id));\n    }\n  },\n  fastRender: true,\n  whileWaiting() {\n    this.render('_layout', '_loading');\n  },\n  onNoData() {\n    this.render('_layout', '_404');\n  },\n  data(params) {\n    return Collections.files.findOne(params._id) || false;\n  }\n});\n\n// 404 route (catch all)\nFlowRouter.route('*', {\n  action() {\n    this.render('_layout', '_404');\n  },\n  title: '404: Page not found'\n});\n","import { Meteor }            from 'meteor/meteor';\nimport { Random }            from 'meteor/random';\nimport { filesize }          from 'meteor/mrt:filesize';\nimport { FilesCollection }   from 'meteor/ostrio:files';\nimport { _app, Collections } from '/imports/lib/core.js';\n\n// DropBox usage:\n// Read: https://github.com/VeliovGroup/Meteor-Files/wiki/DropBox-Integration\n// env.var example: DROPBOX='{\"dropbox\":{\"key\": \"xxx\", \"secret\": \"xxx\", \"token\": \"xxx\"}}'\nlet useDropBox = false;\n\n// AWS:S3 usage:\n// Read: https://github.com/VeliovGroup/Meteor-Files/wiki/AWS-S3-Integration\n// env.var example: S3='{\"s3\":{\"key\": \"xxx\", \"secret\": \"xxx\", \"bucket\": \"xxx\", \"region\": \"xxx\"\"}}'\nlet useS3 = false;\nlet client;\nlet sendToStorage;\n\nconst fs      = require('fs-extra');\nconst S3      = require('aws-sdk/clients/s3');\nconst stream  = require('stream');\nconst request = require('request');\nconst Dropbox = require('dropbox');\nconst bound   = Meteor.bindEnvironment((callback) => {\n  return callback();\n});\n\nif (process.env.DROPBOX) {\n  Meteor.settings.dropbox = JSON.parse(process.env.DROPBOX).dropbox;\n} else if (process.env.S3) {\n  Meteor.settings.s3 = JSON.parse(process.env.S3).s3;\n}\n\nconst s3Conf = Meteor.settings.s3 || {};\nconst dbConf = Meteor.settings.dropbox || {};\n\nif (dbConf && dbConf.key && dbConf.secret && dbConf.token) {\n  useDropBox = true;\n  client     = new Dropbox.Client({\n    key: dbConf.key,\n    secret: dbConf.secret,\n    token: dbConf.token\n  });\n} else if (s3Conf && s3Conf.key && s3Conf.secret && s3Conf.bucket && s3Conf.region) {\n  useS3  = true;\n  client = new S3({\n    secretAccessKey: s3Conf.secret,\n    accessKeyId: s3Conf.key,\n    region: s3Conf.region,\n    sslEnabled: false,\n    httpOptions: {\n      timeout: 6000,\n      agent: false\n    }\n  });\n}\n\nCollections.files = new FilesCollection({\n  // debug: true,\n  storagePath: 'assets/app/uploads/uploadedFiles',\n  collectionName: 'uploadedFiles',\n  allowClientCode: true,\n  // disableUpload: true,\n  // disableDownload: true,\n  protected(fileObj) {\n    if (fileObj) {\n      if (!(fileObj.meta && fileObj.meta.secured)) {\n        return true;\n      } else if ((fileObj.meta && fileObj.meta.secured === true) && this.userId === fileObj.userId) {\n        return true;\n      }\n    }\n    return false;\n  },\n  onBeforeRemove(cursor) {\n    const res = cursor.map((file) => {\n      if (file && file.userId && _app.isString(file.userId)) {\n        return file.userId === this.userId;\n      }\n      return false;\n    });\n    return !~res.indexOf(false);\n  },\n  onBeforeUpload() {\n    if (this.file.size <= 1024 * 1024 * 128) {\n      return true;\n    }\n    return \"Max. file size is 128MB you've tried to upload \" + (filesize(this.file.size));\n  },\n  downloadCallback(fileObj) {\n    if (this.params && this.params.query && this.params.query.download === 'true') {\n      Collections.files.collection.update(fileObj._id, {\n        $inc: {\n          'meta.downloads': 1\n        }\n      }, _app.NOOP);\n    }\n    return true;\n  },\n  interceptDownload(http, fileRef, version) {\n    let path;\n    if (useDropBox) {\n      path = (fileRef && fileRef.versions && fileRef.versions[version] && fileRef.versions[version].meta && fileRef.versions[version].meta.pipeFrom) ? fileRef.versions[version].meta.pipeFrom : void 0;\n      if (path) {\n        // If file is successfully moved to Storage\n        // We will pipe request to Storage\n        // So, original link will stay always secure\n\n        // To force ?play and ?download parameters\n        // and to keep original file name, content-type,\n        // content-disposition and cache-control\n        // we're using low-level .serve() method\n        this.serve(http, fileRef, fileRef.versions[version], version, request({\n          url: path,\n          headers: _app.pick(http.request.headers, 'range', 'cache-control', 'connection')\n        }));\n        return true;\n      }\n      // While file is not yet uploaded to Storage\n      // We will serve file from FS\n      return false;\n    } else if (useS3) {\n      path = (fileRef && fileRef.versions && fileRef.versions[version] && fileRef.versions[version].meta && fileRef.versions[version].meta.pipePath) ? fileRef.versions[version].meta.pipePath : void 0;\n      if (path) {\n        // If file is successfully moved to Storage\n        // We will pipe request to Storage\n        // So, original link will stay always secure\n\n        // To force ?play and ?download parameters\n        // and to keep original file name, content-type,\n        // content-disposition and cache-control\n        // we're using low-level .serve() method\n        const opts = {\n          Bucket: s3Conf.bucket,\n          Key: path\n        };\n\n        if (http.request.headers.range) {\n          const vRef  = fileRef.versions[version];\n          let range   = _app.clone(http.request.headers.range);\n          const array = range.split(/bytes=([0-9]*)-([0-9]*)/);\n          const start = parseInt(array[1]);\n          let end     = parseInt(array[2]);\n          if (isNaN(end)) {\n            // Request data from AWS:S3 by small chunks\n            end       = (start + this.chunkSize) - 1;\n            if (end >= vRef.size) {\n              end     = vRef.size - 1;\n            }\n          }\n          opts.Range   = `bytes=${start}-${end}`;\n          http.request.headers.range = `bytes=${start}-${end}`;\n        }\n\n        const fileColl = this;\n        client.getObject(opts, function (error) {\n          if (error) {\n            console.error(error);\n            if (!http.response.finished) {\n              http.response.end();\n            }\n          } else {\n            if (http.request.headers.range && this.httpResponse.headers['content-range']) {\n              // Set proper range header in according to what is returned from AWS:S3\n              http.request.headers.range = this.httpResponse.headers['content-range'].split('/')[0].replace('bytes ', 'bytes=');\n            }\n\n            const dataStream = new stream.PassThrough();\n            fileColl.serve(http, fileRef, fileRef.versions[version], version, dataStream);\n            dataStream.end(this.data.Body);\n          }\n        });\n\n        return true;\n      }\n      // While file is not yet uploaded to Storage\n      // We will serve file from FS\n      return false;\n    }\n    return false;\n  }\n});\n\nCollections.files.denyClient();\nCollections.files.on('afterUpload', function(_fileRef) {\n  if (useDropBox) {\n    const makeUrl = (stat, fileRef, version, triesUrl = 0) => {\n      client.makeUrl(stat.path, {\n        long: true,\n        downloadHack: true\n      }, (error, xml) => {\n        bound(() => {\n          // Store downloadable link in file's meta object\n          if (error) {\n            if (triesUrl < 10) {\n              Meteor.setTimeout(() => {\n                makeUrl(stat, fileRef, version, ++triesUrl);\n              }, 2048);\n            } else {\n              console.error(error, {\n                triesUrl: triesUrl\n              });\n            }\n          } else if (xml) {\n            const upd = { $set: {} };\n            upd.$set[`versions.${version}.meta.pipeFrom`] = xml.url;\n            upd.$set[`versions.${version}.meta.pipePath`] = stat.path;\n            this.collection.update({\n              _id: fileRef._id\n            }, upd, (updError) => {\n              if (updError) {\n                console.error(updError);\n              } else {\n                // Unlink original files from FS\n                // after successful upload to DropBox\n                this.unlink(this.collection.findOne(fileRef._id), version);\n              }\n            });\n          } else {\n            if (triesUrl < 10) {\n              Meteor.setTimeout(() => {\n                // Generate downloadable link\n                makeUrl(stat, fileRef, version, ++triesUrl);\n              }, 2048);\n            } else {\n              console.error('client.makeUrl doesn\\'t returns xml', {\n                triesUrl: triesUrl\n              });\n            }\n          }\n        });\n      });\n    };\n\n    const writeToDB = (fileRef, version, data, triesSend = 0) => {\n      // DropBox already uses random URLs\n      // No need to use random file names\n      client.writeFile(fileRef._id + '-' + version + '.' + fileRef.extension, data, (error, stat) => {\n        bound(() => {\n          if (error) {\n            if (triesSend < 10) {\n              Meteor.setTimeout(() => {\n                // Write file to DropBox\n                writeToDB(fileRef, version, data, ++triesSend);\n              }, 2048);\n            } else {\n              console.error(error, {\n                triesSend: triesSend\n              });\n            }\n          } else {\n            makeUrl(stat, fileRef, version);\n          }\n        });\n      });\n    };\n\n    const readFile = (fileRef, vRef, version, triesRead = 0) => {\n      fs.readFile(vRef.path, (error, data) => {\n        bound(() => {\n          if (error) {\n            if (triesRead < 10) {\n              readFile(fileRef, vRef, version, ++triesRead);\n            } else {\n              console.error(error);\n            }\n          } else {\n            writeToDB(fileRef, version, data);\n          }\n        });\n      });\n    };\n\n    sendToStorage = (fileRef) => {\n      for(let version in fileRef.versions) {\n        if (fileRef.versions[version]) {\n          readFile(fileRef, fileRef.versions[version], version);\n        }\n      }\n    };\n  } else if (useS3) {\n    sendToStorage = (fileRef) => {\n      for(let version in fileRef.versions) {\n        if (fileRef.versions[version]) {\n          const vRef = fileRef.versions[version];\n          // We use Random.id() instead of real file's _id\n          // to secure files from reverse engineering\n          // As after viewing this code it will be easy\n          // to get access to unlisted and protected files\n          const filePath = 'files/' + (Random.id()) + '-' + version + '.' + fileRef.extension;\n\n          client.putObject({\n            StorageClass: 'STANDARD',\n            Bucket: s3Conf.bucket,\n            Key: filePath,\n            Body: fs.createReadStream(vRef.path),\n            ContentType: vRef.type,\n          }, (error) => {\n            bound(() => {\n              if (error) {\n                console.error(error);\n              } else {\n                const upd = { $set: {} };\n                upd.$set[`versions.${version}.meta.pipePath`] = filePath;\n                this.collection.update({\n                  _id: fileRef._id\n                }, upd, (updError) => {\n                  if (updError) {\n                    console.error(updError);\n                  } else {\n                    // Unlink original file from FS\n                    // after successful upload to AWS:S3\n                    this.unlink(this.collection.findOne(fileRef._id), version);\n                  }\n                });\n              }\n            });\n          });\n        }\n      }\n    };\n  }\n\n  if (/png|jpe?g/i.test(_fileRef.extension || '')) {\n    Meteor.setTimeout( () => {\n      _app.createThumbnails(this, _fileRef, (error) => {\n        if (error) {\n          console.error(error);\n        }\n\n        if (useDropBox || useS3) {\n          sendToStorage(this.collection.findOne(_fileRef._id));\n        }\n      });\n    }, 1024);\n  } else {\n    if (useDropBox || useS3) {\n      sendToStorage(_fileRef);\n    }\n  }\n});\n\n// This line now commented due to Heroku usage\n// Collections.files.collection._ensureIndex {'meta.expireAt': 1}, {expireAfterSeconds: 0, background: true}\n\n// Intercept FileCollection's remove method\n// to remove file from DropBox or AWS S3\nif (useDropBox || useS3) {\n  const _origRemove = Collections.files.remove;\n  Collections.files.remove = function(search) {\n    const cursor = this.collection.find(search);\n    cursor.forEach((fileRef) => {\n      for (let version in fileRef.versions) {\n        if (fileRef.versions[version]) {\n          const vRef = fileRef.versions[version];\n          if (vRef && vRef.meta && vRef.meta.pipePath) {\n            if (useDropBox) {\n              // DropBox usage:\n              client.remove(vRef.meta.pipePath, (error) => {\n                bound(() => {\n                  if (error) {\n                    console.error(error);\n                  }\n                });\n              });\n            } else {\n              // AWS:S3 usage:\n              client.deleteObject({\n                Bucket: s3Conf.bucket,\n                Key: vRef.meta.pipePath,\n              }, (error) => {\n                bound(() => {\n                  if (error) {\n                    console.error(error);\n                  }\n                });\n              });\n            }\n          }\n        }\n      }\n    });\n    // Call original method\n    _origRemove.call(this, search);\n  };\n}\n\n// Remove all files on server load/reload, useful while testing/development\n// Meteor.startup -> Collections.files.remove {}\n\n// Remove files along with MongoDB records two minutes before expiration date\n// If we have 'expireAfterSeconds' index on 'meta.expireAt' field,\n// it won't remove files themselves.\nMeteor.setInterval(() => {\n  Collections.files.remove({\n    'meta.expireAt': {\n      $lte: new Date(+new Date() + 120000)\n    }\n  }, _app.NOOP);\n}, 120000);\n","import { _app }   from '/imports/lib/core.js';\nimport { check }  from 'meteor/check';\nimport { Meteor } from 'meteor/meteor';\n\nimport fs from 'fs-extra';\nimport gm from 'gm';\n//Some platforms may bundle ImageMagick into their tools (like Heroku). In this case you may use GraphicsMagick as Imagemagick in this way:\n//npm install gm --save and then where you use it:\n//const gm = require('gm');\n//const im = gm.subClass({ imageMagick: true });\n//Please note that GM was considered slightly faster than IM so before you chose convenience over performance read the latest news about it.\n//https://mazira.com/blog/comparing-speed-imagemagick-graphicsmagick\n\nconst bound = Meteor.bindEnvironment((callback) => {\n  return callback();\n});\n\n_app.createThumbnails = (collection, fileRef, cb) => {\n  check(fileRef, Object);\n\n  let isLast = false;\n  const finish = (error) => {\n    bound(() => {\n      if (error) {\n        console.error('[_app.createThumbnails] [finish]', error);\n        cb && cb (error);\n      } else {\n        if (isLast) {\n          cb && cb(void 0, fileRef);\n        }\n      }\n      return true;\n    });\n  };\n\n  fs.exists(fileRef.path, (exists) => {\n    bound(() => {\n      if (!exists) {\n        throw new Meteor.Error('File ' + fileRef.path + ' not found in [createThumbnails] Method');\n      }\n      const image = gm(fileRef.path);\n      const sizes = {\n        preview: {\n          width: 400\n        },\n        thumbnail40: {\n          width: 40,\n          square: true\n        }\n      };\n\n      image.size((error, features) => {\n        bound(() => {\n          if (error) {\n            console.error('[_app.createThumbnails] [forEach sizes]', error);\n            finish(new Meteor.Error('[_app.createThumbnails] [forEach sizes]', error));\n            return;\n          }\n\n          let i = 0;\n          collection.collection.update(fileRef._id, {\n            $set: {\n              'meta.width': features.width,\n              'meta.height': features.height,\n              'versions.original.meta.width': features.width,\n              'versions.original.meta.height': features.height\n            }\n          }, _app.NOOP);\n\n          Object.keys(sizes).forEach((name) => {\n            const size = sizes[name];\n            const path = (collection.storagePath(fileRef)) + '/' + name + '-' + fileRef._id + '.' + fileRef.extension;\n            const copyPaste = () => {\n              fs.copy(fileRef.path, path, (fsCopyError) => {\n                bound(() => {\n                  if (fsCopyError) {\n                    console.error('[_app.createThumbnails] [forEach sizes] [fs.copy]', fsCopyError);\n                    finish(fsCopyError);\n                    return;\n                  }\n\n                  const upd = { $set: {} };\n                  upd.$set[`versions.${name}`] = {\n                    path: path,\n                    size: fileRef.size,\n                    type: fileRef.type,\n                    extension: fileRef.extension,\n                    meta: {\n                      width: features.width,\n                      height: features.height\n                    }\n                  };\n\n                  collection.collection.update(fileRef._id, upd, (colUpdError) => {\n                    ++i;\n                    if (i === Object.keys(sizes).length) {\n                      isLast = true;\n                    }\n                    finish(colUpdError);\n                  });\n                });\n              });\n            };\n\n            if (/png|jpe?g/i.test(fileRef.extension)) {\n              const img = gm(fileRef.path)\n                .quality(70)\n                .define('filter:support=2')\n                .define('jpeg:fancy-upsampling=false')\n                .define('jpeg:fancy-upsampling=off')\n                .define('png:compression-filter=5')\n                .define('png:compression-level=9')\n                .define('png:compression-strategy=1')\n                .define('png:exclude-chunk=all')\n                .autoOrient()\n                .noProfile()\n                .strip()\n                .dither(false)\n                .interlace('Line')\n                .filter('Triangle');\n\n              const updateAndSave = (upNSaveError) => {\n                bound(() => {\n                  if (upNSaveError) {\n                    console.error('[_app.createThumbnails] [forEach sizes] [img.resize]', upNSaveError);\n                    finish(upNSaveError);\n                    return;\n                  }\n                  fs.stat(path, (fsStatError, stat) => {\n                    bound(() => {\n                      if (fsStatError) {\n                        console.error('[_app.createThumbnails] [forEach sizes] [img.resize] [fs.stat]', fsStatError);\n                        finish(fsStatError);\n                        return;\n                      }\n\n                      gm(path).size((gmSizeError, imgInfo) => {\n                        bound(() => {\n                          if (gmSizeError) {\n                            console.error('[_app.createThumbnails] [forEach sizes] [img.resize] [fs.stat] [gm(path).size]', gmSizeError);\n                            finish(gmSizeError);\n                            return;\n                          }\n                          const upd = { $set: {} };\n                          upd.$set[`versions.${name}`] = {\n                            path: path,\n                            size: stat.size,\n                            type: fileRef.type,\n                            extension: fileRef.extension,\n                            name: fileRef.name,\n                            meta: {\n                              width: imgInfo.width,\n                              height: imgInfo.height\n                            }\n                          };\n\n                          collection.collection.update(fileRef._id, upd, (colUpdError) => {\n                            ++i;\n                            if (i === Object.keys(sizes).length) {\n                              isLast = true;\n                            }\n                            finish(colUpdError);\n                          });\n                        });\n                      });\n                    });\n                  });\n                });\n              };\n\n              if (!size.square) {\n                if (features.width > size.width) {\n                  img.resize(size.width).interlace('Line').write(path, updateAndSave);\n                } else {\n                  copyPaste();\n                }\n              } else {\n                let x = 0;\n                let y = 0;\n                const widthRatio  = features.width / size.width;\n                const heightRatio = features.height / size.width;\n                let widthNew      = size.width;\n                let heightNew     = size.width;\n\n                if (heightRatio < widthRatio) {\n                  widthNew = (size.width * features.width) / features.height;\n                  x = (widthNew - size.width) / 2;\n                }\n\n                if (heightRatio > widthRatio) {\n                  heightNew = (size.width * features.height) / features.width;\n                  y = (heightNew - size.width) / 2;\n                }\n\n                img\n                  .resize(widthNew, heightNew)\n                  .crop(size.width, size.width, x, y)\n                  .interlace('Line')\n                  .write(path, updateAndSave);\n              }\n            } else {\n              copyPaste();\n            }\n          });\n        });\n      });\n    });\n  });\n  return true;\n};\n","import { check }             from 'meteor/check';\nimport { Meteor }            from 'meteor/meteor';\nimport { _app, Collections } from '/imports/lib/core.js';\n\nMeteor.methods({\n  filesLenght(userOnly = false) {\n    check(userOnly, Boolean);\n\n    let selector;\n    if (userOnly && this.userId) {\n      selector = {\n        userId: this.userId\n      };\n    } else if (this.userId) {\n      selector = {\n        $or: [\n          {\n            'meta.unlisted': false,\n            'meta.secured': false,\n            'meta.blamed': {\n              $lt: 3\n            }\n          }, {\n            userId: this.userId,\n            'meta.blamed': {\n              $lt: 3\n            }\n          }\n        ]\n      };\n    } else {\n      selector = {\n        'meta.unlisted': false,\n        'meta.secured': false,\n        'meta.blamed': {\n          $lt: 3\n        }\n      };\n    }\n    return Collections.files.find(selector).count();\n  },\n  unblame(_id) {\n    check(_id, String);\n    Collections.files.update({\n      _id: _id\n    }, {\n      $inc: {\n        'meta.blamed': -1\n      }\n    }, _app.NOOP);\n    return true;\n  },\n  blame(_id) {\n    check(_id, String);\n    Collections.files.update({\n      _id: _id\n    }, {\n      $inc: {\n        'meta.blamed': 1\n      }\n    }, _app.NOOP);\n    return true;\n  },\n  changeAccess(_id) {\n    check(_id, String);\n    if (Meteor.userId()) {\n      const file = Collections.files.findOne({\n        _id: _id,\n        userId: Meteor.userId()\n      });\n\n      if (file) {\n        Collections.files.update(_id, {\n          $set: {\n            'meta.unlisted': file.meta.unlisted ? false : true\n          }\n        }, _app.NOOP);\n        return true;\n      }\n    }\n    throw new Meteor.Error(401, 'Access denied!');\n  },\n  changePrivacy(_id) {\n    check(_id, String);\n    if (Meteor.userId()) {\n      const file = Collections.files.findOne({\n        _id: _id,\n        userId: Meteor.userId()\n      });\n\n      if (file) {\n        Collections.files.update(_id, {\n          $set: {\n            'meta.unlisted': true,\n            'meta.secured': file.meta.secured ? false : true\n          }\n        }, _app.NOOP);\n        return true;\n      }\n    }\n    throw new Meteor.Error(401, 'Access denied!');\n  },\n  getServiceConfiguration() {\n    return _app.sc;\n  }\n});\n","import { check }       from 'meteor/check';\nimport { Meteor }      from 'meteor/meteor';\nimport { Collections } from '/imports/lib/core.js';\n\nMeteor.publish('latest', function(take = 10, userOnly = false) {\n  check(take, Number);\n  check(userOnly, Boolean);\n\n  let selector;\n  if (userOnly && this.userId) {\n    selector = {\n      userId: this.userId\n    };\n  } else if (this.userId) {\n    selector = {\n      $or: [\n        {\n          'meta.unlisted': false,\n          'meta.secured': false,\n          'meta.blamed': {\n            $lt: 3\n          }\n        }, {\n          userId: this.userId,\n          'meta.blamed': {\n            $lt: 3\n          }\n        }\n      ]\n    };\n  } else {\n    selector = {\n      'meta.unlisted': false,\n      'meta.secured': false,\n      'meta.blamed': {\n        $lt: 3\n      }\n    };\n  }\n\n  return Collections.files.find(selector, {\n    limit: take,\n    sort: {\n      'meta.created_at': -1\n    },\n    fields: {\n      _id: 1,\n      name: 1,\n      size: 1,\n      meta: 1,\n      type: 1,\n      isPDF: 1,\n      isText: 1,\n      isJSON: 1,\n      isVideo: 1,\n      isAudio: 1,\n      isImage: 1,\n      userId: 1,\n      'versions.thumbnail40.extension': 1,\n      'versions.preview.extension': 1,\n      extension: 1,\n      _collectionName: 1,\n      _downloadRoute: 1\n    }\n  }).cursor;\n});\n\nMeteor.publish('file', function(_id) {\n  check(_id, String);\n\n  let selector = {\n    _id: _id,\n    'meta.secured': false\n  };\n\n  if (this.userId) {\n    selector = {\n      $or: [selector, {\n        _id: _id,\n        'meta.secured': true,\n        userId: this.userId\n      }]\n    };\n  }\n\n  return Collections.files.find(selector, {\n    fields: {\n      _id: 1,\n      name: 1,\n      size: 1,\n      type: 1,\n      meta: 1,\n      isPDF: 1,\n      isText: 1,\n      isJSON: 1,\n      isVideo: 1,\n      isAudio: 1,\n      isImage: 1,\n      extension: 1,\n      'versions.thumbnail40.extension': 1,\n      'versions.preview.extension': 1,\n      _collectionName: 1,\n      _downloadRoute: 1\n    }\n  }).cursor;\n});\n","import { _app }                 from '/imports/lib/core.js';\nimport { ServiceConfiguration } from 'meteor/service-configuration';\n\n_app.sc = {};\nServiceConfiguration.configurations.remove({});\n\nif (process.env.ACCOUNTS_METEOR_ID && process.env.ACCOUNTS_METEOR_SEC) {\n  _app.sc.meteor = true;\n  ServiceConfiguration.configurations.upsert({\n    service: 'meteor-developer'\n  }, {\n    $set: {\n      secret: process.env.ACCOUNTS_METEOR_SEC,\n      clientId: process.env.ACCOUNTS_METEOR_ID,\n      loginStyle: 'redirect'\n    }\n  });\n}\n\nif (process.env.ACCOUNTS_GITHUB_ID && process.env.ACCOUNTS_GITHUB_SEC) {\n  _app.sc.github = true;\n  ServiceConfiguration.configurations.upsert({\n    service: 'github'\n  }, {\n    $set: {\n      secret: process.env.ACCOUNTS_GITHUB_SEC,\n      clientId: process.env.ACCOUNTS_GITHUB_ID,\n      loginStyle: 'redirect'\n    }\n  });\n}\n\nif (process.env.ACCOUNTS_TWITTER_ID && process.env.ACCOUNTS_TWITTER_SEC) {\n  _app.sc.twitter = true;\n  ServiceConfiguration.configurations.upsert({\n    service: 'twitter'\n  }, {\n    $set: {\n      loginStyle: 'redirect',\n      secret: process.env.ACCOUNTS_TWITTER_SEC,\n      consumerKey: process.env.ACCOUNTS_TWITTER_ID\n    }\n  });\n}\n\nif (process.env.ACCOUNTS_FACEBOOK_ID && process.env.ACCOUNTS_FACEBOOK_SEC) {\n  _app.sc.facebook = true;\n  ServiceConfiguration.configurations.upsert({\n    service: 'facebook'\n  }, {\n    $set: {\n      secret: process.env.ACCOUNTS_FACEBOOK_SEC,\n      appId: process.env.ACCOUNTS_FACEBOOK_ID,\n      loginStyle: 'redirect'\n    }\n  });\n}\n","// import { WebApp } from 'meteor/webapp';\n// import Spiderable from 'meteor/ostrio:spiderable-middleware';\n//\n// WebApp.connectHandlers.use(new Spiderable({\n//   rootURL: 'https://files.veliov.com',\n//   serviceURL: 'https://render.ostr.io',\n//   auth: 'xxx:yyy'\n// }));\n","import '/imports/server/files.collection.js';\nimport '/imports/server/image-processing.js';\nimport '/imports/server/methods.js';\nimport '/imports/server/publications.js';\nimport '/imports/server/service-configurations.js';\nimport '/imports/server/spiderable.js';\n"]}